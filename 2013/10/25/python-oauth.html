<!DOCTYPE html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png href=/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicon-16x16.png sizes=16x16><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#b100b2><meta name=theme-color content=#b100b2><title>Python + OAuth</title><meta name=description content="I am Dr Martin Chorley. I am a lecturer at the School of Computer Science & Informatics, Cardiff University.I'm programme leader for the MSc in Computational Journalism, and also senior personal tutor for all taught postgraduate students. I mainly do work that falls under the umbrella of the Mobile and Social Computing group.
"><link rel=icon href=/img/favicon.png><link href="https://fonts.googleapis.com/css?family=Roboto|Scope+One" rel=stylesheet><link rel=stylesheet type=text/css href=/css/main.css></head><body><header><div class=social><ul><li><a href=https://www.twitter.com/martinjc class="icon twitter" title=Twitter><svg viewBox="0 0 512 512"><path d="M419.6 168.6c-11.7 5.2-24.2 8.7-37.4 10.2 13.4-8.1 23.8-20.8 28.6-36 -12.6 7.5-26.5 12.9-41.3 15.8 -11.9-12.6-28.8-20.6-47.5-20.6 -42 0-72.9 39.2-63.4 79.9 -54.1-2.7-102.1-28.6-134.2-68 -17 29.2-8.8 67.5 20.1 86.9 -10.7-0.3-20.7-3.3-29.5-8.1 -0.7 30.2 20.9 58.4 52.2 64.6 -9.2 2.5-19.2 3.1-29.4 1.1 8.3 25.9 32.3 44.7 60.8 45.2 -27.4 21.4-61.8 31-96.4 27 28.8 18.5 63 29.2 99.8 29.2 120.8 0 189.1-102.1 185-193.6C399.9 193.1 410.9 181.7 419.6 168.6z"/></svg><!--[if lt IE 9]><em>Twitter</em><![endif]--></a></li><li><a href=mailto:ChorleyMJ@Cardiff.ac.uk class="icon email" title=Email><svg viewBox="0 0 512 512"><path d="M101.3 141.6v228.9h0.3 308.4 0.8V141.6H101.3zM375.7 167.8l-119.7 91.5 -119.6-91.5H375.7zM127.6 194.1l64.1 49.1 -64.1 64.1V194.1zM127.8 344.2l84.9-84.9 43.2 33.1 43-32.9 84.7 84.7L127.8 344.2 127.8 344.2zM384.4 307.8l-64.4-64.4 64.4-49.3V307.8z"/></svg><!--[if lt IE 9]><em>Email</em><![endif]--></a></li><li><a href=https://www.facebook.com/martin.chorley class="icon facebook" title=Facebook><svg viewBox="0 0 512 512"><path d="M211.9 197.4h-36.7v59.9h36.7V433.1h70.5V256.5h49.2l5.2-59.1h-54.4c0 0 0-22.1 0-33.7 0-13.9 2.8-19.5 16.3-19.5 10.9 0 38.2 0 38.2 0V82.9c0 0-40.2 0-48.8 0 -52.5 0-76.1 23.1-76.1 67.3C211.9 188.8 211.9 197.4 211.9 197.4z"/></svg><!--[if lt IE 9]><em>Facebook</em><![endif]--></a></li><li><a href=https://www.github.com/martinjc class="icon github" title=GitHub><svg viewBox="0 0 512 512"><path d="M256 70.7c-102.6 0-185.9 83.2-185.9 185.9 0 82.1 53.3 151.8 127.1 176.4 9.3 1.7 12.3-4 12.3-8.9V389.4c-51.7 11.3-62.5-21.9-62.5-21.9 -8.4-21.5-20.6-27.2-20.6-27.2 -16.9-11.5 1.3-11.3 1.3-11.3 18.7 1.3 28.5 19.2 28.5 19.2 16.6 28.4 43.5 20.2 54.1 15.4 1.7-12 6.5-20.2 11.8-24.9 -41.3-4.7-84.7-20.6-84.7-91.9 0-20.3 7.3-36.9 19.2-49.9 -1.9-4.7-8.3-23.6 1.8-49.2 0 0 15.6-5 51.1 19.1 14.8-4.1 30.7-6.2 46.5-6.3 15.8 0.1 31.7 2.1 46.6 6.3 35.5-24 51.1-19.1 51.1-19.1 10.1 25.6 3.8 44.5 1.8 49.2 11.9 13 19.1 29.6 19.1 49.9 0 71.4-43.5 87.1-84.9 91.7 6.7 5.8 12.8 17.1 12.8 34.4 0 24.9 0 44.9 0 51 0 4.9 3 10.7 12.4 8.9 73.8-24.6 127-94.3 127-176.4C441.9 153.9 358.6 70.7 256 70.7z"/></svg><!--[if lt IE 9]><em>GitHub</em><![endif]--></a></li><li><a href=https://www.instagram.com/martinjam class="icon instagram" title=Instagram><svg viewBox="0 0 512 512"><g><path d="M256 109.3c47.8 0 53.4 0.2 72.3 1 17.4 0.8 26.9 3.7 33.2 6.2 8.4 3.2 14.3 7.1 20.6 13.4 6.3 6.3 10.1 12.2 13.4 20.6 2.5 6.3 5.4 15.8 6.2 33.2 0.9 18.9 1 24.5 1 72.3s-0.2 53.4-1 72.3c-0.8 17.4-3.7 26.9-6.2 33.2 -3.2 8.4-7.1 14.3-13.4 20.6 -6.3 6.3-12.2 10.1-20.6 13.4 -6.3 2.5-15.8 5.4-33.2 6.2 -18.9 0.9-24.5 1-72.3 1s-53.4-0.2-72.3-1c-17.4-0.8-26.9-3.7-33.2-6.2 -8.4-3.2-14.3-7.1-20.6-13.4 -6.3-6.3-10.1-12.2-13.4-20.6 -2.5-6.3-5.4-15.8-6.2-33.2 -0.9-18.9-1-24.5-1-72.3s0.2-53.4 1-72.3c0.8-17.4 3.7-26.9 6.2-33.2 3.2-8.4 7.1-14.3 13.4-20.6 6.3-6.3 12.2-10.1 20.6-13.4 6.3-2.5 15.8-5.4 33.2-6.2C202.6 109.5 208.2 109.3 256 109.3M256 77.1c-48.6 0-54.7 0.2-73.8 1.1 -19 0.9-32.1 3.9-43.4 8.3 -11.8 4.6-21.7 10.7-31.7 20.6 -9.9 9.9-16.1 19.9-20.6 31.7 -4.4 11.4-7.4 24.4-8.3 43.4 -0.9 19.1-1.1 25.2-1.1 73.8 0 48.6 0.2 54.7 1.1 73.8 0.9 19 3.9 32.1 8.3 43.4 4.6 11.8 10.7 21.7 20.6 31.7 9.9 9.9 19.9 16.1 31.7 20.6 11.4 4.4 24.4 7.4 43.4 8.3 19.1 0.9 25.2 1.1 73.8 1.1s54.7-0.2 73.8-1.1c19-0.9 32.1-3.9 43.4-8.3 11.8-4.6 21.7-10.7 31.7-20.6 9.9-9.9 16.1-19.9 20.6-31.7 4.4-11.4 7.4-24.4 8.3-43.4 0.9-19.1 1.1-25.2 1.1-73.8s-0.2-54.7-1.1-73.8c-0.9-19-3.9-32.1-8.3-43.4 -4.6-11.8-10.7-21.7-20.6-31.7 -9.9-9.9-19.9-16.1-31.7-20.6 -11.4-4.4-24.4-7.4-43.4-8.3C310.7 77.3 304.6 77.1 256 77.1L256 77.1z"/><path d="M256 164.1c-50.7 0-91.9 41.1-91.9 91.9s41.1 91.9 91.9 91.9 91.9-41.1 91.9-91.9S306.7 164.1 256 164.1zM256 315.6c-32.9 0-59.6-26.7-59.6-59.6s26.7-59.6 59.6-59.6 59.6 26.7 59.6 59.6S288.9 315.6 256 315.6z"/><circle cx=351.5 cy=160.5 r=21.5 /></g></svg><!--[if lt IE 9]><em>Instagram</em><![endif]--></a></li><li><a href=https://www.last.fm/user/takitomouse class="icon lastfm" title=Last.fm><svg viewBox="0 0 512 512"><path d="M230.104 336.568l-13.607-36.988c0 0-22.11 24.66-55.268 24.66 -29.341 0-50.172-25.512-50.172-66.328 0-52.293 26.359-71.001 52.297-71.001 37.412 0 49.316 24.234 59.522 55.273l13.607 42.518c13.603 41.236 39.113 74.402 112.666 74.402 52.727 0 88.437-16.155 88.437-58.672 0-34.438-19.56-52.297-56.125-60.802l-27.209-5.951c-18.707-4.252-24.233-11.906-24.233-24.659 0-14.456 11.478-22.96 30.189-22.96 20.406 0 31.458 7.653 33.162 25.935l42.516-5.103c-3.402-38.263-29.761-53.996-73.127-53.996 -38.266 0-75.68 14.456-75.68 60.799 0 28.912 14.029 47.197 49.315 55.697l28.916 6.801c21.683 5.104 28.908 14.031 28.908 26.363 0 15.73-15.305 22.107-44.218 22.107 -42.941 0-60.794-22.534-70.999-53.574l-14.032-42.513c-17.854-55.271-46.342-75.68-102.892-75.68 -62.499-0.001-95.663 39.538-95.663 106.715 0 64.628 33.164 99.489 92.689 99.489C207.141 359.1 230.104 336.568 230.104 336.568L230.104 336.568z"/></svg><!--[if lt IE 9]><em>Last.fm</em><![endif]--></a></li><li><a href=https://uk.linkedin.com/in/martinchorley class="icon linkedin" title=LinkedIn><svg viewBox="0 0 512 512"><path d="M186.4 142.4c0 19-15.3 34.5-34.2 34.5 -18.9 0-34.2-15.4-34.2-34.5 0-19 15.3-34.5 34.2-34.5C171.1 107.9 186.4 123.4 186.4 142.4zM181.4 201.3h-57.8V388.1h57.8V201.3zM273.8 201.3h-55.4V388.1h55.4c0 0 0-69.3 0-98 0-26.3 12.1-41.9 35.2-41.9 21.3 0 31.5 15 31.5 41.9 0 26.9 0 98 0 98h57.5c0 0 0-68.2 0-118.3 0-50-28.3-74.2-68-74.2 -39.6 0-56.3 30.9-56.3 30.9v-25.2H273.8z"/></svg><!--[if lt IE 9]><em>LinkedIn</em><![endif]--></a></li></ul></div><nav><ul>|<li><a href=/ >home</a> |</li><li><a href=/blog>blog</a> |</li><li><a href=/research>research</a> |</li><li><a href=/publications>publications</a> |</li><li><a href=/teaching>teaching</a> |</li></ul></nav></header><div class=wrapper><article class=blogpost><a class=post__back href=/blog/ >&lt;-- back</a><h1 class=post__title>Python + OAuth</h1><p class=author><span class=date>October 25, 2013</span> - by martin</p><div class=content ?><p>As part of a current project I had the misfortune of having to to deal with a bunch of OAuth authenticated web services using a command line script in Python. Usually this isn’t really a problem as most decent client libraries for services such as <a href=https://github.com/tweepy/tweepy>Twitter</a> or <a href=https://pypi.python.org/pypi/foursquare>Foursquare</a> can handle the authentication requests themselves, usually wrapping their own internal OAuth implementation. However, when it comes to web services that don’t have existing python client libraries, you have to do the implementation yourself. Unfortunately support for OAuth in Python is a mess, so this is not the most pleasant of tasks, especially when most stackoverflow <a href=http://stackoverflow.com/questions/12628246/how-to-send-oauth-request-with-python-oauth2>posts</a> <a href=http://stackoverflow.com/questions/15610749/github-api-v3-access-via-python-oauth2-library-redirect-issue>on</a> <a href=http://stackoverflow.com/questions/1666415/python-oauth-library>the</a> topic point to massively <a href=http://code.daaku.org/python-oauth/ >outdated</a> and <a href=https://github.com/simplegeo/python-oauth2>unmaintained</a> Python libraries.</p><p>Fortunately after some digging around, I was able to find a nice, well maintained and <a href=https://rauth.readthedocs.org/en/latest/ >fairly well documented</a> solution: <a href=https://github.com/litl/rauth>rauth</a>, which is very clean and easy to use. As an example, I was trying to connect to the Fitbit API, and it really was as simple as following their example.</p><p>Firstly, we create an OAuth1Service:</p><figure class=highlight><pre><code class=language-python data-lang=python><span class=kn>import</span> <span class=nn>rauth</span>
<span class=kn>from</span> <span class=nn>_credentials</span> <span class=kn>import</span> <span class=n>consumer_key</span><span class=p>,</span> <span class=n>consumer_secret</span>

<span class=n>base_url</span> <span class=o>=</span> <span class=s>"https://api.fitbit.com"</span>
<span class=n>request_token_url</span> <span class=o>=</span> <span class=n>base_url</span> <span class=o>+</span> <span class=s>"/oauth/request_token"</span>
<span class=n>access_token_url</span> <span class=o>=</span> <span class=n>base_url</span> <span class=o>+</span> <span class=s>"/oauth/access_token"</span>
<span class=n>authorize_url</span> <span class=o>=</span> <span class=s>"http://www.fitbit.com/oauth/authorize"</span>

<span class=n>fitbit</span> <span class=o>=</span> <span class=n>rauth</span><span class=o>.</span><span class=n>OAuth1Service</span><span class=p>(</span>
 <span class=n>name</span><span class=o>=</span><span class=s>"fitbit"</span><span class=p>,</span>
 <span class=n>consumer_key</span><span class=o>=</span><span class=n>consumer_key</span><span class=p>,</span>
 <span class=n>consumer_secret</span><span class=o>=</span><span class=n>consumer_secret</span><span class=p>,</span>
 <span class=n>request_token_url</span><span class=o>=</span><span class=n>request_token_url</span><span class=p>,</span>
 <span class=n>access_token_url</span><span class=o>=</span><span class=n>access_token_url</span><span class=p>,</span>
 <span class=n>authorize_url</span><span class=o>=</span><span class=n>authorize_url</span><span class=p>,</span>
 <span class=n>base_url</span><span class=o>=</span><span class=n>base_url</span><span class=p>)</span></code></pre></figure><p>Then we get the temporary request token credentials:</p><figure class=highlight><pre><code class=language-python data-lang=python><span class=n>request_token</span><span class=p>,</span> <span class=n>request_token_secret</span> <span class=o>=</span> <span class=n>fitbit</span><span class=o>.</span><span class=n>get_request_token</span><span class=p>()</span>

<span class=k>print</span> <span class=s>" request_token = </span><span class=si>%</span><span class=s>s"</span> <span class=o>%</span> <span class=n>request_token</span>
<span class=k>print</span> <span class=s>" request_token_secret = </span><span class=si>%</span><span class=s>s"</span> <span class=o>%</span> <span class=n>request_token_secret</span>
<span class=k>print</span></code></pre></figure><p>We then ask the user to authorise our application, and give us the PIN so we can prove to the service that they authorised us:</p><figure class=highlight><pre><code class=language-python data-lang=python><span class=n>authorize_url</span> <span class=o>=</span> <span class=n>fitbit</span><span class=o>.</span><span class=n>get_authorize_url</span><span class=p>(</span><span class=n>request_token</span><span class=p>)</span>

<span class=k>print</span> <span class=s>"Go to the following page in your browser: "</span> <span class=o>+</span> <span class=n>authorize_url</span>
<span class=k>print</span>

<span class=n>accepted</span> <span class=o>=</span> <span class=s>'n'</span>
<span class=k>while</span> <span class=n>accepted</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=o>==</span> <span class=s>'n'</span><span class=p>:</span>
 <span class=n>accepted</span> <span class=o>=</span> <span class=nb>raw_input</span><span class=p>(</span><span class=s>'Have you authorized me? (y/n) '</span><span class=p>)</span>
<span class=n>pin</span> <span class=o>=</span> <span class=nb>raw_input</span><span class=p>(</span><span class=s>'Enter PIN from browser '</span><span class=p>)</span></code></pre></figure><p>Finally, we can create an authenticated session and access user data from the service:</p><figure class=highlight><pre><code class=language-python data-lang=python><span class=n>session</span> <span class=o>=</span> <span class=n>fitbit</span><span class=o>.</span><span class=n>get_auth_session</span><span class=p>(</span><span class=n>request_token</span><span class=p>,</span>
 <span class=n>request_token_secret</span><span class=p>,</span>
 <span class=n>method</span><span class=o>=</span><span class=s>"POST"</span><span class=p>,</span>
 <span class=n>data</span><span class=o>=</span><span class=p>{</span><span class=s>'oauth_verifier'</span><span class=p>:</span> <span class=n>pin</span><span class=p>})</span>

<span class=k>print</span> <span class=s>""</span>
<span class=k>print</span> <span class=s>" access_token = </span><span class=si>%</span><span class=s>s"</span> <span class=o>%</span> <span class=n>session</span><span class=o>.</span><span class=n>access_token</span>
<span class=k>print</span> <span class=s>" access_token_secret = </span><span class=si>%</span><span class=s>s"</span> <span class=o>%</span> <span class=n>session</span><span class=o>.</span><span class=n>access_token_secret</span>
<span class=k>print</span> <span class=s>""</span>

<span class=n>url</span> <span class=o>=</span> <span class=n>base_url</span> <span class=o>+</span> <span class=s>"/1/"</span> <span class=o>+</span> <span class=s>"user/-/profile.json"</span>

<span class=n>r</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>params</span><span class=o>=</span><span class=p>{},</span> <span class=n>header_auth</span><span class=o>=</span><span class=bp>True</span><span class=p>)</span>
<span class=k>print</span> <span class=n>r</span><span class=o>.</span><span class=n>json</span><span class=p>()</span></code></pre></figure><p>It really is that easy to perform a 3-legged OAuth authentication on the command line. If you’re only interested in data from 1 user, and you want to run the app multiple times, once you have the access token and secret, there’s nothing to stop you just storing those and re-creating your session each time without having to re-authenticate (assuming the service does not expire access tokens):</p><figure class=highlight><pre><code class=language-python data-lang=python><span class=n>base_url</span> <span class=o>=</span> <span class=s>"https://api.fitbit.com/"</span>
<span class=n>api_version</span> <span class=o>=</span> <span class=s>"1/"</span>
<span class=n>token</span> <span class=o>=</span> <span class=p>(</span><span class=n>fitbit_oauth_token</span><span class=p>,</span> <span class=n>fitbit_oauth_secret</span><span class=p>)</span>
<span class=n>consumer</span> <span class=o>=</span> <span class=p>(</span><span class=n>fitbit_consumer_key</span><span class=p>,</span> <span class=n>fitbit_consumer_secret</span><span class=p>)</span>

<span class=n>session</span> <span class=o>=</span> <span class=n>rauth</span><span class=o>.</span><span class=n>OAuth1Session</span><span class=p>(</span><span class=n>consumer</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>consumer</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>token</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>token</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
<span class=n>url</span> <span class=o>=</span> <span class=n>base_url</span> <span class=o>+</span> <span class=n>api_version</span> <span class=o>+</span> <span class=s>"user/-/profile.json"</span>
<span class=n>r</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>params</span><span class=o>=</span><span class=p>{},</span> <span class=n>header_auth</span><span class=o>=</span><span class=bp>True</span><span class=p>)</span>
<span class=k>print</span> <span class=n>r</span><span class=o>.</span><span class=n>json</span><span class=p>()</span></code></pre></figure><p>So there we have it. Simple OAuth authentication on the command line, in Python. As always, the code is available on <a href=https://github.com/martinjc/rauth---fitbit-example>github</a> if you’re interested.</p></div></article></div></body></html>