<!DOCTYPE html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png href=/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicon-16x16.png sizes=16x16><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#b100b2><meta name=theme-color content=#b100b2><meta property=og:url content=https://martinjc.com/ ><meta property=og:type content=website><meta property=og:title content="Martin Chorley"><meta property=og:description content="I am Dr Martin Chorley, a lecturer at the School of Computer Science & Informatics, Cardiff University, programme leader for the MSc in Computational and Data Journalism.
"><meta property=og:site_name content="Martin Chorley"><meta property=og:locale content=en_GB><meta property=article:author content="Martin Chorley"><meta name=twitter:card content=summary><meta name=twitter:creator content=@martinjc><meta name=twitter:url content=https://martinjc.com><meta name=twitter:title content="Martin Chorley"><meta name=twitter:description content="I am Dr Martin Chorley, a lecturer at the School of Computer Science & Informatics, Cardiff University, programme leader for the MSc in Computational and Data Journalism.
"><title>CCGs and WPCs via the medium of OAs</title><meta name=description content="I am Dr Martin Chorley, a lecturer at the School of Computer Science & Informatics, Cardiff University, programme leader for the MSc in Computational and Data Journalism.
"><link rel=icon href=/img/favicon.png><link href="https://fonts.googleapis.com/css?family=Roboto|Scope+One" rel=stylesheet><link rel=stylesheet type=text/css href=/css/main.css></head><body><header><div class=social><ul><li><a href=https://www.twitter.com/martinjc class="icon twitter" title=Twitter><svg viewBox="0 0 512 512"><path d="M419.6 168.6c-11.7 5.2-24.2 8.7-37.4 10.2 13.4-8.1 23.8-20.8 28.6-36 -12.6 7.5-26.5 12.9-41.3 15.8 -11.9-12.6-28.8-20.6-47.5-20.6 -42 0-72.9 39.2-63.4 79.9 -54.1-2.7-102.1-28.6-134.2-68 -17 29.2-8.8 67.5 20.1 86.9 -10.7-0.3-20.7-3.3-29.5-8.1 -0.7 30.2 20.9 58.4 52.2 64.6 -9.2 2.5-19.2 3.1-29.4 1.1 8.3 25.9 32.3 44.7 60.8 45.2 -27.4 21.4-61.8 31-96.4 27 28.8 18.5 63 29.2 99.8 29.2 120.8 0 189.1-102.1 185-193.6C399.9 193.1 410.9 181.7 419.6 168.6z"/></svg><!--[if lt IE 9]><em>Twitter</em><![endif]--></a></li><li><a href=mailto:ChorleyMJ@Cardiff.ac.uk class="icon email" title=Email><svg viewBox="0 0 512 512"><path d="M101.3 141.6v228.9h0.3 308.4 0.8V141.6H101.3zM375.7 167.8l-119.7 91.5 -119.6-91.5H375.7zM127.6 194.1l64.1 49.1 -64.1 64.1V194.1zM127.8 344.2l84.9-84.9 43.2 33.1 43-32.9 84.7 84.7L127.8 344.2 127.8 344.2zM384.4 307.8l-64.4-64.4 64.4-49.3V307.8z"/></svg><!--[if lt IE 9]><em>Email</em><![endif]--></a></li><li><a href=https://www.facebook.com/martin.chorley class="icon facebook" title=Facebook><svg viewBox="0 0 512 512"><path d="M211.9 197.4h-36.7v59.9h36.7V433.1h70.5V256.5h49.2l5.2-59.1h-54.4c0 0 0-22.1 0-33.7 0-13.9 2.8-19.5 16.3-19.5 10.9 0 38.2 0 38.2 0V82.9c0 0-40.2 0-48.8 0 -52.5 0-76.1 23.1-76.1 67.3C211.9 188.8 211.9 197.4 211.9 197.4z"/></svg><!--[if lt IE 9]><em>Facebook</em><![endif]--></a></li><li><a href=https://www.github.com/martinjc class="icon github" title=GitHub><svg viewBox="0 0 512 512"><path d="M256 70.7c-102.6 0-185.9 83.2-185.9 185.9 0 82.1 53.3 151.8 127.1 176.4 9.3 1.7 12.3-4 12.3-8.9V389.4c-51.7 11.3-62.5-21.9-62.5-21.9 -8.4-21.5-20.6-27.2-20.6-27.2 -16.9-11.5 1.3-11.3 1.3-11.3 18.7 1.3 28.5 19.2 28.5 19.2 16.6 28.4 43.5 20.2 54.1 15.4 1.7-12 6.5-20.2 11.8-24.9 -41.3-4.7-84.7-20.6-84.7-91.9 0-20.3 7.3-36.9 19.2-49.9 -1.9-4.7-8.3-23.6 1.8-49.2 0 0 15.6-5 51.1 19.1 14.8-4.1 30.7-6.2 46.5-6.3 15.8 0.1 31.7 2.1 46.6 6.3 35.5-24 51.1-19.1 51.1-19.1 10.1 25.6 3.8 44.5 1.8 49.2 11.9 13 19.1 29.6 19.1 49.9 0 71.4-43.5 87.1-84.9 91.7 6.7 5.8 12.8 17.1 12.8 34.4 0 24.9 0 44.9 0 51 0 4.9 3 10.7 12.4 8.9 73.8-24.6 127-94.3 127-176.4C441.9 153.9 358.6 70.7 256 70.7z"/></svg><!--[if lt IE 9]><em>GitHub</em><![endif]--></a></li><li><a href=https://www.instagram.com/martinjam class="icon instagram" title=Instagram><svg viewBox="0 0 512 512"><g><path d="M256 109.3c47.8 0 53.4 0.2 72.3 1 17.4 0.8 26.9 3.7 33.2 6.2 8.4 3.2 14.3 7.1 20.6 13.4 6.3 6.3 10.1 12.2 13.4 20.6 2.5 6.3 5.4 15.8 6.2 33.2 0.9 18.9 1 24.5 1 72.3s-0.2 53.4-1 72.3c-0.8 17.4-3.7 26.9-6.2 33.2 -3.2 8.4-7.1 14.3-13.4 20.6 -6.3 6.3-12.2 10.1-20.6 13.4 -6.3 2.5-15.8 5.4-33.2 6.2 -18.9 0.9-24.5 1-72.3 1s-53.4-0.2-72.3-1c-17.4-0.8-26.9-3.7-33.2-6.2 -8.4-3.2-14.3-7.1-20.6-13.4 -6.3-6.3-10.1-12.2-13.4-20.6 -2.5-6.3-5.4-15.8-6.2-33.2 -0.9-18.9-1-24.5-1-72.3s0.2-53.4 1-72.3c0.8-17.4 3.7-26.9 6.2-33.2 3.2-8.4 7.1-14.3 13.4-20.6 6.3-6.3 12.2-10.1 20.6-13.4 6.3-2.5 15.8-5.4 33.2-6.2C202.6 109.5 208.2 109.3 256 109.3M256 77.1c-48.6 0-54.7 0.2-73.8 1.1 -19 0.9-32.1 3.9-43.4 8.3 -11.8 4.6-21.7 10.7-31.7 20.6 -9.9 9.9-16.1 19.9-20.6 31.7 -4.4 11.4-7.4 24.4-8.3 43.4 -0.9 19.1-1.1 25.2-1.1 73.8 0 48.6 0.2 54.7 1.1 73.8 0.9 19 3.9 32.1 8.3 43.4 4.6 11.8 10.7 21.7 20.6 31.7 9.9 9.9 19.9 16.1 31.7 20.6 11.4 4.4 24.4 7.4 43.4 8.3 19.1 0.9 25.2 1.1 73.8 1.1s54.7-0.2 73.8-1.1c19-0.9 32.1-3.9 43.4-8.3 11.8-4.6 21.7-10.7 31.7-20.6 9.9-9.9 16.1-19.9 20.6-31.7 4.4-11.4 7.4-24.4 8.3-43.4 0.9-19.1 1.1-25.2 1.1-73.8s-0.2-54.7-1.1-73.8c-0.9-19-3.9-32.1-8.3-43.4 -4.6-11.8-10.7-21.7-20.6-31.7 -9.9-9.9-19.9-16.1-31.7-20.6 -11.4-4.4-24.4-7.4-43.4-8.3C310.7 77.3 304.6 77.1 256 77.1L256 77.1z"/><path d="M256 164.1c-50.7 0-91.9 41.1-91.9 91.9s41.1 91.9 91.9 91.9 91.9-41.1 91.9-91.9S306.7 164.1 256 164.1zM256 315.6c-32.9 0-59.6-26.7-59.6-59.6s26.7-59.6 59.6-59.6 59.6 26.7 59.6 59.6S288.9 315.6 256 315.6z"/><circle cx=351.5 cy=160.5 r=21.5 /></g></svg><!--[if lt IE 9]><em>Instagram</em><![endif]--></a></li><li><a href=https://www.last.fm/user/takitomouse class="icon lastfm" title=Last.fm><svg viewBox="0 0 512 512"><path d="M230.104 336.568l-13.607-36.988c0 0-22.11 24.66-55.268 24.66 -29.341 0-50.172-25.512-50.172-66.328 0-52.293 26.359-71.001 52.297-71.001 37.412 0 49.316 24.234 59.522 55.273l13.607 42.518c13.603 41.236 39.113 74.402 112.666 74.402 52.727 0 88.437-16.155 88.437-58.672 0-34.438-19.56-52.297-56.125-60.802l-27.209-5.951c-18.707-4.252-24.233-11.906-24.233-24.659 0-14.456 11.478-22.96 30.189-22.96 20.406 0 31.458 7.653 33.162 25.935l42.516-5.103c-3.402-38.263-29.761-53.996-73.127-53.996 -38.266 0-75.68 14.456-75.68 60.799 0 28.912 14.029 47.197 49.315 55.697l28.916 6.801c21.683 5.104 28.908 14.031 28.908 26.363 0 15.73-15.305 22.107-44.218 22.107 -42.941 0-60.794-22.534-70.999-53.574l-14.032-42.513c-17.854-55.271-46.342-75.68-102.892-75.68 -62.499-0.001-95.663 39.538-95.663 106.715 0 64.628 33.164 99.489 92.689 99.489C207.141 359.1 230.104 336.568 230.104 336.568L230.104 336.568z"/></svg><!--[if lt IE 9]><em>Last.fm</em><![endif]--></a></li><li><a href=https://uk.linkedin.com/in/martinchorley class="icon linkedin" title=LinkedIn><svg viewBox="0 0 512 512"><path d="M186.4 142.4c0 19-15.3 34.5-34.2 34.5 -18.9 0-34.2-15.4-34.2-34.5 0-19 15.3-34.5 34.2-34.5C171.1 107.9 186.4 123.4 186.4 142.4zM181.4 201.3h-57.8V388.1h57.8V201.3zM273.8 201.3h-55.4V388.1h55.4c0 0 0-69.3 0-98 0-26.3 12.1-41.9 35.2-41.9 21.3 0 31.5 15 31.5 41.9 0 26.9 0 98 0 98h57.5c0 0 0-68.2 0-118.3 0-50-28.3-74.2-68-74.2 -39.6 0-56.3 30.9-56.3 30.9v-25.2H273.8z"/></svg><!--[if lt IE 9]><em>LinkedIn</em><![endif]--></a></li></ul></div><nav><ul>|<li><a href=/ >&nbsp;home</a>&nbsp;|</li><li><a href=/blog>&nbsp;blog</a>&nbsp;|</li><li><a href=/teaching>&nbsp;teaching</a>&nbsp;|</li><li><a href=/research>&nbsp;research</a>&nbsp;|</li><li><a href=/publications>&nbsp;publications</a>&nbsp;|</li></ul></nav></header><div class=wrapper><article class=blogpost><a class=post__back href=/blog/ >&lt;-- back</a><h1 class=post__title>CCGs and WPCs via the medium of OAs</h1><p class=author><span class=date>September 15, 2014</span> - by martin</p><div class=content ?><p>As I was eating lunch this afternoon, I spotted a conversation between <a href=https://twitter.com/joereddington>@JoeReddington</a> and <a href=https://twitter.com/mysociety>@MySociety</a> whizz past in Tweetdeck. I traced the conversation back to the beginning and found this request for data:</p><blockquote class=twitter-tweet data-lang=en><p lang=en dir=ltr>I&#39;m looking for a dataset that shows which UK constituencies are in which NHS trust areas. Anyone?</p>&mdash; retired account (@retired10072015) <a href=https://twitter.com/retired10072015/status/511105946710716416>September 14, 2014</a></blockquote><script async src=//platform.twitter.com/widgets.js charset=utf-8></script><p>I’ve been doing a lot of playing with geographic data recently while preparing to release a site making it easier to get GeoJSON boundaries of various areas in the UK. As a result, I’ve become pretty familiar with the <a href=https://geoportal.statistics.gov.uk/geoportal/catalog/search/browse/browse.page>Office of National Statistics Geography portal</a>, and the data available there. I figured it must be pretty simple to hack something together to provide the data Joseph was looking for, so I took a few minutes out of lunch to see if I could help.</p><p>Checking the lookup tables at the ONS, it was clear that unfortunately there was no simple ‘NHS Trust to Parliamentary Constituency’ lookup table. However, there were two separate lookups involving Output Areas (OAs). One allows you to lookup <a href="https://geoportal.statistics.gov.uk/geoportal/catalog/search/resource/details.page?uuid=%7B441E0CBF-1421-4BF5-BBC9-5B7C0EA0FE44%7D">which Parliamentary Constituency (WPC) an OA belongs to</a>. The other allows you to lookup <a href="https://geoportal.statistics.gov.uk/geoportal/catalog/search/resource/details.page?uuid=%7B15C3A07F-F5E1-4CE8-9CFD-24B3589C725B%7D">which NHS Clinical Commissioning Group (CCG) an OA belongs to</a>. Clearly, all that’s required to link the two together is a bit of quick scripting to tie them both together via the Output Areas.</p><p>First, let’s create a dictionary with an entry for each CCG. For each CCG we’ll store it’s ID, name, and a set of OAs contained within. We’ll also add  an empty set for the WPCs contained within the CCG:</p><figure class=highlight><pre><code class=language-python data-lang=python><span class=kn>import</span> <span class=nn>csv</span>
<span class=kn>from</span> <span class=nn>collections</span> <span class=kn>import</span> <span class=n>defaultdict</span>

<span class=n>data</span> <span class=o>=</span> <span class=p>{}</span>

<span class=c># extract information about clinical commissioning groups</span>
<span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s>'OA11_CCG13_NHSAT_NHSCR_EN_LU.csv'</span><span class=p>,</span> <span class=s>'r'</span><span class=p>)</span> <span class=k>as</span> <span class=n>oa_to_cgc_file</span><span class=p>:</span>
  <span class=n>reader</span> <span class=o>=</span> <span class=n>csv</span><span class=o>.</span><span class=n>DictReader</span><span class=p>(</span><span class=n>oa_to_cgc_file</span><span class=p>)</span>
  <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>reader</span><span class=p>:</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>row</span><span class=p>[</span><span class=s>'CCG13CD'</span><span class=p>]):</span>
      <span class=n>data</span><span class=p>[</span><span class=n>row</span><span class=p>[</span><span class=s>'CCG13CD'</span><span class=p>]]</span> <span class=o>=</span> <span class=p>{</span><span class=s>'CCG13CD'</span><span class=p>:</span> <span class=n>row</span><span class=p>[</span><span class=s>'CCG13CD'</span><span class=p>],</span> <span class=s>'CCG13NM'</span><span class=p>:</span> <span class=n>row</span><span class=p>[</span><span class=s>'CCG13NM'</span><span class=p>],</span> <span class=s>'PCON11CD list'</span><span class=p>:</span> <span class=nb>set</span><span class=p>(),</span> <span class=s>'PCON11NM list'</span><span class=p>:</span> <span class=nb>set</span><span class=p>(),</span> <span class=s>'OA11CD list'</span><span class=p>:</span> <span class=nb>set</span><span class=p>(),}</span>
    <span class=n>data</span><span class=p>[</span><span class=n>row</span><span class=p>[</span><span class=s>'CCG13CD'</span><span class=p>]][</span><span class=s>'OA11CD list'</span><span class=p>]</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>row</span><span class=p>[</span><span class=s>'OA11CD'</span><span class=p>])</span></code></pre></figure><p>Next we create a lookup table that allows us to convert from OA to WPC:</p><figure class=highlight><pre><code class=language-python data-lang=python><span class=c># extract information for output area to constituency lookup</span>
<span class=n>oas</span> <span class=o>=</span> <span class=p>{}</span>
<span class=n>pcon_nm</span> <span class=o>=</span> <span class=p>{}</span>

<span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s>'OA11_PCON11_EER11_EW_LU.csv'</span><span class=p>,</span> <span class=s>'r'</span><span class=p>)</span> <span class=k>as</span> <span class=n>oa_to_pcon_file</span><span class=p>:</span>
  <span class=n>reader</span> <span class=o>=</span> <span class=n>csv</span><span class=o>.</span><span class=n>DictReader</span><span class=p>(</span><span class=n>oa_to_pcon_file</span><span class=p>)</span>
  <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>reader</span><span class=p>:</span>
    <span class=n>oas</span><span class=p>[</span><span class=n>row</span><span class=p>[</span><span class=s>'OA11CD'</span><span class=p>]]</span> <span class=o>=</span> <span class=n>row</span><span class=p>[</span><span class=s>'PCON11CD'</span><span class=p>]</span>
    <span class=n>pcon_nm</span><span class=p>[</span><span class=n>row</span><span class=p>[</span><span class=s>'PCON11CD'</span><span class=p>]]</span> <span class=o>=</span> <span class=n>row</span><span class=p>[</span><span class=s>'PCON11NM'</span><span class=p>]</span></code></pre></figure><p>As the almost last step we go through the CCGs, and for each one we go through the list of OAs it covers, and lookup the WPC each OA belongs to:</p><figure class=highlight><pre><code class=language-python data-lang=python><span class=c># go through all the ccgs and lookup pcons from oas</span>
<span class=k>for</span> <span class=n>ccg</span><span class=p>,</span> <span class=n>d</span> <span class=ow>in</span> <span class=n>data</span><span class=o>.</span><span class=n>iteritems</span><span class=p>():</span>

 <span class=k>for</span> <span class=n>oa</span> <span class=ow>in</span> <span class=n>d</span><span class=p>[</span><span class=s>'OA11CD list'</span><span class=p>]:</span>
   <span class=n>d</span><span class=p>[</span><span class=s>'PCON11CD list'</span><span class=p>]</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>oas</span><span class=p>[</span><span class=n>oa</span><span class=p>])</span>
   <span class=n>d</span><span class=p>[</span><span class=s>'PCON11NM list'</span><span class=p>]</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>pcon_nm</span><span class=p>[</span><span class=n>oas</span><span class=p>[</span><span class=n>oa</span><span class=p>]])</span>

<span class=k>del</span> <span class=n>d</span><span class=p>[</span><span class=s>'OA11CD list'</span><span class=p>]</span></code></pre></figure><p>Finally we just need to output the data:</p><figure class=highlight><pre><code class=language-python data-lang=python>    <span class=k>for</span> <span class=n>d</span> <span class=ow>in</span> <span class=n>data</span><span class=o>.</span><span class=n>values</span><span class=p>():</span>

     <span class=n>d</span><span class=p>[</span><span class=s>'PCON11CD list'</span><span class=p>]</span> <span class=o>=</span> <span class=s>';'</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>d</span><span class=p>[</span><span class=s>'PCON11CD list'</span><span class=p>])</span>
     <span class=n>d</span><span class=p>[</span><span class=s>'PCON11NM list'</span><span class=p>]</span> <span class=o>=</span> <span class=s>';'</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>d</span><span class=p>[</span><span class=s>'PCON11NM list'</span><span class=p>])</span>

    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s>'output.csv'</span><span class=p>,</span> <span class=s>'w'</span><span class=p>)</span> <span class=k>as</span> <span class=n>out_file</span><span class=p>:</span>
      <span class=n>writer</span> <span class=o>=</span> <span class=n>csv</span><span class=o>.</span><span class=n>DictWriter</span><span class=p>(</span><span class=n>out_file</span><span class=p>,</span> <span class=p>[</span><span class=s>'CCG13CD'</span><span class=p>,</span> <span class=s>'CCG13NM'</span><span class=p>,</span> <span class=s>'PCON11CD list'</span><span class=p>,</span> <span class=s>'PCON11NM list'</span><span class=p>])</span>
      <span class=n>writer</span><span class=o>.</span><span class=n>writeheader</span><span class=p>()</span>
      <span class=n>writer</span><span class=o>.</span><span class=n>writerows</span><span class=p>(</span><span class=n>data</span><span class=o>.</span><span class=n>values</span><span class=p>())</span></code></pre></figure><p>Run the script, and we get a nice CSV with one row for each CCG, each row containing a list of the WPC ids and names the CCG covers.</p><p>Of course, this data only covers England (as CCGs are a division in NHS England). Although there don’t seem to be lookups for OAs to Health Boards in Scotland, or from OAs to Local Health Boards in Wales, it should still be possible to do something similar for these countries using Parliamentary Wards as the intermediate geography, as lookups for Wards to Health Boards and Local Health Boards are available. It’s also not immediately clear how well the boundaries for CCGs and WPCs match up, that would require further investigation, depending on what the lookup is to be used for.</p><p>All the code, input and output for this task is available on <a href=https://github.com/martinjc/CCG--Constituencies>my github page</a>.</p></div><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://martinjc.com/2014/09/15/ccgs-and-wpcs-via-the-medium-of-oas/",this.page.identifier="ccgs-and-wpcs-via-the-medium-of-oas"};!function(){var t=document,e=t.createElement("script");e.src="https://martinjc.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></article></div><script>!function(e,t,a,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=t.createElement(a),s=t.getElementsByTagName(a)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-25500481-1","auto"),ga("send","pageview")</script></body></html>