<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#b100b2">
    <meta name="theme-color" content="#b100b2">

    <meta property="og:url" content="https://martinjc.com/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Martin Chorley">
    <meta property="og:site_name" content="Martin Chorley">
    <meta property="og:locale" content="en_GB">
    <meta property="article:author" content="Martin Chorley">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:creator" content="@martinjc">
    <meta name="twitter:url" content="https://martinjc.com">
    <meta name="twitter:title" content="Martin Chorley">

    <link rel="icon" href="/img/favicon.png">
    <link href="https://fonts.googleapis.com/css?family=Roboto|Scope+One" rel="stylesheet">
    <link rel="stylesheet" href="/css/main.css">
</head><body><header>
    <div class="social">
        <ul>
            <li><a href="https://www.twitter.com/martinjc" class="icon twitter" title="Twitter"><svg viewBox="0 0 512 512">
                        <path d="M419.6 168.6c-11.7 5.2-24.2 8.7-37.4 10.2 13.4-8.1 23.8-20.8 28.6-36 -12.6 7.5-26.5 12.9-41.3 15.8 -11.9-12.6-28.8-20.6-47.5-20.6 -42 0-72.9 39.2-63.4 79.9 -54.1-2.7-102.1-28.6-134.2-68 -17 29.2-8.8 67.5 20.1 86.9 -10.7-0.3-20.7-3.3-29.5-8.1 -0.7 30.2 20.9 58.4 52.2 64.6 -9.2 2.5-19.2 3.1-29.4 1.1 8.3 25.9 32.3 44.7 60.8 45.2 -27.4 21.4-61.8 31-96.4 27 28.8 18.5 63 29.2 99.8 29.2 120.8 0 189.1-102.1 185-193.6C399.9 193.1 410.9 181.7 419.6 168.6z" /></svg>
                    </a></li>
            <li><a href="mailto:ChorleyMJ@Cardiff.ac.uk" class="icon email" title="Email"><svg viewBox="0 0 512 512">
                        <path d="M101.3 141.6v228.9h0.3 308.4 0.8V141.6H101.3zM375.7 167.8l-119.7 91.5 -119.6-91.5H375.7zM127.6 194.1l64.1 49.1 -64.1 64.1V194.1zM127.8 344.2l84.9-84.9 43.2 33.1 43-32.9 84.7 84.7L127.8 344.2 127.8 344.2zM384.4 307.8l-64.4-64.4 64.4-49.3V307.8z" /></svg>
                    </a></li>
            <li><a href="https://www.facebook.com/martin.chorley" class="icon facebook" title="Facebook"><svg viewBox="0 0 512 512">
                        <path d="M211.9 197.4h-36.7v59.9h36.7V433.1h70.5V256.5h49.2l5.2-59.1h-54.4c0 0 0-22.1 0-33.7 0-13.9 2.8-19.5 16.3-19.5 10.9 0 38.2 0 38.2 0V82.9c0 0-40.2 0-48.8 0 -52.5 0-76.1 23.1-76.1 67.3C211.9 188.8 211.9 197.4 211.9 197.4z" /></svg>
                    </a></li>
            <li><a href="https://www.github.com/martinjc" class="icon github" title="GitHub"><svg viewBox="0 0 512 512">
                        <path d="M256 70.7c-102.6 0-185.9 83.2-185.9 185.9 0 82.1 53.3 151.8 127.1 176.4 9.3 1.7 12.3-4 12.3-8.9V389.4c-51.7 11.3-62.5-21.9-62.5-21.9 -8.4-21.5-20.6-27.2-20.6-27.2 -16.9-11.5 1.3-11.3 1.3-11.3 18.7 1.3 28.5 19.2 28.5 19.2 16.6 28.4 43.5 20.2 54.1 15.4 1.7-12 6.5-20.2 11.8-24.9 -41.3-4.7-84.7-20.6-84.7-91.9 0-20.3 7.3-36.9 19.2-49.9 -1.9-4.7-8.3-23.6 1.8-49.2 0 0 15.6-5 51.1 19.1 14.8-4.1 30.7-6.2 46.5-6.3 15.8 0.1 31.7 2.1 46.6 6.3 35.5-24 51.1-19.1 51.1-19.1 10.1 25.6 3.8 44.5 1.8 49.2 11.9 13 19.1 29.6 19.1 49.9 0 71.4-43.5 87.1-84.9 91.7 6.7 5.8 12.8 17.1 12.8 34.4 0 24.9 0 44.9 0 51 0 4.9 3 10.7 12.4 8.9 73.8-24.6 127-94.3 127-176.4C441.9 153.9 358.6 70.7 256 70.7z" /></svg>
                    </a></li>
            <li><a href="https://www.instagram.com/martinjam" class="icon instagram" title="Instagram"><svg viewBox="0 0 512 512">
                        <g>
                            <path d="M256 109.3c47.8 0 53.4 0.2 72.3 1 17.4 0.8 26.9 3.7 33.2 6.2 8.4 3.2 14.3 7.1 20.6 13.4 6.3 6.3 10.1 12.2 13.4 20.6 2.5 6.3 5.4 15.8 6.2 33.2 0.9 18.9 1 24.5 1 72.3s-0.2 53.4-1 72.3c-0.8 17.4-3.7 26.9-6.2 33.2 -3.2 8.4-7.1 14.3-13.4 20.6 -6.3 6.3-12.2 10.1-20.6 13.4 -6.3 2.5-15.8 5.4-33.2 6.2 -18.9 0.9-24.5 1-72.3 1s-53.4-0.2-72.3-1c-17.4-0.8-26.9-3.7-33.2-6.2 -8.4-3.2-14.3-7.1-20.6-13.4 -6.3-6.3-10.1-12.2-13.4-20.6 -2.5-6.3-5.4-15.8-6.2-33.2 -0.9-18.9-1-24.5-1-72.3s0.2-53.4 1-72.3c0.8-17.4 3.7-26.9 6.2-33.2 3.2-8.4 7.1-14.3 13.4-20.6 6.3-6.3 12.2-10.1 20.6-13.4 6.3-2.5 15.8-5.4 33.2-6.2C202.6 109.5 208.2 109.3 256 109.3M256 77.1c-48.6 0-54.7 0.2-73.8 1.1 -19 0.9-32.1 3.9-43.4 8.3 -11.8 4.6-21.7 10.7-31.7 20.6 -9.9 9.9-16.1 19.9-20.6 31.7 -4.4 11.4-7.4 24.4-8.3 43.4 -0.9 19.1-1.1 25.2-1.1 73.8 0 48.6 0.2 54.7 1.1 73.8 0.9 19 3.9 32.1 8.3 43.4 4.6 11.8 10.7 21.7 20.6 31.7 9.9 9.9 19.9 16.1 31.7 20.6 11.4 4.4 24.4 7.4 43.4 8.3 19.1 0.9 25.2 1.1 73.8 1.1s54.7-0.2 73.8-1.1c19-0.9 32.1-3.9 43.4-8.3 11.8-4.6 21.7-10.7 31.7-20.6 9.9-9.9 16.1-19.9 20.6-31.7 4.4-11.4 7.4-24.4 8.3-43.4 0.9-19.1 1.1-25.2 1.1-73.8s-0.2-54.7-1.1-73.8c-0.9-19-3.9-32.1-8.3-43.4 -4.6-11.8-10.7-21.7-20.6-31.7 -9.9-9.9-19.9-16.1-31.7-20.6 -11.4-4.4-24.4-7.4-43.4-8.3C310.7 77.3 304.6 77.1 256 77.1L256 77.1z" />
                            <path d="M256 164.1c-50.7 0-91.9 41.1-91.9 91.9s41.1 91.9 91.9 91.9 91.9-41.1 91.9-91.9S306.7 164.1 256 164.1zM256 315.6c-32.9 0-59.6-26.7-59.6-59.6s26.7-59.6 59.6-59.6 59.6 26.7 59.6 59.6S288.9 315.6 256 315.6z" />
                            <circle cx="351.5" cy="160.5" r="21.5" />
                        </g>
                    </svg>
                    </a></li>
            <li><a href="https://www.last.fm/user/takitomouse" class="icon lastfm" title="Last.fm"><svg viewBox="0 0 512 512">
                        <path d="M230.104 336.568l-13.607-36.988c0 0-22.11 24.66-55.268 24.66 -29.341 0-50.172-25.512-50.172-66.328 0-52.293 26.359-71.001 52.297-71.001 37.412 0 49.316 24.234 59.522 55.273l13.607 42.518c13.603 41.236 39.113 74.402 112.666 74.402 52.727 0 88.437-16.155 88.437-58.672 0-34.438-19.56-52.297-56.125-60.802l-27.209-5.951c-18.707-4.252-24.233-11.906-24.233-24.659 0-14.456 11.478-22.96 30.189-22.96 20.406 0 31.458 7.653 33.162 25.935l42.516-5.103c-3.402-38.263-29.761-53.996-73.127-53.996 -38.266 0-75.68 14.456-75.68 60.799 0 28.912 14.029 47.197 49.315 55.697l28.916 6.801c21.683 5.104 28.908 14.031 28.908 26.363 0 15.73-15.305 22.107-44.218 22.107 -42.941 0-60.794-22.534-70.999-53.574l-14.032-42.513c-17.854-55.271-46.342-75.68-102.892-75.68 -62.499-0.001-95.663 39.538-95.663 106.715 0 64.628 33.164 99.489 92.689 99.489C207.141 359.1 230.104 336.568 230.104 336.568L230.104 336.568z" /></svg>
                    </a></li>
            <li><a href="https://uk.linkedin.com/in/martinchorley" class="icon linkedin" title="LinkedIn"><svg viewBox="0 0 512 512">
                        <path d="M186.4 142.4c0 19-15.3 34.5-34.2 34.5 -18.9 0-34.2-15.4-34.2-34.5 0-19 15.3-34.5 34.2-34.5C171.1 107.9 186.4 123.4 186.4 142.4zM181.4 201.3h-57.8V388.1h57.8V201.3zM273.8 201.3h-55.4V388.1h55.4c0 0 0-69.3 0-98 0-26.3 12.1-41.9 35.2-41.9 21.3 0 31.5 15 31.5 41.9 0 26.9 0 98 0 98h57.5c0 0 0-68.2 0-118.3 0-50-28.3-74.2-68-74.2 -39.6 0-56.3 30.9-56.3 30.9v-25.2H273.8z" /></svg>
                    </a></li>
        </ul>
    </div>


    <nav>
        <ul>|
            <li><a href="/">&nbsp;home</a>&nbsp;|</li>
            <li><a href="/blog">&nbsp;blog</a>&nbsp;|</li>
            <li><a href="/teaching">&nbsp;teaching</a>&nbsp;|</li>
            <li><a href="/research">&nbsp;research</a>&nbsp;|</li>
            <li><a href="/publications">&nbsp;publications</a>&nbsp;|</li>
        </ul>
    </nav>
</header><div id="content">
<main>
    

<ul class="pagination">
    
    <li class="page-item">
        <a href="/blog/" class="page-link" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
    </li>
    
    <li class="page-item">
    <a href="/blog/page/2/" class="page-link" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
    </li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/blog/">1</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/blog/page/2/">2</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item active"><a class="page-link" href="/blog/page/3/">3</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/blog/page/4/">4</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item disabled"><span aria-hidden="true">&nbsp;&hellip;&nbsp;</span></li>
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/blog/page/11/">11</a></li>
    
    
    <li class="page-item">
    <a href="/blog/page/4/" class="page-link" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
    </li>
    
    <li class="page-item">
        <a href="/blog/page/11/" class="page-link" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
    </li>
    
</ul>

    
    <article class="blogpost">
        <header>
            <h1> <a href="https://martinjc.com/2014/11/19/quick-and-dirty-twitter-api-in-python/">
                    Quick and Dirty Twitter API in Python
                </a></h1>
            <p class="author">
                <span class="date">Wednesday, Nov 19, 2014</span>
            </p>
        </header>
        <div class="content">
            <p><strong>QUICK DISCLAIMER: this is a quick and dirty solution to a problem, so may not represent best coding practice, and has absolutely no error checking or handling. Use with caution&hellip;</strong></p>

<p>A recent project has needed me to scrape some data from Twitter. I considered using <a href="https://github.com/tweepy/tweepy">Tweepy</a>, but as it was a project for the <a href="compj.cs.cf.ac.uk">MSc in Computational Journalism</a>, I thought it would be more interesting to write our own simple Twitter API wrapper in Python.</p>

<p>The code presented here will allow you to make any API request to Twitter that uses a GET request, so is really only useful for getting data <em>from</em> Twitter, not sending it <em>to</em> Twitter. It is also only for using with the REST API, not the streaming API, so if you&rsquo;re looking for realtime monitoring, this is not the API wrapper you&rsquo;re looking for. This API wrapper also uses a single user&rsquo;s authentication (yours), so is not setup to allow other users to use Twitter through your application.</p>

<p>The first step is to get some access credentials from Twitter. Head over to <a href="https://apps.twitter.com/">https://apps.twitter.com/</a> and register a new application. Once the application is created, you&rsquo;ll be able to access its details. Under &lsquo;Keys and Access Tokens&rsquo; are four values we&rsquo;re going to need for the API - the  <code>Consumer Key</code> and <code>Consumer Secret</code>, and the <code>Access Token</code> and <code>Access Token Secret</code>. Copy all four values into a new python file, and save it as &lsquo;<code>_credentials.py</code>&rsquo;. Once we have the credentials, we can write some code to make some API requests!</p>

<p>First, we define a Twitter API object that will carry out our API requests. We need to store the API url, and some details to allow us to throttle our requests to Twitter to fit inside their rate limiting.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Twitter_API</span>:

 <span style="color:#66d9ef">def</span> __init__(self):

   <span style="color:#75715e"># URL for accessing API</span>
   scheme <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://&#34;</span>
   api_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;api.twitter.com&#34;</span>
   version <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;1.1&#34;</span>

   self<span style="color:#f92672">.</span>api_base <span style="color:#f92672">=</span> scheme <span style="color:#f92672">+</span> api_url <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/&#34;</span> <span style="color:#f92672">+</span> version

   <span style="color:#75715e">#</span>
   <span style="color:#75715e"># seconds between queries to each endpoint</span>
   <span style="color:#75715e"># queries in this project limited to 180</span>
   <span style="color:#75715e"># per 15 minutes</span>
   query_interval <span style="color:#f92672">=</span> float(<span style="color:#ae81ff">15</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span>)<span style="color:#f92672">/</span>(<span style="color:#ae81ff">175</span>)

   <span style="color:#75715e">#</span>
   <span style="color:#75715e"># rate limiting timer</span>
   self<span style="color:#f92672">.</span>__monitor <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;wait&#39;</span>:query_interval,
     <span style="color:#e6db74">&#39;earliest&#39;</span>:None,
     <span style="color:#e6db74">&#39;timer&#39;</span>:None}</code></pre></div>

<p>We add a rate limiting method that will make our API sleep if we are requesting things from Twitter too fast:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#</span>
<span style="color:#75715e"># rate_controller puts the thread to sleep</span>
<span style="color:#75715e"># if we&#39;re hitting the API too fast</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__rate_controller</span>(self, monitor_dict):

 <span style="color:#75715e">#</span>
 <span style="color:#75715e"># join the timer thread</span>
 <span style="color:#66d9ef">if</span> monitor_dict[<span style="color:#e6db74">&#39;timer&#39;</span>] <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None:
 monitor_dict[<span style="color:#e6db74">&#39;timer&#39;</span>]<span style="color:#f92672">.</span>join()

 <span style="color:#75715e"># sleep if necessary</span>
 <span style="color:#66d9ef">while</span> time<span style="color:#f92672">.</span>time() <span style="color:#f92672">&lt;</span> monitor_dict[<span style="color:#e6db74">&#39;earliest&#39;</span>]:
   time<span style="color:#f92672">.</span>sleep(monitor_dict[<span style="color:#e6db74">&#39;earliest&#39;</span>] <span style="color:#f92672">-</span> time<span style="color:#f92672">.</span>time())

 <span style="color:#75715e"># work out then the next API call can be made</span>
 earliest <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time() <span style="color:#f92672">+</span> monitor_dict[<span style="color:#e6db74">&#39;wait&#39;</span>]
 timer <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Timer( earliest<span style="color:#f92672">-</span>time<span style="color:#f92672">.</span>time(), <span style="color:#66d9ef">lambda</span>: None )
 monitor_dict[<span style="color:#e6db74">&#39;earliest&#39;</span>] <span style="color:#f92672">=</span> earliest
 monitor_dict[<span style="color:#e6db74">&#39;timer&#39;</span>] <span style="color:#f92672">=</span> timer
 monitor_dict[<span style="color:#e6db74">&#39;timer&#39;</span>]<span style="color:#f92672">.</span>start()</code></pre></div>

<p>The Twitter API requires us to supply authentication headers in the request. One of these headers is a signature, created by encoding details of the request. We can write a function that will take in all the details of the request (method, url, parameters) and create the signature:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#</span>
<span style="color:#75715e"># make the signature for the API request</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_signature</span>(self, method, url, params):

 <span style="color:#75715e"># escape special characters in all parameter keys</span>
 encoded_params <span style="color:#f92672">=</span> {}
 <span style="color:#66d9ef">for</span> k, v <span style="color:#f92672">in</span> params<span style="color:#f92672">.</span>items():
   encoded_k <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(str(k))
   encoded_v <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(str(v))
   encoded_params[encoded_k] <span style="color:#f92672">=</span> encoded_v

 <span style="color:#75715e"># sort the parameters alphabetically by key</span>
 sorted_keys <span style="color:#f92672">=</span> sorted(encoded_params<span style="color:#f92672">.</span>keys())

 <span style="color:#75715e"># create a string from the parameters</span>
 signing_string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>

 count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
 <span style="color:#66d9ef">for</span> key <span style="color:#f92672">in</span> sorted_keys:
   signing_string <span style="color:#f92672">+=</span> key
   signing_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;=&#34;</span>
   signing_string <span style="color:#f92672">+=</span> encoded_params[key]
   count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
   <span style="color:#66d9ef">if</span> count <span style="color:#f92672">&lt;</span> len(sorted_keys):
     signing_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;&amp;&#34;</span>

 <span style="color:#75715e"># construct the base string</span>
 base_string <span style="color:#f92672">=</span> method<span style="color:#f92672">.</span>upper()
 base_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;&amp;&#34;</span>
 base_string <span style="color:#f92672">+=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(url)
 base_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;&amp;&#34;</span>
 base_string <span style="color:#f92672">+=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(signing_string)

 <span style="color:#75715e"># construct the key</span>
 signing_key <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(client_secret) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&amp;&#34;</span> <span style="color:#f92672">+</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(access_secret)

 <span style="color:#75715e"># encrypt the base string with the key, and base64 encode the result</span>
 hashed <span style="color:#f92672">=</span> hmac<span style="color:#f92672">.</span>new(signing_key<span style="color:#f92672">.</span>encode(), base_string<span style="color:#f92672">.</span>encode(), sha1)
 signature <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>b64encode(hashed<span style="color:#f92672">.</span>digest())
 <span style="color:#66d9ef">return</span> signature<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>)</code></pre></div>

<p>Finally, we can write a method to actually <em>make</em> the API request:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">query_get</span>(self, endpoint, aspect, get_params<span style="color:#f92672">=</span>{}):

 <span style="color:#75715e">#</span>
 <span style="color:#75715e"># rate limiting</span>
 self<span style="color:#f92672">.</span>__rate_controller(self<span style="color:#f92672">.</span>__monitor)

 <span style="color:#75715e"># ensure we&#39;re dealing with strings as parameters</span>
 str_param_data <span style="color:#f92672">=</span> {}
 <span style="color:#66d9ef">for</span> k, v <span style="color:#f92672">in</span> get_params<span style="color:#f92672">.</span>items():
   str_param_data[str(k)] <span style="color:#f92672">=</span> str(v)

 <span style="color:#75715e"># construct the query url</span>
 url <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>api_base <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/&#34;</span> <span style="color:#f92672">+</span> endpoint <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/&#34;</span> <span style="color:#f92672">+</span> aspect <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.json&#34;</span>

 <span style="color:#75715e"># add the header parameters for authorisation</span>
 header_parameters <span style="color:#f92672">=</span> {
   <span style="color:#e6db74">&#34;oauth_consumer_key&#34;</span>: client_id,
   <span style="color:#e6db74">&#34;oauth_nonce&#34;</span>: uuid<span style="color:#f92672">.</span>uuid4(),
   <span style="color:#e6db74">&#34;oauth_signature_method&#34;</span>: <span style="color:#e6db74">&#34;HMAC-SHA1&#34;</span>,
   <span style="color:#e6db74">&#34;oauth_timestamp&#34;</span>: time<span style="color:#f92672">.</span>time(),
   <span style="color:#e6db74">&#34;oauth_token&#34;</span>: access_token,
   <span style="color:#e6db74">&#34;oauth_version&#34;</span>: <span style="color:#ae81ff">1.0</span>
 }

 <span style="color:#75715e"># collect all the parameters together for creating the signature</span>
 signing_parameters <span style="color:#f92672">=</span> {}
 <span style="color:#66d9ef">for</span> k, v <span style="color:#f92672">in</span> header_parameters<span style="color:#f92672">.</span>items():
   signing_parameters[k] <span style="color:#f92672">=</span> v
 <span style="color:#66d9ef">for</span> k, v <span style="color:#f92672">in</span> str_param_data<span style="color:#f92672">.</span>items():
   signing_parameters[k] <span style="color:#f92672">=</span> v

 <span style="color:#75715e"># create the signature and add it to the header parameters</span>
 header_parameters[<span style="color:#e6db74">&#34;oauth_signature&#34;</span>] <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>get_signature(<span style="color:#e6db74">&#34;GET&#34;</span>, url, signing_parameters)

 <span style="color:#75715e"># add the OAuth headers</span>
 header_string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;OAuth &#34;</span>
 count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
 <span style="color:#66d9ef">for</span> k, v <span style="color:#f92672">in</span> header_parameters<span style="color:#f92672">.</span>items():
   header_string <span style="color:#f92672">+=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(str(k))
   header_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;=</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">&#34;</span>
   header_string <span style="color:#f92672">+=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(str(v))
   header_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">&#34;</span>
   count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
   <span style="color:#66d9ef">if</span> count <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">7</span>:
     header_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;, &#34;</span>

 headers <span style="color:#f92672">=</span> {
   <span style="color:#e6db74">&#34;Authorization&#34;</span>: header_string
 }

 <span style="color:#75715e"># create the full url including parameters</span>
 url <span style="color:#f92672">=</span> url <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;?&#34;</span> <span style="color:#f92672">+</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>urlencode(str_param_data)
 request <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>request<span style="color:#f92672">.</span>Request(url, headers<span style="color:#f92672">=</span>headers)

 <span style="color:#75715e"># make the API request</span>
 <span style="color:#66d9ef">try</span>:
   response <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>request<span style="color:#f92672">.</span>urlopen(request)
   <span style="color:#66d9ef">except</span> urllib<span style="color:#f92672">.</span>error<span style="color:#f92672">.</span>HTTPError <span style="color:#66d9ef">as</span> e:
   <span style="color:#66d9ef">print</span>(e)
 <span style="color:#66d9ef">raise</span> e
   <span style="color:#66d9ef">except</span> urllib<span style="color:#f92672">.</span>error<span style="color:#f92672">.</span>URLError <span style="color:#66d9ef">as</span> e:
   <span style="color:#66d9ef">print</span>(e)
   <span style="color:#66d9ef">raise</span> e

 <span style="color:#75715e"># read the response and return the json</span>
 raw_data <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>)
 <span style="color:#66d9ef">return</span> json<span style="color:#f92672">.</span>loads(raw_data)</code></pre></div>

<p>Putting this all together, we have a simple Python class that acts as an API wrapper for GET requests to the Twitter REST API, including the signing and authentication of those requests. Using it is as simple as:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"> ta <span style="color:#f92672">=</span> Twitter_API()

 <span style="color:#75715e"># retrieve tweets for a user</span>
 params <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#34;screen_name&#34;</span>: <span style="color:#e6db74">&#34;martinjc&#34;</span>,
 }

 user_tweets <span style="color:#f92672">=</span> ta<span style="color:#f92672">.</span>query_get(<span style="color:#e6db74">&#34;statuses&#34;</span>, <span style="color:#e6db74">&#34;user_timeline&#34;</span>, params)</code></pre></div>

<p>As always, the full code is online on Github, in both my <a href="https://github.com/CompJCDF/Simple-Python-Twitter-API">personal account</a> and the <a href="https://github.com/CompJCDF">account for</a> the <a href="http://compj.cs.cf.ac.uk/">MSc Computational Journalism</a>.</p>

        </div>
    </article>
    
    <article class="blogpost">
        <header>
            <h1> <a href="https://martinjc.com/2014/11/04/how-do-people-decide-whether-or-not-to-read-a-tweet/">
                    How do people decide whether or not to read a tweet? 
                </a></h1>
            <p class="author">
                <span class="date">Tuesday, Nov 4, 2014</span>
            </p>
        </header>
        <div class="content">
            <p>It turns out that an existing relationship with the author of the tweet is one of the main factors influencing how someone decides whether or not to read a tweet. At the same time,  a large number associated with a tweet can also make the tweet more attractive to readers.</p>

<p>Our <a href="http://www.sciencedirect.com/science/article/pii/S1071581914001268">latest Open Access research</a> has discovered how much effect the information about a tweet has on whether people decide to read it or not.</p>

<p>By showing hundreds of Twitter users the information about two tweets but not the tweets themselves, and then asking the users which tweet they would like to read, we have been able to look at which information is more important when users are deciding to read a tweet.</p>

<p>We looked at two different types of information:</p>

<ol>
<li><p>Simple numbers that describe the tweet, such as the number of retweets it has, or numbers that describe the author, such as how many followers they have, or how many tweets they&rsquo;ve written.</p></li>

<li><p>Whether a relationship between the reader and the author is important, and whether that relationship was best shown through subtle hints, or direct information.</p></li>
</ol>

<p>When readers can see only one piece of information, the case is clear: they&rsquo;d <strong>rather read the tweet written by someone they are following</strong>. Readers can easily recognise the usernames, names, and profile images of people they already follow, and are likely to choose to read content written by someone they follow (instead of content written by a stranger) around 75% of the time. If all they can see is a piece of numerical information, they would <strong>rather read the tweet with the highest number</strong>, no matter what that number is. The effect is strongest with the number of retweets, followed by the number of followers, but even for the number of following and number of tweets written the effect is significant.</p>

<p>When readers can see two pieces of information, one about their relationship with the author, and one numerical, there are two cases to look at. When the author they follow also has a high numerical value, readers will choose that tweet in around 80% of the cases. When the author they already follow has a lower numerical value, it is still the existing relationship that is more of a draw. <strong>Readers would rather read a tweet from someone they know that has a low number of retweets, than one from a stranger with a high number of retweets.</strong></p>

<p>This work offers an understanding of how the decision-making process works on Twitter when users are skimming their timelines for something to read, and has particular implications for the display and promotion of non-timeline content within content streams. For instance, readers may pay more attention to adverts and promoted content if the link between themselves and the author is highlighted.</p>

<p><a href="http://ieeexplore.ieee.org/xpl/articleDetails.jsp?arnumber=6406256">Previous results</a>  from an early experiment were published at <a href="/2012/09/07/socialcom-2012/">SocialCom</a>. The results in <a href="http://www.sciencedirect.com/science/article/pii/S1071581914001268">this new paper</a> are from a modified and expanded version of <a href="/2012/05/18/tweetcues-twitter-experiment/">this earlier experiment</a>.</p>

        </div>
    </article>
    
    <article class="blogpost">
        <header>
            <h1> <a href="https://martinjc.com/2014/11/01/beards-taches-and-testicles/">
                    Beards, &#39;Taches and Testicles
                </a></h1>
            <p class="author">
                <span class="date">Saturday, Nov 1, 2014</span>
            </p>
        </header>
        <div class="content">
            <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>This is me:</p>










<figure>
    <img src="/2014/11/01/beards-taches-and-testicles/2014-11-01-07.23.46-copy-225x300.jpg" width="225" height="300" alt="mildly hungover morning selfie">
    <figcaption>
        <small>
            mildly hungover morning selfie
        </small>
    </figcaption>
</figure>

<p>Obviously the first thing you notice, after my devilishly handsome good looks, is that I have around the lower half of my face what has the potential to be described as,  if one is kind: a &lsquo;beard&rsquo;. It is patchy, it is more than often unkempt, and it is quite ginger, but it is somewhat beard like. I can no longer remember when I grew this beard, but I like it. I like it so much that I refused to shave it off when I graduated in 2013, and again when I got married earlier this year.</p>

<p>However, ominous things have happened. Recently, a mate and colleague done a tweet:</p>

<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">I beat testicular cancer this year. To contribute to research I&#39;m supporting <a href="https://twitter.com/MovemberUK">@MovemberUK</a> - join the team <a href="http://t.co/7mtTE7kVmD">http://t.co/7mtTE7kVmD</a> <a href="https://twitter.com/cardiffuni">@cardiffuni</a></p>&mdash; Pete Burnap (@pbFeed) <a href="https://twitter.com/pbFeed/status/524291166615789570">October 20, 2014</a></blockquote>

<p>&ldquo;Good on Pete&rdquo; I thought. Good cause. I did Movember back in 2011, and it was hard, because quite frankly with a moustache I look like a complete tit. At the time I was doing it, I think Pete and I were sharing an office, so he knows how much of a tit you can look like during Movember, yet he&rsquo;s chosen to do it anyway. Well done.</p>

<p>Of course, you won&rsquo;t catch me doing it. I have a beard now, and I won&rsquo;t shave that off. Also, as I mentioned, I look like a complete tit when I grow a moustache. It was fine in 2011, I was only an RA, so I could just hide in the office and work. The only person affected was my wife, who sadly had to be seen in public with me. I&rsquo;m a lecturer now. I can&rsquo;t just hide in my office. I have to teach. I have to stand up in front of students. I can&rsquo;t do that looking like a person who belongs on some sort of list.</p>

<p>Then Vince Knight joined Pete&rsquo;s team:</p>

<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">I am now apparently putting my facial hair to the test and have joined <a href="https://twitter.com/pbFeed">@pbFeed</a> for <a href="https://twitter.com/MovemberUK">@MovemberUK</a>. My page is here: <a href="http://t.co/IswbUL7sEG">http://t.co/IswbUL7sEG</a></p>&mdash; Vincent Knight 📎 (@drvinceknight) <a href="https://twitter.com/drvinceknight/status/524532773080805376">October 21, 2014</a></blockquote>

<p>&ldquo;Well done Vince&rdquo; I thought. Good cause. At least Pete won&rsquo;t look so daft walking around campus with a &lsquo;tache now. There&rsquo;ll be two of you at least. Not me of course. No way.</p>

<p>Then Pete done another tweet:</p>

<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/drvinceknight">@drvinceknight</a> <a href="https://twitter.com/MovemberUK">@MovemberUK</a> Yeah you have!!! <a href="https://twitter.com/voxmjw">@voxmjw</a> <a href="https://twitter.com/martinjc">@martinjc</a> <a href="https://twitter.com/walter_colombo1">@walter_colombo1</a> <a href="https://twitter.com/MattLWilliams">@MattLWilliams</a> <a href="https://twitter.com/docjaq">@docjaq</a> <a href="https://twitter.com/flyingSparx">@flyingSparx</a> Get involved!!</p>&mdash; Pete Burnap (@pbFeed) <a href="https://twitter.com/pbFeed/status/524533385847664640">October 21, 2014</a></blockquote>

<p>Oh.</p>

<p>Pete&rsquo;s called me out. He wants me to join in. Maybe we&rsquo;ll just all ignore him and it&rsquo;ll go away.</p>

<p>Then I done a tweet:</p>

<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/pbFeed">@pbFeed</a> <a href="https://twitter.com/drvinceknight">@drvinceknight</a> <a href="https://twitter.com/voxmjw">@voxmjw</a> <a href="https://twitter.com/walter_colombo1">@walter_colombo1</a> <a href="https://twitter.com/MattLWilliams">@MattLWilliams</a> <a href="https://twitter.com/docjaq">@docjaq</a> <a href="https://twitter.com/flyingSparx">@flyingSparx</a> hard to say no, I did look fabulous last time.</p>&mdash; Martin Chorley (@martinjc) <a href="https://twitter.com/martinjc/status/524538880939544576">October 21, 2014</a></blockquote>

<p>WTF? What did I just do? Did I agree to do Movember again? Why? I have no idea. Perhaps I enjoy looking like a tit?</p>

<p>So. I joined. As did many others that Pete called out. And now we&rsquo;re all going to grow moustaches and demand money from our friends, relatives and colleagues. It&rsquo;s a good cause. You can donate to us, our team page is <a href="http://uk.movember.com/team/1637929">here</a>.</p>

<p>First though, there&rsquo;s business to take care of. The beard had to go. I had to locate my shaving equipment, which has not been used in many years, and attempt to remove the lovely facial hair to which I have become so attached, without slicing my face apart in the process:</p>










<figure>
    <img src="/2014/11/01/beards-taches-and-testicles/beard_removal-1024x910.png" width="1024" height="910" alt="WHAT HAVE I DONE?">
    <figcaption>
        <small>
            WHAT HAVE I DONE?
        </small>
    </figcaption>
</figure>

<p>So that&rsquo;s it. The beard is off and I am clean-shaven for the first time in I don&rsquo;t know how long. This, I think, is quite the sacrifice. But there is more to come. The &lsquo;tache is on its way - slowly working its way out of my upper lip. I am going to look terrible. If you in any way feel inclined, please make it worth it. Donate to <a href="http://mobro.co/martinjc">me</a> or the <a href="http://moteam.co/cardiff-university">team</a>. Don&rsquo;t let my beard have fallen in vain.  After all (I came up with this last night while very drunk and I LOVE IT):  beards grow back. Balls don&rsquo;t.</p>

        </div>
    </article>
    
    <article class="blogpost">
        <header>
            <h1> <a href="https://martinjc.com/2014/10/03/computational-journalism-a-manifesto/">
                    Computational Journalism - &#39;a Manifesto&#39;
                </a></h1>
            <p class="author">
                <span class="date">Friday, Oct 3, 2014</span>
            </p>
        </header>
        <div class="content">
            <p>While Glyn and I have been discussing the new MSc course between ourselves and with others, we have repeatedly come up with the same issues and themes, again and again. As a planning exercise earlier in the summer, we gathered some of these together into a &lsquo;manifesto&rsquo;.</p>

<p>The manifesto is online on our main &lsquo;<a href="http://compj.cs.cf.ac.uk">Computational Journalism</a>&rsquo; website with a <a href="http://compj.cs.cf.ac.uk/2014/09/26/computational-journalism-the-manifesto/">bit of extra commentary</a>.</p>

        </div>
    </article>
    
    <article class="blogpost">
        <header>
            <h1> <a href="https://martinjc.com/2014/09/17/geojson-and-topojson-for-uk-boundaries/">
                    GeoJSON and topoJSON for UK boundaries
                </a></h1>
            <p class="author">
                <span class="date">Wednesday, Sep 17, 2014</span>
            </p>
        </header>
        <div class="content">
            <p>I&rsquo;ve just put an archive online containing GeoJSON and topoJSON for UK boundary data. It&rsquo;s all stored on <a href="https://github.com/martinjc/UK-GeoJSON">Github</a>, with a viewer and download site hosted on <a href="http://martinjc.github.io/UK-GeoJSON/">Github pages</a>.</p>










<figure>
    <img src="/2014/09/17/geojson-and-topojson-for-uk-boundaries/Screenshot-2014-09-16-11.08.37-1008x1024.png" width="1008" height="1024" alt="Browser for the UK topoJSON stored in the Github repository">
    <figcaption>
        <small>
            Browser for the UK topoJSON stored in the Github repository
        </small>
    </figcaption>
</figure>

<p>The data is all created from shapefiles released by the Office of National Statistics, Ordnance Survey and National Records Scotland, all under the <a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/">Open Government</a> and <a href="http://www.ordnancesurvey.co.uk/docs/licences/os-opendata-licence.pdf">OS OpenData</a> licences.</p>

<p>In later posts I&rsquo;ll detail how I created the files, and how to use them to create interactive choropleth maps.</p>

        </div>
    </article>
    
    <article class="blogpost">
        <header>
            <h1> <a href="https://martinjc.com/2014/09/15/ccgs-and-wpcs-via-the-medium-of-oas/">
                    CCGs and WPCs via the medium of OAs
                </a></h1>
            <p class="author">
                <span class="date">Monday, Sep 15, 2014</span>
            </p>
        </header>
        <div class="content">
            <p>As I was eating lunch this afternoon, I spotted a conversation between <a href="https://twitter.com/joereddington">@JoeReddington</a> and <a href="https://twitter.com/mysociety">@MySociety</a> whizz past in Tweetdeck. I traced the conversation back to the beginning and found this request for data:</p>

<p><blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">I&#39;m looking for a dataset that shows which UK constituencies are in which NHS trust areas.  Anyone?</p>&mdash; retired account (@retired10072015) <a href="https://twitter.com/retired10072015/status/511105946710716416">September 14, 2014</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script></p>

<p>I&rsquo;ve been doing a lot of playing with geographic data recently while preparing to release a site making it easier to get GeoJSON boundaries of various areas in the UK. As a result, I&rsquo;ve become pretty familiar with the <a href="https://geoportal.statistics.gov.uk/geoportal/catalog/search/browse/browse.page">Office of National Statistics Geography portal</a>, and the data available there. I figured it must be pretty simple to hack something together to provide the data Joseph was looking for, so I took a few minutes out of lunch to see if I could help.</p>

<p>Checking the lookup tables at the ONS, it was clear that unfortunately there was no simple &lsquo;NHS Trust to Parliamentary Constituency&rsquo; lookup table. However, there were two separate lookups involving Output Areas (OAs). One allows you to lookup <a href="https://geoportal.statistics.gov.uk/geoportal/catalog/search/resource/details.page?uuid=%7B441E0CBF-1421-4BF5-BBC9-5B7C0EA0FE44%7D">which Parliamentary Constituency (WPC) an OA belongs to</a>. The other allows you to lookup <a href="https://geoportal.statistics.gov.uk/geoportal/catalog/search/resource/details.page?uuid=%7B15C3A07F-F5E1-4CE8-9CFD-24B3589C725B%7D">which NHS Clinical Commissioning Group (CCG) an OA belongs to</a>. Clearly, all that&rsquo;s required to link the two together is a bit of quick scripting to tie them both together via the Output Areas.</p>

<p>First, let&rsquo;s create a dictionary with an entry for each CCG. For each CCG we&rsquo;ll store it&rsquo;s ID, name, and a set of OAs contained within. We&rsquo;ll also add  an empty set for the WPCs contained within the CCG:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> csv
<span style="color:#f92672">from</span> collections <span style="color:#f92672">import</span> defaultdict

data <span style="color:#f92672">=</span> {}

<span style="color:#75715e"># extract information about clinical commissioning groups</span>
<span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;OA11_CCG13_NHSAT_NHSCR_EN_LU.csv&#39;</span>, <span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> oa_to_cgc_file:
  reader <span style="color:#f92672">=</span> csv<span style="color:#f92672">.</span>DictReader(oa_to_cgc_file)
  <span style="color:#66d9ef">for</span> row <span style="color:#f92672">in</span> reader:
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> data<span style="color:#f92672">.</span>get(row[<span style="color:#e6db74">&#39;CCG13CD&#39;</span>]):
      data[row[<span style="color:#e6db74">&#39;CCG13CD&#39;</span>]] <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;CCG13CD&#39;</span>: row[<span style="color:#e6db74">&#39;CCG13CD&#39;</span>], <span style="color:#e6db74">&#39;CCG13NM&#39;</span>: row[<span style="color:#e6db74">&#39;CCG13NM&#39;</span>], <span style="color:#e6db74">&#39;PCON11CD list&#39;</span>: set(), <span style="color:#e6db74">&#39;PCON11NM list&#39;</span>: set(), <span style="color:#e6db74">&#39;OA11CD list&#39;</span>: set(),}
    data[row[<span style="color:#e6db74">&#39;CCG13CD&#39;</span>]][<span style="color:#e6db74">&#39;OA11CD list&#39;</span>]<span style="color:#f92672">.</span>add(row[<span style="color:#e6db74">&#39;OA11CD&#39;</span>])</code></pre></div>

<p>Next we create a lookup table that allows us to convert from OA to WPC:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># extract information for output area to constituency lookup</span>
oas <span style="color:#f92672">=</span> {}
pcon_nm <span style="color:#f92672">=</span> {}

<span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;OA11_PCON11_EER11_EW_LU.csv&#39;</span>, <span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> oa_to_pcon_file:
  reader <span style="color:#f92672">=</span> csv<span style="color:#f92672">.</span>DictReader(oa_to_pcon_file)
  <span style="color:#66d9ef">for</span> row <span style="color:#f92672">in</span> reader:
    oas[row[<span style="color:#e6db74">&#39;OA11CD&#39;</span>]] <span style="color:#f92672">=</span> row[<span style="color:#e6db74">&#39;PCON11CD&#39;</span>]
    pcon_nm[row[<span style="color:#e6db74">&#39;PCON11CD&#39;</span>]] <span style="color:#f92672">=</span> row[<span style="color:#e6db74">&#39;PCON11NM&#39;</span>]</code></pre></div>

<p>As the almost last step we go through the CCGs, and for each one we go through the list of OAs it covers, and lookup the WPC each OA belongs to:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># go through all the ccgs and lookup pcons from oas</span>
<span style="color:#66d9ef">for</span> ccg, d <span style="color:#f92672">in</span> data<span style="color:#f92672">.</span>iteritems():

 <span style="color:#66d9ef">for</span> oa <span style="color:#f92672">in</span> d[<span style="color:#e6db74">&#39;OA11CD list&#39;</span>]:
   d[<span style="color:#e6db74">&#39;PCON11CD list&#39;</span>]<span style="color:#f92672">.</span>add(oas[oa])
   d[<span style="color:#e6db74">&#39;PCON11NM list&#39;</span>]<span style="color:#f92672">.</span>add(pcon_nm[oas[oa]])

<span style="color:#66d9ef">del</span> d[<span style="color:#e6db74">&#39;OA11CD list&#39;</span>]</code></pre></div>

<p>Finally we just need to output the data:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">    <span style="color:#66d9ef">for</span> d <span style="color:#f92672">in</span> data<span style="color:#f92672">.</span>values():

     d[<span style="color:#e6db74">&#39;PCON11CD list&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;;&#39;</span><span style="color:#f92672">.</span>join(d[<span style="color:#e6db74">&#39;PCON11CD list&#39;</span>])
     d[<span style="color:#e6db74">&#39;PCON11NM list&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;;&#39;</span><span style="color:#f92672">.</span>join(d[<span style="color:#e6db74">&#39;PCON11NM list&#39;</span>])

    <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;output.csv&#39;</span>, <span style="color:#e6db74">&#39;w&#39;</span>) <span style="color:#66d9ef">as</span> out_file:
      writer <span style="color:#f92672">=</span> csv<span style="color:#f92672">.</span>DictWriter(out_file, [<span style="color:#e6db74">&#39;CCG13CD&#39;</span>, <span style="color:#e6db74">&#39;CCG13NM&#39;</span>, <span style="color:#e6db74">&#39;PCON11CD list&#39;</span>, <span style="color:#e6db74">&#39;PCON11NM list&#39;</span>])
      writer<span style="color:#f92672">.</span>writeheader()
      writer<span style="color:#f92672">.</span>writerows(data<span style="color:#f92672">.</span>values())</code></pre></div>

<p>Run the script, and we get a nice CSV with one row for each CCG, each row containing a list of the WPC ids and names the CCG covers.</p>

<p>Of course, this data only covers England (as CCGs are a division in NHS England). Although there don&rsquo;t seem to be lookups for OAs to Health Boards in Scotland, or from OAs to Local Health Boards in Wales, it should still be possible to do something similar for these countries using Parliamentary Wards as the intermediate geography, as lookups for Wards to Health Boards and Local Health Boards are available. It&rsquo;s also not immediately clear how well the boundaries for CCGs and WPCs match up, that would require further investigation, depending on what the lookup is to be used for.</p>

<p>All the code, input and output for this task is available on <a href="https://github.com/martinjc/CCG--Constituencies">my github page</a>.</p>

        </div>
    </article>
    
    <article class="blogpost">
        <header>
            <h1> <a href="https://martinjc.com/2014/09/08/sitting-on-the-dock-of-the-bay/">
                    sitting on the dock of the bay
                </a></h1>
            <p class="author">
                <span class="date">Monday, Sep 8, 2014</span>
            </p>
        </header>
        <div class="content">
            <p>While we negotiate the transition from the old house which we&rsquo;ve sold to the new house we&rsquo;ve just bought we&rsquo;ve been renting a lovely flat up on Penarth head. One of the main benefits of this flat is the glorious view over Cardiff Bay and to the city centre beyond. No matter what time it is, whenever I pass by the living room window I end up staring out across the city. During the day, there&rsquo;s boats coming and going through the barrage locks, or into the docks proper. At night the city is lit up with a terrible orange urban glow that somehow looks both peaceful and exciting. I&rsquo;ve spent a lot of time just stood on the balcony watching, and it&rsquo;s been quite relaxing. Not only that, but I&rsquo;ve had the opportunity to see some fairly interesting occurrences; especially when there&rsquo;s been an unusual visitor to Cardiff docks, such as this <a href="http://tallships.org/about-us/the-fleet/tall-ship/">tall ship</a> we had visiting earlier in the year:</p>










<figure>
    <img src="/2014/09/08/sitting-on-the-dock-of-the-bay/2014-04-29-19.51.42-copy-1024x650.jpg" width="1024" height="650" alt="The Stavros S Niarchos leaving Cardiff Docks">
    <figcaption>
        <small>
            The Stavros S Niarchos leaving Cardiff Docks
        </small>
    </figcaption>
</figure>

<p>This was the case again this evening, when we were able to stand and watch the warships of various flags and types leaving Cardiff docks after the conclusion of the NATO summit in Newport. Leaving aside any particular feelings about militarisation, it is still genuinely interesting to see these things in your home city, even more so when you&rsquo;ve got a good view.</p>

<p>Unfortunately despite still being up on the hill overlooking the city, the new house does not have such a commanding view of the docks, bay, or Cardiff. Losing that is one of the worst things about having to move. I guess I&rsquo;ll just have to get used to putting my shoes on and leaving the house whenever I want to stare out over the bay&hellip;</p>










<figure>
    <img src="/2014/09/08/sitting-on-the-dock-of-the-bay/2014-03-07-11.08.36-copy-1024x456.jpg" width="1024" height="456" alt="View over Cardiff Bay from Northcliffe">
    <figcaption>
        <small>
            View over Cardiff Bay from Northcliffe
        </small>
    </figcaption>
</figure>

        </div>
    </article>
    
    <article class="blogpost">
        <header>
            <h1> <a href="https://martinjc.com/2014/09/04/the-graphical-web-2014/">
                    The Graphical Web 2014
                </a></h1>
            <p class="author">
                <span class="date">Thursday, Sep 4, 2014</span>
            </p>
        </header>
        <div class="content">
            








<figure>
    <img src="/2014/09/04/the-graphical-web-2014/2014-08-26-18.04.39-copy-300x286.jpg" width="300" height="286" alt="photo of the author outside Winchester cathedral">
    <figcaption>
        <small>
            photo of the author outside Winchester cathedral
        </small>
    </figcaption>
</figure>

<p>Last week I had a lovely time down in Winchester with <a href="http://egrommet.net/">m&rsquo;colleague</a>, attending <a href="https://www.graphicalweb.org/2014/">The Graphical Web 2014</a>. This year the theme was &lsquo;Visual Storytelling&rsquo;, so I&rsquo;d gone along to see what new things we could learn about visualisation to include in the <a href="http://www.cardiff.ac.uk/jomec/degreeprogrammes/pgmasters/msc_computational_journalism/">MSc in Computational Journalism</a>. We&rsquo;d also already had a few conversations about the course with people who were going to be at the conference, so we were planning to take the opportunity to chat in person about their involvement.</p>

<p>There were many excellent informative and entertaining talks, ranging from the process behind the redesign of Google Maps, through how Twitter does data visualisation, and on to what happens when your data visualisation becomes immensely popular. I&rsquo;d highly recommend anyone with an interest in any of this to take some time to look through the schedule and watch the videos of some of the talks - I&rsquo;ll certainly be forcing the MScCompJ students to watch a few.</p>










<figure>
    <img src="/2014/09/04/the-graphical-web-2014/2014-08-28-11.11.49-copy-1024x574.jpg" width="1024" height="574" alt="Scott Murray educates us on the best design process">
    <figcaption>
        <small>
            Scott Murray educates us on the best design process
        </small>
    </figcaption>
</figure>

<p>There were some interesting messages from people at the conference that I&rsquo;ll be taking forward with my own work and trying to impart to the students. One that is key, I think, is to strike the right balance between detail and simplicity when presenting data. This was mentioned several times throughout the conference, but it really is important. Too much information in your visualisation and you can alienate the reader and confuse or hide your message. Not enough information and the context is lost, and the use of the design to the more advanced reader is reduced. It&rsquo;s one of those balancing acts that we find so often when trying to mix both people and computers. Attempting to solve this problem and find this balance is challenging and interesting, and I look forward to seeing how the students next year cope with it.</p>

<p>Overall, it was a really good conference. I met a number of interesting people,  found a whole set of new people to follow on Twitter, and returned to Cardiff excited about the year ahead.</p>

        </div>
    </article>
    
    <article class="blogpost">
        <header>
            <h1> <a href="https://martinjc.com/2014/08/01/foursquare-icon-downloading-yet-again/">
                    Foursquare icon downloading (yet again)
                </a></h1>
            <p class="author">
                <span class="date">Friday, Aug 1, 2014</span>
            </p>
        </header>
        <div class="content">
            <p><a href="/2011/10/01/colourful-foursquare-category-icons/">Previously</a> I&rsquo;ve<a href="/2012/01/31/foursquare-category-icon-downloader-2/"> written</a> about a little script to download all the category icons from Foursquare and to create many different coloured versions of them. I&rsquo;ve recently had to do this again for a project, and found my previous script did not work with a recent API version. I&rsquo;ve updated the script to fix it and put it up on <a href="https://github.com/martinjc/foursquare_icons">github</a>.</p>

        </div>
    </article>
    
    <article class="blogpost">
        <header>
            <h1> <a href="https://martinjc.com/2014/07/23/unified-diff-and-recruiting-guest-lecturers/">
                    Unified Diff and recruiting Guest Lecturers
                </a></h1>
            <p class="author">
                <span class="date">Wednesday, Jul 23, 2014</span>
            </p>
        </header>
        <div class="content">
            <p>Last week I gave a quick lightning talk at <a href="http://unifieddiff.co.uk/">UnifiedDiff</a> - a local tech <a href="http://www.meetup.com/unified-diff">meetup</a> here in Cardiff. The main point of the talk was to try and recruit more industry involvement for our new <a href="http://courses.cardiff.ac.uk/postgraduate/course/detail/p411.html">MSc in Computational Journalism</a> - preferably by getting some web developers and software engineers in to give guest lectures on the tools, languages and processes they use.</p>

<p>The talk went well, and I&rsquo;ve had several offers from people wanting to get involved and add some real value to the course, which is brilliant. Of course, there&rsquo;s always room to add more, so if you&rsquo;re interested in coming and talking to our students, <a href="/contact/">get in touch</a>!</p>

<p>If you&rsquo;re interested, the slides from the talk are <a href="/img/{{ page.date | date: &quot;%Y-%m-%d&quot;}}-{{page.slug}}/Unified-Diff-Giving-up-your-time-for-money-and-satisfaction.pdf">here</a></p>

        </div>
    </article>
    
    

<ul class="pagination">
    
    <li class="page-item">
        <a href="/blog/" class="page-link" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
    </li>
    
    <li class="page-item">
    <a href="/blog/page/2/" class="page-link" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
    </li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/blog/">1</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/blog/page/2/">2</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item active"><a class="page-link" href="/blog/page/3/">3</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/blog/page/4/">4</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item disabled"><span aria-hidden="true">&nbsp;&hellip;&nbsp;</span></li>
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/blog/page/11/">11</a></li>
    
    
    <li class="page-item">
    <a href="/blog/page/4/" class="page-link" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
    </li>
    
    <li class="page-item">
        <a href="/blog/page/11/" class="page-link" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
    </li>
    
</ul>

</main>

    </div><script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-25500481-1', 'auto');
    ga('send', 'pageview');

</script>
<script>window.twttr = (function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0],
            t = window.twttr || {};
        if (d.getElementById(id)) return t;
        js = d.createElement(s);
        js.id = id;
        js.src = "https://platform.twitter.com/widgets.js";
        fjs.parentNode.insertBefore(js, fjs);

        t._e = [];
        t.ready = function (f) {
            t._e.push(f);
        };

        return t;
    }(document, "script", "twitter-wjs"));
</script></body>

</html>