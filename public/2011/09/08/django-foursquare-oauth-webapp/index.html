<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#b100b2">
    <meta name="theme-color" content="#b100b2">

    <meta property="og:url" content="https://martinjc.com/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Martin Chorley">
    <meta property="og:site_name" content="Martin Chorley">
    <meta property="og:locale" content="en_GB">
    <meta property="article:author" content="Martin Chorley">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:creator" content="@martinjc">
    <meta name="twitter:url" content="https://martinjc.com">
    <meta name="twitter:title" content="Martin Chorley">

    <link rel="icon" href="/img/favicon.png">
    <link href="https://fonts.googleapis.com/css?family=Roboto|Scope+One" rel="stylesheet">
    <link rel="stylesheet" href="/css/main.css">
</head><body><header>
    <div class="social">
        <ul>
            <li><a href="https://www.twitter.com/martinjc" class="icon twitter" title="Twitter"><svg viewBox="0 0 512 512">
                        <path d="M419.6 168.6c-11.7 5.2-24.2 8.7-37.4 10.2 13.4-8.1 23.8-20.8 28.6-36 -12.6 7.5-26.5 12.9-41.3 15.8 -11.9-12.6-28.8-20.6-47.5-20.6 -42 0-72.9 39.2-63.4 79.9 -54.1-2.7-102.1-28.6-134.2-68 -17 29.2-8.8 67.5 20.1 86.9 -10.7-0.3-20.7-3.3-29.5-8.1 -0.7 30.2 20.9 58.4 52.2 64.6 -9.2 2.5-19.2 3.1-29.4 1.1 8.3 25.9 32.3 44.7 60.8 45.2 -27.4 21.4-61.8 31-96.4 27 28.8 18.5 63 29.2 99.8 29.2 120.8 0 189.1-102.1 185-193.6C399.9 193.1 410.9 181.7 419.6 168.6z" /></svg>
                    </a></li>
            <li><a href="mailto:ChorleyMJ@Cardiff.ac.uk" class="icon email" title="Email"><svg viewBox="0 0 512 512">
                        <path d="M101.3 141.6v228.9h0.3 308.4 0.8V141.6H101.3zM375.7 167.8l-119.7 91.5 -119.6-91.5H375.7zM127.6 194.1l64.1 49.1 -64.1 64.1V194.1zM127.8 344.2l84.9-84.9 43.2 33.1 43-32.9 84.7 84.7L127.8 344.2 127.8 344.2zM384.4 307.8l-64.4-64.4 64.4-49.3V307.8z" /></svg>
                    </a></li>
            <li><a href="https://www.facebook.com/martin.chorley" class="icon facebook" title="Facebook"><svg viewBox="0 0 512 512">
                        <path d="M211.9 197.4h-36.7v59.9h36.7V433.1h70.5V256.5h49.2l5.2-59.1h-54.4c0 0 0-22.1 0-33.7 0-13.9 2.8-19.5 16.3-19.5 10.9 0 38.2 0 38.2 0V82.9c0 0-40.2 0-48.8 0 -52.5 0-76.1 23.1-76.1 67.3C211.9 188.8 211.9 197.4 211.9 197.4z" /></svg>
                    </a></li>
            <li><a href="https://www.github.com/martinjc" class="icon github" title="GitHub"><svg viewBox="0 0 512 512">
                        <path d="M256 70.7c-102.6 0-185.9 83.2-185.9 185.9 0 82.1 53.3 151.8 127.1 176.4 9.3 1.7 12.3-4 12.3-8.9V389.4c-51.7 11.3-62.5-21.9-62.5-21.9 -8.4-21.5-20.6-27.2-20.6-27.2 -16.9-11.5 1.3-11.3 1.3-11.3 18.7 1.3 28.5 19.2 28.5 19.2 16.6 28.4 43.5 20.2 54.1 15.4 1.7-12 6.5-20.2 11.8-24.9 -41.3-4.7-84.7-20.6-84.7-91.9 0-20.3 7.3-36.9 19.2-49.9 -1.9-4.7-8.3-23.6 1.8-49.2 0 0 15.6-5 51.1 19.1 14.8-4.1 30.7-6.2 46.5-6.3 15.8 0.1 31.7 2.1 46.6 6.3 35.5-24 51.1-19.1 51.1-19.1 10.1 25.6 3.8 44.5 1.8 49.2 11.9 13 19.1 29.6 19.1 49.9 0 71.4-43.5 87.1-84.9 91.7 6.7 5.8 12.8 17.1 12.8 34.4 0 24.9 0 44.9 0 51 0 4.9 3 10.7 12.4 8.9 73.8-24.6 127-94.3 127-176.4C441.9 153.9 358.6 70.7 256 70.7z" /></svg>
                    </a></li>
            <li><a href="https://www.instagram.com/martinjam" class="icon instagram" title="Instagram"><svg viewBox="0 0 512 512">
                        <g>
                            <path d="M256 109.3c47.8 0 53.4 0.2 72.3 1 17.4 0.8 26.9 3.7 33.2 6.2 8.4 3.2 14.3 7.1 20.6 13.4 6.3 6.3 10.1 12.2 13.4 20.6 2.5 6.3 5.4 15.8 6.2 33.2 0.9 18.9 1 24.5 1 72.3s-0.2 53.4-1 72.3c-0.8 17.4-3.7 26.9-6.2 33.2 -3.2 8.4-7.1 14.3-13.4 20.6 -6.3 6.3-12.2 10.1-20.6 13.4 -6.3 2.5-15.8 5.4-33.2 6.2 -18.9 0.9-24.5 1-72.3 1s-53.4-0.2-72.3-1c-17.4-0.8-26.9-3.7-33.2-6.2 -8.4-3.2-14.3-7.1-20.6-13.4 -6.3-6.3-10.1-12.2-13.4-20.6 -2.5-6.3-5.4-15.8-6.2-33.2 -0.9-18.9-1-24.5-1-72.3s0.2-53.4 1-72.3c0.8-17.4 3.7-26.9 6.2-33.2 3.2-8.4 7.1-14.3 13.4-20.6 6.3-6.3 12.2-10.1 20.6-13.4 6.3-2.5 15.8-5.4 33.2-6.2C202.6 109.5 208.2 109.3 256 109.3M256 77.1c-48.6 0-54.7 0.2-73.8 1.1 -19 0.9-32.1 3.9-43.4 8.3 -11.8 4.6-21.7 10.7-31.7 20.6 -9.9 9.9-16.1 19.9-20.6 31.7 -4.4 11.4-7.4 24.4-8.3 43.4 -0.9 19.1-1.1 25.2-1.1 73.8 0 48.6 0.2 54.7 1.1 73.8 0.9 19 3.9 32.1 8.3 43.4 4.6 11.8 10.7 21.7 20.6 31.7 9.9 9.9 19.9 16.1 31.7 20.6 11.4 4.4 24.4 7.4 43.4 8.3 19.1 0.9 25.2 1.1 73.8 1.1s54.7-0.2 73.8-1.1c19-0.9 32.1-3.9 43.4-8.3 11.8-4.6 21.7-10.7 31.7-20.6 9.9-9.9 16.1-19.9 20.6-31.7 4.4-11.4 7.4-24.4 8.3-43.4 0.9-19.1 1.1-25.2 1.1-73.8s-0.2-54.7-1.1-73.8c-0.9-19-3.9-32.1-8.3-43.4 -4.6-11.8-10.7-21.7-20.6-31.7 -9.9-9.9-19.9-16.1-31.7-20.6 -11.4-4.4-24.4-7.4-43.4-8.3C310.7 77.3 304.6 77.1 256 77.1L256 77.1z" />
                            <path d="M256 164.1c-50.7 0-91.9 41.1-91.9 91.9s41.1 91.9 91.9 91.9 91.9-41.1 91.9-91.9S306.7 164.1 256 164.1zM256 315.6c-32.9 0-59.6-26.7-59.6-59.6s26.7-59.6 59.6-59.6 59.6 26.7 59.6 59.6S288.9 315.6 256 315.6z" />
                            <circle cx="351.5" cy="160.5" r="21.5" />
                        </g>
                    </svg>
                    </a></li>
            <li><a href="https://www.last.fm/user/takitomouse" class="icon lastfm" title="Last.fm"><svg viewBox="0 0 512 512">
                        <path d="M230.104 336.568l-13.607-36.988c0 0-22.11 24.66-55.268 24.66 -29.341 0-50.172-25.512-50.172-66.328 0-52.293 26.359-71.001 52.297-71.001 37.412 0 49.316 24.234 59.522 55.273l13.607 42.518c13.603 41.236 39.113 74.402 112.666 74.402 52.727 0 88.437-16.155 88.437-58.672 0-34.438-19.56-52.297-56.125-60.802l-27.209-5.951c-18.707-4.252-24.233-11.906-24.233-24.659 0-14.456 11.478-22.96 30.189-22.96 20.406 0 31.458 7.653 33.162 25.935l42.516-5.103c-3.402-38.263-29.761-53.996-73.127-53.996 -38.266 0-75.68 14.456-75.68 60.799 0 28.912 14.029 47.197 49.315 55.697l28.916 6.801c21.683 5.104 28.908 14.031 28.908 26.363 0 15.73-15.305 22.107-44.218 22.107 -42.941 0-60.794-22.534-70.999-53.574l-14.032-42.513c-17.854-55.271-46.342-75.68-102.892-75.68 -62.499-0.001-95.663 39.538-95.663 106.715 0 64.628 33.164 99.489 92.689 99.489C207.141 359.1 230.104 336.568 230.104 336.568L230.104 336.568z" /></svg>
                    </a></li>
            <li><a href="https://uk.linkedin.com/in/martinchorley" class="icon linkedin" title="LinkedIn"><svg viewBox="0 0 512 512">
                        <path d="M186.4 142.4c0 19-15.3 34.5-34.2 34.5 -18.9 0-34.2-15.4-34.2-34.5 0-19 15.3-34.5 34.2-34.5C171.1 107.9 186.4 123.4 186.4 142.4zM181.4 201.3h-57.8V388.1h57.8V201.3zM273.8 201.3h-55.4V388.1h55.4c0 0 0-69.3 0-98 0-26.3 12.1-41.9 35.2-41.9 21.3 0 31.5 15 31.5 41.9 0 26.9 0 98 0 98h57.5c0 0 0-68.2 0-118.3 0-50-28.3-74.2-68-74.2 -39.6 0-56.3 30.9-56.3 30.9v-25.2H273.8z" /></svg>
                    </a></li>
        </ul>
    </div>


    <nav>
        <ul>|
            <li><a href="/">&nbsp;home</a>&nbsp;|</li>
            <li><a href="/blog">&nbsp;blog</a>&nbsp;|</li>
            <li><a href="/teaching">&nbsp;teaching</a>&nbsp;|</li>
            <li><a href="/research">&nbsp;research</a>&nbsp;|</li>
            <li><a href="/publications">&nbsp;publications</a>&nbsp;|</li>
        </ul>
    </nav>
</header><div id="content">
<article class="blogpost">
    <header>
        <h1> <a href="/2011/09/08/django-foursquare-oauth-webapp/">
                Django &#43; Foursquare &#43; OAuth = webapp?
            </a></h1>
        <p class="author">
            <span class="date">Thursday, Sep 8, 2011</span>
        </p>
    </header>
    <div class="content">
        <p>Moving on from my fun with getting django + twitter + oauth to play nicely, it&rsquo;s now time to start writing a web app that uses foursquare as the authentication/login method. As part of this, I need a basic django framework for doing authentication with foursquare. This may be useful to someone else at some point (including me when I forget in three months time how I did things), so I&rsquo;ve written up the details and added the code to <a href="https://github.com/martinjc/DjangoFoursq">github</a>.</p>

<p>Firstly, you need to <a href="https://foursquare.com/oauth/">register an application</a> with Foursquare to get your Client ID and Client Secret. You can enter any name and website you want, but the callback url needs to be our local development machine (assuming that&rsquo;s where you&rsquo;re doing the development), and to be the callback url that we&rsquo;re going to specify in a minute:</p>










<figure>
    <img src="/2011/09/08/django-foursquare-oauth-webapp/Foursquare-Register-300x174.jpg" width="300" height="174" alt="Form to register an application">
    <figcaption>
        <small>
            Form to register an application
        </small>
    </figcaption>
</figure>

<p>The more observant will notice that the callback url is currently <a href="http://127.0.0.1/foursq_auth/callback/">http://127.0.0.1/foursq_auth/callback/</a>, but that the django web server actually runs on port 8000, so the url really needs to be <a href="http://127.0.0.1:8000/foursq_auth/callback/">http://127.0.0.1:8000/foursq_auth/callback/</a>. Unfortunately the form validation doesn&rsquo;t allow you to use a &lsquo;:&rsquo; in your callback url. However, once the consumer is registered you can edit the callback url, and the form for that doesn&rsquo;t validate the url (or does but doesn&rsquo;t moan about the colon). Eventually, you are looking for the consumer to be registered with a callback url like this:</p>










<figure>
    <img src="/2011/09/08/django-foursquare-oauth-webapp/CapturFiles-300x51.jpg" width="300" height="51" alt="">
    <figcaption>
        <small>
            
        </small>
    </figcaption>
</figure>

<p>Once that is registered, we can get on with writing the code. The basic premise is pretty simple, we need just five urls in our django app, five views to go with them, and two basic html pages, one for login, and one to show we are logged in. Assuming you have a django project started (for reference the one I&rsquo;m using here is called &lsquo;Dj4sq&rsquo;) we can start by creating our foursquare app:</p>

<pre><code>django-admin.py startapp foursq_auth
</code></pre>

<p>We then want to edit urls.py for our main django project to allow the new app to handle its own views:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">urlpatterns <span style="color:#f92672">=</span> patterns(<span style="color:#e6db74">&#39;&#39;</span>,
    (<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;^foursq_auth/&#39;</span>, include(<span style="color:#e6db74">&#39;Dj4sq.foursq_auth.urls&#39;</span>)),
)</code></pre></div>

<p>and create and edit a file urls.py in the foursq_auth app with the five views we want:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">urlpatterns <span style="color:#f92672">=</span> patterns(<span style="color:#e6db74">&#39;foursq_auth.views&#39;</span>,
    <span style="color:#75715e"># main page redirects to start or login</span>
    url(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;^$&#39;</span>, view<span style="color:#f92672">=</span>main, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;main&#39;</span>),
    <span style="color:#75715e"># receive OAuth token from 4sq</span>
    url(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;^callback/$&#39;</span>, view<span style="color:#f92672">=</span>callback, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;oauth_return&#39;</span>),
    <span style="color:#75715e"># logout from the app</span>
    url(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;^logout/$&#39;</span>, view<span style="color:#f92672">=</span>unauth, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;oauth_unauth&#39;</span>),
    <span style="color:#75715e"># authenticate with 4sq using OAuth</span>
    url(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;^auth/$&#39;</span>, view<span style="color:#f92672">=</span>auth, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;oauth_auth&#39;</span>),
    <span style="color:#75715e"># main page once logged in</span>
    url( <span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;^done/$&#39;</span>, view<span style="color:#f92672">=</span>done, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;oauth_done&#39;</span> ),
)</code></pre></div>

<p>We then need our two basic html pages login.html and done.html:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">html</span>&gt;
    &lt;<span style="color:#f92672">head</span>&gt;
        &lt;<span style="color:#f92672">title</span>&gt;Foursquare OAuth Example&lt;/<span style="color:#f92672">title</span>&gt;
    &lt;/<span style="color:#f92672">head</span>&gt;
    &lt;<span style="color:#f92672">body</span>&gt;
    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;login&#34;</span>&gt;
        &lt;<span style="color:#f92672">p</span>&gt;Sign in with Foursquare to begin.&lt;/<span style="color:#f92672">p</span>&gt;
        &lt;<span style="color:#f92672">p</span>&gt;&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;auth/&#34;</span>&gt;Login&lt;/<span style="color:#f92672">a</span>&gt;&lt;/<span style="color:#f92672">p</span>&gt;
    &lt;/<span style="color:#f92672">div</span>&gt;
    &lt;/<span style="color:#f92672">body</span>&gt;
&lt;/<span style="color:#f92672">html</span>&gt;
&lt;<span style="color:#f92672">html</span>&gt;
    &lt;<span style="color:#f92672">head</span>&gt;
        &lt;<span style="color:#f92672">title</span>&gt;Foursquare OAuth Example&lt;/<span style="color:#f92672">title</span>&gt;
    &lt;/<span style="color:#f92672">head</span>&gt;
    &lt;<span style="color:#f92672">body</span>&gt;
        &lt;<span style="color:#f92672">p</span>&gt;Hi {{ name }}, you&#39;ve successfully logged in! &lt;/<span style="color:#f92672">p</span>&gt;
	&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;../logout/&#34;</span>&gt;Logout&lt;/<span style="color:#f92672">a</span>&gt;
    &lt;/<span style="color:#f92672">body</span>&gt;
&lt;/<span style="color:#f92672">html</span>&gt;</code></pre></div>

<p>All that&rsquo;s left after that is to write the views to tie it all together. We need a few variables defined for our code to work:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">CLIENT_ID <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;YOUR_CLIENT_ID&#39;</span>
CLIENT_SECRET <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;YOUR_CLIENT_SECRET&#39;</span>

request_token_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;https://foursquare.com/oauth2/authenticate&#39;</span>
access_token_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;https://foursquare.com/oauth2/access_token&#39;</span>
redirect_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;http://127.0.0.1:8000/foursq_auth/callback&#39;</span></code></pre></div>

<p>We can then write the views. The first one, &lsquo;main&rsquo; is super easy, as it only needs to return our login page:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>( request ):
    <span style="color:#66d9ef">return</span> render_to_response( <span style="color:#e6db74">&#39;foursq_auth/login.html&#39;</span> )</code></pre></div>

<p>The second, &lsquo;auth&rsquo;, is the first step in our authentication process, requesting an authorisation code from foursquare and redirecting the user to the page to authorise our app:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">auth</span>( request ):
    <span style="color:#75715e"># build the url to request</span>
    params <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;client_id&#39;</span> : CLIENT_ID,
            <span style="color:#e6db74">&#39;response_type&#39;</span> : <span style="color:#e6db74">&#39;code&#39;</span>,
            <span style="color:#e6db74">&#39;redirect_uri&#39;</span> : redirect_url }
    data <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>urlencode( params )
    <span style="color:#75715e"># redirect the user to the url to confirm access for the app</span>
    <span style="color:#66d9ef">return</span> HttpResponseRedirect(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">?</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> (request_token_url, data))</code></pre></div>

<p>If the user accepts our app, they&rsquo;ll be re-directed to our callback url, and an authorisation code will be passed back as one of the parameters of the url, so the next view, &lsquo;callback&rsquo; needs to deal with this. It then needs to post a request to foursquare with the authorisation code in order to receive the access_token for the user:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># get the code returned from foursquare</span>
code <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>GET<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;code&#39;</span>)

<span style="color:#75715e"># build the url to request the access_token</span>
params <span style="color:#f92672">=</span> { <span style="color:#e6db74">&#39;client_id&#39;</span> : CLIENT_ID,
           <span style="color:#e6db74">&#39;client_secret&#39;</span> : CLIENT_SECRET,
           <span style="color:#e6db74">&#39;grant_type&#39;</span> : <span style="color:#e6db74">&#39;authorization_code&#39;</span>,
           <span style="color:#e6db74">&#39;redirect_uri&#39;</span> : redirect_url,
           <span style="color:#e6db74">&#39;code&#39;</span> : code}
data <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>urlencode( params )
req <span style="color:#f92672">=</span> urllib2<span style="color:#f92672">.</span>Request( access_token_url, data )

<span style="color:#75715e"># request the access_token</span>
response <span style="color:#f92672">=</span> urllib2<span style="color:#f92672">.</span>urlopen( req )
access_token <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads( response<span style="color:#f92672">.</span>read( ) )
access_token <span style="color:#f92672">=</span> access_token[<span style="color:#e6db74">&#39;access_token&#39;</span>]

<span style="color:#75715e"># store the access_token for later use</span>
request<span style="color:#f92672">.</span>session[<span style="color:#e6db74">&#39;access_token&#39;</span>] <span style="color:#f92672">=</span> access_token

<span style="color:#75715e"># redirect the user to show we&#39;re done</span>
<span style="color:#66d9ef">return</span> HttpResponseRedirect(reverse( <span style="color:#e6db74">&#39;oauth_done&#39;</span> ) )</code></pre></div>

<p>If we&rsquo;ve got the access token, we&rsquo;re all set. From now on we can make any calls to the Foursquare API that require authorisation, as long as we supply this token as a parameter to the request named &lsquo;oauth_token&rsquo;. To prove that we&rsquo;re logged in, we&rsquo;ll re-direct the user at the end of the callback to a &lsquo;done&rsquo; page, which will display some user details:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">done</span>( request ):
    <span style="color:#75715e"># get the access_token</span>
    access_token <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>session<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;access_token&#39;</span>)

    <span style="color:#75715e"># request user details from foursquare</span>
    params <span style="color:#f92672">=</span> { <span style="color:#e6db74">&#39;oauth_token&#39;</span> : access_token }
    data <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>urlencode( params )
    url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;https://api.foursquare.com/v2/users/self&#39;</span>
    full_url <span style="color:#f92672">=</span> url <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;?&#39;</span> <span style="color:#f92672">+</span> data
    <span style="color:#66d9ef">print</span> full_url
    response <span style="color:#f92672">=</span> urllib2<span style="color:#f92672">.</span>urlopen( full_url )
    response <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span>read( )
    user <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads( response )[<span style="color:#e6db74">&#39;response&#39;</span>][<span style="color:#e6db74">&#39;user&#39;</span>]
    name <span style="color:#f92672">=</span> user[<span style="color:#e6db74">&#39;firstName&#39;</span>]

    <span style="color:#75715e"># show the page with the user&#39;s name to show they&#39;ve logged in</span>
    <span style="color:#66d9ef">return</span> render_to_response(<span style="color:#e6db74">&#39;foursq_auth/done.html&#39;</span>, {<span style="color:#e6db74">&#39;name&#39;</span>:name})</code></pre></div>

<p>And with that, we&rsquo;re all done. We can fire up the django server with:</p>

<pre><code>python manage.py runserver
</code></pre>

<p>open our browser to 127.0.0.1:8000/foursq_auth/ and go through the login process:</p>










<figure>
    <img src="/2011/09/08/django-foursquare-oauth-webapp/login-html-300x189.jpg" width="300" height="189" alt="Login Page">
    <figcaption>
        <small>
            Login Page
        </small>
    </figcaption>
</figure>










<figure>
    <img src="/2011/09/08/django-foursquare-oauth-webapp/foursquare-approval1-300x185.jpg" width="300" height="185" alt="Approving the app at Foursquare">
    <figcaption>
        <small>
            Approving the app at Foursquare
        </small>
    </figcaption>
</figure>










<figure>
    <img src="/2011/09/08/django-foursquare-oauth-webapp/done-html-300x189.jpg" width="300" height="189" alt="Successfully logged in">
    <figcaption>
        <small>
            Successfully logged in
        </small>
    </figcaption>
</figure>

<p>And that&rsquo;s that - A Django web app doing OAuth authentication with Foursquare. The full code is up on <a href="https://github.com/martinjc/DjangoFoursq">github</a> if you want to take a closer look.</p>

    </div>
    <div id="disqus_thread"></div>
    <script>
        var disqus_config = function () {
            this.page.url = "\/2011\/09\/08\/django-foursquare-oauth-webapp\/";  
            this.page.identifier = "django-foursquare-oauth-webapp"; 
        };
        (function () { 
            var d = document, s = d.createElement('script');
            s.src = 'https://martinjc.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

</article>

    </div><script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-25500481-1', 'auto');
    ga('send', 'pageview');

</script>
<script>window.twttr = (function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0],
            t = window.twttr || {};
        if (d.getElementById(id)) return t;
        js = d.createElement(s);
        js.id = id;
        js.src = "https://platform.twitter.com/widgets.js";
        fjs.parentNode.insertBefore(js, fjs);

        t._e = [];
        t.ready = function (f) {
            t._e.push(f);
        };

        return t;
    }(document, "script", "twitter-wjs"));
</script></body>

</html>