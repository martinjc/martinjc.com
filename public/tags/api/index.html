<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#b100b2">
    <meta name="theme-color" content="#b100b2">

    <meta property="og:url" content="https://martinjc.com/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Martin Chorley">
    <meta property="og:site_name" content="Martin Chorley">
    <meta property="og:locale" content="en_GB">
    <meta property="article:author" content="Martin Chorley">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:creator" content="@martinjc">
    <meta name="twitter:url" content="https://martinjc.com">
    <meta name="twitter:title" content="Martin Chorley">

    <link rel="icon" href="/img/favicon.png">
    <link href="https://fonts.googleapis.com/css?family=Roboto|Scope+One" rel="stylesheet">
    <link rel="stylesheet" href="/css/main.css">
</head><body><header>
    <div class="social">
        <ul>
            <li><a href="https://www.twitter.com/martinjc" class="icon twitter" title="Twitter"><svg viewBox="0 0 512 512">
                        <path d="M419.6 168.6c-11.7 5.2-24.2 8.7-37.4 10.2 13.4-8.1 23.8-20.8 28.6-36 -12.6 7.5-26.5 12.9-41.3 15.8 -11.9-12.6-28.8-20.6-47.5-20.6 -42 0-72.9 39.2-63.4 79.9 -54.1-2.7-102.1-28.6-134.2-68 -17 29.2-8.8 67.5 20.1 86.9 -10.7-0.3-20.7-3.3-29.5-8.1 -0.7 30.2 20.9 58.4 52.2 64.6 -9.2 2.5-19.2 3.1-29.4 1.1 8.3 25.9 32.3 44.7 60.8 45.2 -27.4 21.4-61.8 31-96.4 27 28.8 18.5 63 29.2 99.8 29.2 120.8 0 189.1-102.1 185-193.6C399.9 193.1 410.9 181.7 419.6 168.6z" /></svg>
                    </a></li>
            <li><a href="mailto:ChorleyMJ@Cardiff.ac.uk" class="icon email" title="Email"><svg viewBox="0 0 512 512">
                        <path d="M101.3 141.6v228.9h0.3 308.4 0.8V141.6H101.3zM375.7 167.8l-119.7 91.5 -119.6-91.5H375.7zM127.6 194.1l64.1 49.1 -64.1 64.1V194.1zM127.8 344.2l84.9-84.9 43.2 33.1 43-32.9 84.7 84.7L127.8 344.2 127.8 344.2zM384.4 307.8l-64.4-64.4 64.4-49.3V307.8z" /></svg>
                    </a></li>
            <li><a href="https://www.facebook.com/martin.chorley" class="icon facebook" title="Facebook"><svg viewBox="0 0 512 512">
                        <path d="M211.9 197.4h-36.7v59.9h36.7V433.1h70.5V256.5h49.2l5.2-59.1h-54.4c0 0 0-22.1 0-33.7 0-13.9 2.8-19.5 16.3-19.5 10.9 0 38.2 0 38.2 0V82.9c0 0-40.2 0-48.8 0 -52.5 0-76.1 23.1-76.1 67.3C211.9 188.8 211.9 197.4 211.9 197.4z" /></svg>
                    </a></li>
            <li><a href="https://www.github.com/martinjc" class="icon github" title="GitHub"><svg viewBox="0 0 512 512">
                        <path d="M256 70.7c-102.6 0-185.9 83.2-185.9 185.9 0 82.1 53.3 151.8 127.1 176.4 9.3 1.7 12.3-4 12.3-8.9V389.4c-51.7 11.3-62.5-21.9-62.5-21.9 -8.4-21.5-20.6-27.2-20.6-27.2 -16.9-11.5 1.3-11.3 1.3-11.3 18.7 1.3 28.5 19.2 28.5 19.2 16.6 28.4 43.5 20.2 54.1 15.4 1.7-12 6.5-20.2 11.8-24.9 -41.3-4.7-84.7-20.6-84.7-91.9 0-20.3 7.3-36.9 19.2-49.9 -1.9-4.7-8.3-23.6 1.8-49.2 0 0 15.6-5 51.1 19.1 14.8-4.1 30.7-6.2 46.5-6.3 15.8 0.1 31.7 2.1 46.6 6.3 35.5-24 51.1-19.1 51.1-19.1 10.1 25.6 3.8 44.5 1.8 49.2 11.9 13 19.1 29.6 19.1 49.9 0 71.4-43.5 87.1-84.9 91.7 6.7 5.8 12.8 17.1 12.8 34.4 0 24.9 0 44.9 0 51 0 4.9 3 10.7 12.4 8.9 73.8-24.6 127-94.3 127-176.4C441.9 153.9 358.6 70.7 256 70.7z" /></svg>
                    </a></li>
            <li><a href="https://www.instagram.com/martinjam" class="icon instagram" title="Instagram"><svg viewBox="0 0 512 512">
                        <g>
                            <path d="M256 109.3c47.8 0 53.4 0.2 72.3 1 17.4 0.8 26.9 3.7 33.2 6.2 8.4 3.2 14.3 7.1 20.6 13.4 6.3 6.3 10.1 12.2 13.4 20.6 2.5 6.3 5.4 15.8 6.2 33.2 0.9 18.9 1 24.5 1 72.3s-0.2 53.4-1 72.3c-0.8 17.4-3.7 26.9-6.2 33.2 -3.2 8.4-7.1 14.3-13.4 20.6 -6.3 6.3-12.2 10.1-20.6 13.4 -6.3 2.5-15.8 5.4-33.2 6.2 -18.9 0.9-24.5 1-72.3 1s-53.4-0.2-72.3-1c-17.4-0.8-26.9-3.7-33.2-6.2 -8.4-3.2-14.3-7.1-20.6-13.4 -6.3-6.3-10.1-12.2-13.4-20.6 -2.5-6.3-5.4-15.8-6.2-33.2 -0.9-18.9-1-24.5-1-72.3s0.2-53.4 1-72.3c0.8-17.4 3.7-26.9 6.2-33.2 3.2-8.4 7.1-14.3 13.4-20.6 6.3-6.3 12.2-10.1 20.6-13.4 6.3-2.5 15.8-5.4 33.2-6.2C202.6 109.5 208.2 109.3 256 109.3M256 77.1c-48.6 0-54.7 0.2-73.8 1.1 -19 0.9-32.1 3.9-43.4 8.3 -11.8 4.6-21.7 10.7-31.7 20.6 -9.9 9.9-16.1 19.9-20.6 31.7 -4.4 11.4-7.4 24.4-8.3 43.4 -0.9 19.1-1.1 25.2-1.1 73.8 0 48.6 0.2 54.7 1.1 73.8 0.9 19 3.9 32.1 8.3 43.4 4.6 11.8 10.7 21.7 20.6 31.7 9.9 9.9 19.9 16.1 31.7 20.6 11.4 4.4 24.4 7.4 43.4 8.3 19.1 0.9 25.2 1.1 73.8 1.1s54.7-0.2 73.8-1.1c19-0.9 32.1-3.9 43.4-8.3 11.8-4.6 21.7-10.7 31.7-20.6 9.9-9.9 16.1-19.9 20.6-31.7 4.4-11.4 7.4-24.4 8.3-43.4 0.9-19.1 1.1-25.2 1.1-73.8s-0.2-54.7-1.1-73.8c-0.9-19-3.9-32.1-8.3-43.4 -4.6-11.8-10.7-21.7-20.6-31.7 -9.9-9.9-19.9-16.1-31.7-20.6 -11.4-4.4-24.4-7.4-43.4-8.3C310.7 77.3 304.6 77.1 256 77.1L256 77.1z" />
                            <path d="M256 164.1c-50.7 0-91.9 41.1-91.9 91.9s41.1 91.9 91.9 91.9 91.9-41.1 91.9-91.9S306.7 164.1 256 164.1zM256 315.6c-32.9 0-59.6-26.7-59.6-59.6s26.7-59.6 59.6-59.6 59.6 26.7 59.6 59.6S288.9 315.6 256 315.6z" />
                            <circle cx="351.5" cy="160.5" r="21.5" />
                        </g>
                    </svg>
                    </a></li>
            <li><a href="https://www.last.fm/user/takitomouse" class="icon lastfm" title="Last.fm"><svg viewBox="0 0 512 512">
                        <path d="M230.104 336.568l-13.607-36.988c0 0-22.11 24.66-55.268 24.66 -29.341 0-50.172-25.512-50.172-66.328 0-52.293 26.359-71.001 52.297-71.001 37.412 0 49.316 24.234 59.522 55.273l13.607 42.518c13.603 41.236 39.113 74.402 112.666 74.402 52.727 0 88.437-16.155 88.437-58.672 0-34.438-19.56-52.297-56.125-60.802l-27.209-5.951c-18.707-4.252-24.233-11.906-24.233-24.659 0-14.456 11.478-22.96 30.189-22.96 20.406 0 31.458 7.653 33.162 25.935l42.516-5.103c-3.402-38.263-29.761-53.996-73.127-53.996 -38.266 0-75.68 14.456-75.68 60.799 0 28.912 14.029 47.197 49.315 55.697l28.916 6.801c21.683 5.104 28.908 14.031 28.908 26.363 0 15.73-15.305 22.107-44.218 22.107 -42.941 0-60.794-22.534-70.999-53.574l-14.032-42.513c-17.854-55.271-46.342-75.68-102.892-75.68 -62.499-0.001-95.663 39.538-95.663 106.715 0 64.628 33.164 99.489 92.689 99.489C207.141 359.1 230.104 336.568 230.104 336.568L230.104 336.568z" /></svg>
                    </a></li>
            <li><a href="https://uk.linkedin.com/in/martinchorley" class="icon linkedin" title="LinkedIn"><svg viewBox="0 0 512 512">
                        <path d="M186.4 142.4c0 19-15.3 34.5-34.2 34.5 -18.9 0-34.2-15.4-34.2-34.5 0-19 15.3-34.5 34.2-34.5C171.1 107.9 186.4 123.4 186.4 142.4zM181.4 201.3h-57.8V388.1h57.8V201.3zM273.8 201.3h-55.4V388.1h55.4c0 0 0-69.3 0-98 0-26.3 12.1-41.9 35.2-41.9 21.3 0 31.5 15 31.5 41.9 0 26.9 0 98 0 98h57.5c0 0 0-68.2 0-118.3 0-50-28.3-74.2-68-74.2 -39.6 0-56.3 30.9-56.3 30.9v-25.2H273.8z" /></svg>
                    </a></li>
        </ul>
    </div>


    <nav>
        <ul>|
            <li><a href="/">&nbsp;home</a>&nbsp;|</li>
            <li><a href="/blog">&nbsp;blog</a>&nbsp;|</li>
            <li><a href="/teaching">&nbsp;teaching</a>&nbsp;|</li>
            <li><a href="/research">&nbsp;research</a>&nbsp;|</li>
            <li><a href="/publications">&nbsp;publications</a>&nbsp;|</li>
        </ul>
    </nav>
</header><div id="content">
<main>
    

    
    <article class="blogpost">
        <header>
            <h1> <a href="/2014/11/19/quick-and-dirty-twitter-api-in-python/">
                    Quick and Dirty Twitter API in Python
                </a></h1>
            <p class="author">
                <span class="date">Wednesday, Nov 19, 2014</span>
            </p>
        </header>
        <div class="content">
            <p><strong>QUICK DISCLAIMER: this is a quick and dirty solution to a problem, so may not represent best coding practice, and has absolutely no error checking or handling. Use with caution&hellip;</strong></p>

<p>A recent project has needed me to scrape some data from Twitter. I considered using <a href="https://github.com/tweepy/tweepy">Tweepy</a>, but as it was a project for the <a href="compj.cs.cf.ac.uk">MSc in Computational Journalism</a>, I thought it would be more interesting to write our own simple Twitter API wrapper in Python.</p>

<p>The code presented here will allow you to make any API request to Twitter that uses a GET request, so is really only useful for getting data <em>from</em> Twitter, not sending it <em>to</em> Twitter. It is also only for using with the REST API, not the streaming API, so if you&rsquo;re looking for realtime monitoring, this is not the API wrapper you&rsquo;re looking for. This API wrapper also uses a single user&rsquo;s authentication (yours), so is not setup to allow other users to use Twitter through your application.</p>

<p>The first step is to get some access credentials from Twitter. Head over to <a href="https://apps.twitter.com/">https://apps.twitter.com/</a> and register a new application. Once the application is created, you&rsquo;ll be able to access its details. Under &lsquo;Keys and Access Tokens&rsquo; are four values we&rsquo;re going to need for the API - the  <code>Consumer Key</code> and <code>Consumer Secret</code>, and the <code>Access Token</code> and <code>Access Token Secret</code>. Copy all four values into a new python file, and save it as &lsquo;<code>_credentials.py</code>&rsquo;. Once we have the credentials, we can write some code to make some API requests!</p>

<p>First, we define a Twitter API object that will carry out our API requests. We need to store the API url, and some details to allow us to throttle our requests to Twitter to fit inside their rate limiting.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Twitter_API</span>:

 <span style="color:#66d9ef">def</span> __init__(self):

   <span style="color:#75715e"># URL for accessing API</span>
   scheme <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://&#34;</span>
   api_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;api.twitter.com&#34;</span>
   version <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;1.1&#34;</span>

   self<span style="color:#f92672">.</span>api_base <span style="color:#f92672">=</span> scheme <span style="color:#f92672">+</span> api_url <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/&#34;</span> <span style="color:#f92672">+</span> version

   <span style="color:#75715e">#</span>
   <span style="color:#75715e"># seconds between queries to each endpoint</span>
   <span style="color:#75715e"># queries in this project limited to 180</span>
   <span style="color:#75715e"># per 15 minutes</span>
   query_interval <span style="color:#f92672">=</span> float(<span style="color:#ae81ff">15</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span>)<span style="color:#f92672">/</span>(<span style="color:#ae81ff">175</span>)

   <span style="color:#75715e">#</span>
   <span style="color:#75715e"># rate limiting timer</span>
   self<span style="color:#f92672">.</span>__monitor <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;wait&#39;</span>:query_interval,
     <span style="color:#e6db74">&#39;earliest&#39;</span>:None,
     <span style="color:#e6db74">&#39;timer&#39;</span>:None}</code></pre></div>

<p>We add a rate limiting method that will make our API sleep if we are requesting things from Twitter too fast:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#</span>
<span style="color:#75715e"># rate_controller puts the thread to sleep</span>
<span style="color:#75715e"># if we&#39;re hitting the API too fast</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__rate_controller</span>(self, monitor_dict):

 <span style="color:#75715e">#</span>
 <span style="color:#75715e"># join the timer thread</span>
 <span style="color:#66d9ef">if</span> monitor_dict[<span style="color:#e6db74">&#39;timer&#39;</span>] <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None:
 monitor_dict[<span style="color:#e6db74">&#39;timer&#39;</span>]<span style="color:#f92672">.</span>join()

 <span style="color:#75715e"># sleep if necessary</span>
 <span style="color:#66d9ef">while</span> time<span style="color:#f92672">.</span>time() <span style="color:#f92672">&lt;</span> monitor_dict[<span style="color:#e6db74">&#39;earliest&#39;</span>]:
   time<span style="color:#f92672">.</span>sleep(monitor_dict[<span style="color:#e6db74">&#39;earliest&#39;</span>] <span style="color:#f92672">-</span> time<span style="color:#f92672">.</span>time())

 <span style="color:#75715e"># work out then the next API call can be made</span>
 earliest <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time() <span style="color:#f92672">+</span> monitor_dict[<span style="color:#e6db74">&#39;wait&#39;</span>]
 timer <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Timer( earliest<span style="color:#f92672">-</span>time<span style="color:#f92672">.</span>time(), <span style="color:#66d9ef">lambda</span>: None )
 monitor_dict[<span style="color:#e6db74">&#39;earliest&#39;</span>] <span style="color:#f92672">=</span> earliest
 monitor_dict[<span style="color:#e6db74">&#39;timer&#39;</span>] <span style="color:#f92672">=</span> timer
 monitor_dict[<span style="color:#e6db74">&#39;timer&#39;</span>]<span style="color:#f92672">.</span>start()</code></pre></div>

<p>The Twitter API requires us to supply authentication headers in the request. One of these headers is a signature, created by encoding details of the request. We can write a function that will take in all the details of the request (method, url, parameters) and create the signature:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#</span>
<span style="color:#75715e"># make the signature for the API request</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_signature</span>(self, method, url, params):

 <span style="color:#75715e"># escape special characters in all parameter keys</span>
 encoded_params <span style="color:#f92672">=</span> {}
 <span style="color:#66d9ef">for</span> k, v <span style="color:#f92672">in</span> params<span style="color:#f92672">.</span>items():
   encoded_k <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(str(k))
   encoded_v <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(str(v))
   encoded_params[encoded_k] <span style="color:#f92672">=</span> encoded_v

 <span style="color:#75715e"># sort the parameters alphabetically by key</span>
 sorted_keys <span style="color:#f92672">=</span> sorted(encoded_params<span style="color:#f92672">.</span>keys())

 <span style="color:#75715e"># create a string from the parameters</span>
 signing_string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>

 count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
 <span style="color:#66d9ef">for</span> key <span style="color:#f92672">in</span> sorted_keys:
   signing_string <span style="color:#f92672">+=</span> key
   signing_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;=&#34;</span>
   signing_string <span style="color:#f92672">+=</span> encoded_params[key]
   count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
   <span style="color:#66d9ef">if</span> count <span style="color:#f92672">&lt;</span> len(sorted_keys):
     signing_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;&amp;&#34;</span>

 <span style="color:#75715e"># construct the base string</span>
 base_string <span style="color:#f92672">=</span> method<span style="color:#f92672">.</span>upper()
 base_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;&amp;&#34;</span>
 base_string <span style="color:#f92672">+=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(url)
 base_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;&amp;&#34;</span>
 base_string <span style="color:#f92672">+=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(signing_string)

 <span style="color:#75715e"># construct the key</span>
 signing_key <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(client_secret) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&amp;&#34;</span> <span style="color:#f92672">+</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(access_secret)

 <span style="color:#75715e"># encrypt the base string with the key, and base64 encode the result</span>
 hashed <span style="color:#f92672">=</span> hmac<span style="color:#f92672">.</span>new(signing_key<span style="color:#f92672">.</span>encode(), base_string<span style="color:#f92672">.</span>encode(), sha1)
 signature <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>b64encode(hashed<span style="color:#f92672">.</span>digest())
 <span style="color:#66d9ef">return</span> signature<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>)</code></pre></div>

<p>Finally, we can write a method to actually <em>make</em> the API request:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">query_get</span>(self, endpoint, aspect, get_params<span style="color:#f92672">=</span>{}):

 <span style="color:#75715e">#</span>
 <span style="color:#75715e"># rate limiting</span>
 self<span style="color:#f92672">.</span>__rate_controller(self<span style="color:#f92672">.</span>__monitor)

 <span style="color:#75715e"># ensure we&#39;re dealing with strings as parameters</span>
 str_param_data <span style="color:#f92672">=</span> {}
 <span style="color:#66d9ef">for</span> k, v <span style="color:#f92672">in</span> get_params<span style="color:#f92672">.</span>items():
   str_param_data[str(k)] <span style="color:#f92672">=</span> str(v)

 <span style="color:#75715e"># construct the query url</span>
 url <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>api_base <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/&#34;</span> <span style="color:#f92672">+</span> endpoint <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/&#34;</span> <span style="color:#f92672">+</span> aspect <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.json&#34;</span>

 <span style="color:#75715e"># add the header parameters for authorisation</span>
 header_parameters <span style="color:#f92672">=</span> {
   <span style="color:#e6db74">&#34;oauth_consumer_key&#34;</span>: client_id,
   <span style="color:#e6db74">&#34;oauth_nonce&#34;</span>: uuid<span style="color:#f92672">.</span>uuid4(),
   <span style="color:#e6db74">&#34;oauth_signature_method&#34;</span>: <span style="color:#e6db74">&#34;HMAC-SHA1&#34;</span>,
   <span style="color:#e6db74">&#34;oauth_timestamp&#34;</span>: time<span style="color:#f92672">.</span>time(),
   <span style="color:#e6db74">&#34;oauth_token&#34;</span>: access_token,
   <span style="color:#e6db74">&#34;oauth_version&#34;</span>: <span style="color:#ae81ff">1.0</span>
 }

 <span style="color:#75715e"># collect all the parameters together for creating the signature</span>
 signing_parameters <span style="color:#f92672">=</span> {}
 <span style="color:#66d9ef">for</span> k, v <span style="color:#f92672">in</span> header_parameters<span style="color:#f92672">.</span>items():
   signing_parameters[k] <span style="color:#f92672">=</span> v
 <span style="color:#66d9ef">for</span> k, v <span style="color:#f92672">in</span> str_param_data<span style="color:#f92672">.</span>items():
   signing_parameters[k] <span style="color:#f92672">=</span> v

 <span style="color:#75715e"># create the signature and add it to the header parameters</span>
 header_parameters[<span style="color:#e6db74">&#34;oauth_signature&#34;</span>] <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>get_signature(<span style="color:#e6db74">&#34;GET&#34;</span>, url, signing_parameters)

 <span style="color:#75715e"># add the OAuth headers</span>
 header_string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;OAuth &#34;</span>
 count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
 <span style="color:#66d9ef">for</span> k, v <span style="color:#f92672">in</span> header_parameters<span style="color:#f92672">.</span>items():
   header_string <span style="color:#f92672">+=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(str(k))
   header_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;=</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">&#34;</span>
   header_string <span style="color:#f92672">+=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(str(v))
   header_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">&#34;</span>
   count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
   <span style="color:#66d9ef">if</span> count <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">7</span>:
     header_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;, &#34;</span>

 headers <span style="color:#f92672">=</span> {
   <span style="color:#e6db74">&#34;Authorization&#34;</span>: header_string
 }

 <span style="color:#75715e"># create the full url including parameters</span>
 url <span style="color:#f92672">=</span> url <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;?&#34;</span> <span style="color:#f92672">+</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>urlencode(str_param_data)
 request <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>request<span style="color:#f92672">.</span>Request(url, headers<span style="color:#f92672">=</span>headers)

 <span style="color:#75715e"># make the API request</span>
 <span style="color:#66d9ef">try</span>:
   response <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>request<span style="color:#f92672">.</span>urlopen(request)
   <span style="color:#66d9ef">except</span> urllib<span style="color:#f92672">.</span>error<span style="color:#f92672">.</span>HTTPError <span style="color:#66d9ef">as</span> e:
   <span style="color:#66d9ef">print</span>(e)
 <span style="color:#66d9ef">raise</span> e
   <span style="color:#66d9ef">except</span> urllib<span style="color:#f92672">.</span>error<span style="color:#f92672">.</span>URLError <span style="color:#66d9ef">as</span> e:
   <span style="color:#66d9ef">print</span>(e)
   <span style="color:#66d9ef">raise</span> e

 <span style="color:#75715e"># read the response and return the json</span>
 raw_data <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>)
 <span style="color:#66d9ef">return</span> json<span style="color:#f92672">.</span>loads(raw_data)</code></pre></div>

<p>Putting this all together, we have a simple Python class that acts as an API wrapper for GET requests to the Twitter REST API, including the signing and authentication of those requests. Using it is as simple as:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"> ta <span style="color:#f92672">=</span> Twitter_API()

 <span style="color:#75715e"># retrieve tweets for a user</span>
 params <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#34;screen_name&#34;</span>: <span style="color:#e6db74">&#34;martinjc&#34;</span>,
 }

 user_tweets <span style="color:#f92672">=</span> ta<span style="color:#f92672">.</span>query_get(<span style="color:#e6db74">&#34;statuses&#34;</span>, <span style="color:#e6db74">&#34;user_timeline&#34;</span>, params)</code></pre></div>

<p>As always, the full code is online on Github, in both my <a href="https://github.com/CompJCDF/Simple-Python-Twitter-API">personal account</a> and the <a href="https://github.com/CompJCDF">account for</a> the <a href="http://compj.cs.cf.ac.uk/">MSc Computational Journalism</a>.</p>

        </div>
    </article>
    
    <article class="blogpost">
        <header>
            <h1> <a href="/2014/08/01/foursquare-icon-downloading-yet-again/">
                    Foursquare icon downloading (yet again)
                </a></h1>
            <p class="author">
                <span class="date">Friday, Aug 1, 2014</span>
            </p>
        </header>
        <div class="content">
            <p><a href="/2011/10/01/colourful-foursquare-category-icons/">Previously</a> I&rsquo;ve<a href="/2012/01/31/foursquare-category-icon-downloader-2/"> written</a> about a little script to download all the category icons from Foursquare and to create many different coloured versions of them. I&rsquo;ve recently had to do this again for a project, and found my previous script did not work with a recent API version. I&rsquo;ve updated the script to fix it and put it up on <a href="https://github.com/martinjc/foursquare_icons">github</a>.</p>

        </div>
    </article>
    
    <article class="blogpost">
        <header>
            <h1> <a href="/2013/10/25/python-oauth/">
                    Python &#43; OAuth
                </a></h1>
            <p class="author">
                <span class="date">Friday, Oct 25, 2013</span>
            </p>
        </header>
        <div class="content">
            <p>As part of a current project I had the misfortune of having to to deal with a bunch of OAuth authenticated web services using a command line script in Python. Usually this isn&rsquo;t really a problem as most decent client libraries for services such as <a href="https://github.com/tweepy/tweepy">Twitter</a> or <a href="https://pypi.python.org/pypi/foursquare">Foursquare</a> can handle the authentication requests themselves, usually wrapping their own internal OAuth implementation. However, when it comes to web services that don&rsquo;t have existing python client libraries, you have to do the implementation yourself. Unfortunately support for OAuth in Python is a mess, so this is not the most pleasant of tasks, especially when most stackoverflow <a href="http://stackoverflow.com/questions/12628246/how-to-send-oauth-request-with-python-oauth2">posts</a> <a href="http://stackoverflow.com/questions/15610749/github-api-v3-access-via-python-oauth2-library-redirect-issue">on</a> <a href="http://stackoverflow.com/questions/1666415/python-oauth-library">the</a> topic point to massively <a href="http://code.daaku.org/python-oauth/">outdated</a> and <a href="https://github.com/simplegeo/python-oauth2">unmaintained</a> Python libraries.</p>

<p>Fortunately after some digging around, I was able to find a nice, well maintained and <a href="https://rauth.readthedocs.org/en/latest/">fairly well documented</a> solution: <a href="https://github.com/litl/rauth">rauth</a>, which is very clean and easy to use. As an example, I was trying to connect to the Fitbit API, and it really was as simple as following their example.</p>

<p>Firstly, we create an OAuth1Service:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> rauth
<span style="color:#f92672">from</span> _credentials <span style="color:#f92672">import</span> consumer_key, consumer_secret

base_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://api.fitbit.com&#34;</span>
request_token_url <span style="color:#f92672">=</span> base_url <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/oauth/request_token&#34;</span>
access_token_url <span style="color:#f92672">=</span> base_url <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/oauth/access_token&#34;</span>
authorize_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://www.fitbit.com/oauth/authorize&#34;</span>

fitbit <span style="color:#f92672">=</span> rauth<span style="color:#f92672">.</span>OAuth1Service(
 name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;fitbit&#34;</span>,
 consumer_key<span style="color:#f92672">=</span>consumer_key,
 consumer_secret<span style="color:#f92672">=</span>consumer_secret,
 request_token_url<span style="color:#f92672">=</span>request_token_url,
 access_token_url<span style="color:#f92672">=</span>access_token_url,
 authorize_url<span style="color:#f92672">=</span>authorize_url,
 base_url<span style="color:#f92672">=</span>base_url)</code></pre></div>

<p>Then we get the temporary request token credentials:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">request_token, request_token_secret <span style="color:#f92672">=</span> fitbit<span style="color:#f92672">.</span>get_request_token()

<span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34; request_token = </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> request_token
<span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34; request_token_secret = </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> request_token_secret
<span style="color:#66d9ef">print</span></code></pre></div>

<p>We then ask the user to authorise our application, and give us the PIN so we can prove to the service that they authorised us:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">authorize_url <span style="color:#f92672">=</span> fitbit<span style="color:#f92672">.</span>get_authorize_url(request_token)

<span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;Go to the following page in your browser: &#34;</span> <span style="color:#f92672">+</span> authorize_url
<span style="color:#66d9ef">print</span>

accepted <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;n&#39;</span>
<span style="color:#66d9ef">while</span> accepted<span style="color:#f92672">.</span>lower() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;n&#39;</span>:
 accepted <span style="color:#f92672">=</span> raw_input(<span style="color:#e6db74">&#39;Have you authorized me? (y/n) &#39;</span>)
pin <span style="color:#f92672">=</span> raw_input(<span style="color:#e6db74">&#39;Enter PIN from browser &#39;</span>)</code></pre></div>

<p>Finally, we can create an authenticated session and access user data from the service:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">session <span style="color:#f92672">=</span> fitbit<span style="color:#f92672">.</span>get_auth_session(request_token,
 request_token_secret,
 method<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;POST&#34;</span>,
 data<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;oauth_verifier&#39;</span>: pin})

<span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;&#34;</span>
<span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34; access_token = </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> session<span style="color:#f92672">.</span>access_token
<span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34; access_token_secret = </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> session<span style="color:#f92672">.</span>access_token_secret
<span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;&#34;</span>

url <span style="color:#f92672">=</span> base_url <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/1/&#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;user/-/profile.json&#34;</span>

r <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>get(url, params<span style="color:#f92672">=</span>{}, header_auth<span style="color:#f92672">=</span>True)
<span style="color:#66d9ef">print</span> r<span style="color:#f92672">.</span>json()</code></pre></div>

<p>It really is that easy to perform a 3-legged OAuth authentication on the command line. If you&rsquo;re only interested in data from 1 user, and you want to run the app multiple times, once you have the access token and secret, there&rsquo;s nothing to stop you just storing those and re-creating your session each time without having to re-authenticate (assuming the service does not expire access tokens):</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">base_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://api.fitbit.com/&#34;</span>
api_version <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;1/&#34;</span>
token <span style="color:#f92672">=</span> (fitbit_oauth_token, fitbit_oauth_secret)
consumer <span style="color:#f92672">=</span> (fitbit_consumer_key, fitbit_consumer_secret)

session <span style="color:#f92672">=</span> rauth<span style="color:#f92672">.</span>OAuth1Session(consumer[<span style="color:#ae81ff">0</span>], consumer[<span style="color:#ae81ff">1</span>], token[<span style="color:#ae81ff">0</span>], token[<span style="color:#ae81ff">1</span>])
url <span style="color:#f92672">=</span> base_url <span style="color:#f92672">+</span> api_version <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;user/-/profile.json&#34;</span>
r <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>get(url, params<span style="color:#f92672">=</span>{}, header_auth<span style="color:#f92672">=</span>True)
<span style="color:#66d9ef">print</span> r<span style="color:#f92672">.</span>json()</code></pre></div>

<p>So there we have it. Simple OAuth authentication on the command line, in Python. As always, the code is available on <a href="https://github.com/martinjc/rauth---fitbit-example">github</a> if you&rsquo;re interested.</p>

        </div>
    </article>
    
    <article class="blogpost">
        <header>
            <h1> <a href="/2013/08/18/swn-festival-2013-plans-part-1-the-data-2/">
                    SWN Festival 2013 plans – part 1: the data (2!)
                </a></h1>
            <p class="author">
                <span class="date">Sunday, Aug 18, 2013</span>
            </p>
        </header>
        <div class="content">
            <p>In the previous post, I used python and BeautifulSoup to grab the list of artists appearing at <a href="http://www.swnfest.com">SWN Festival 2013</a>, and to scrape their associated soundcloud/twitter/facebook/youtube links (where available).</p>

<p>However, there are more places to find music online than just those listed on the festival site, and some of those extra sources include additional data that I want to collect, so now we need to search these other sources for the artists. Firstly, we need to load the artist data we previously extracted from the festival website, and iterate through the list of artists one by one:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">artists <span style="color:#f92672">=</span> {}
<span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;bands.json&#34;</span>) <span style="color:#66d9ef">as</span> infile:
    artists <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>load(infile)

<span style="color:#66d9ef">for</span> artist, artist_data <span style="color:#f92672">in</span> artists<span style="color:#f92672">.</span>iteritems():</code></pre></div>

<p>The first thing I want to do for each artist it to search Spotify to see if they have any music available there. Spotify has a simple web <a href="https://developer.spotify.com/technologies/web-api/">API</a> for searching which is pretty straightforward to use:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">params <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#34;q&#34;</span> : <span style="color:#e6db74">&#34;artist:&#34;</span> <span style="color:#f92672">+</span> artist<span style="color:#f92672">.</span>encode(<span style="color:#e6db74">&#34;utf-8&#34;</span>)
}

spotify_root_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://ws.spotify.com/search/1/artist.json&#34;</span>
spotify_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">?</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (spotify_root_url, urllib<span style="color:#f92672">.</span>urlencode(params))

data <span style="color:#f92672">=</span> retrieve_json_data(spotify_url)

<span style="color:#66d9ef">if</span> data<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;artists&#34;</span>, None) <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None:
    <span style="color:#66d9ef">if</span> len(data[<span style="color:#e6db74">&#34;artists&#34;</span>]) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
        artist_id <span style="color:#f92672">=</span> data[<span style="color:#e6db74">&#34;artists&#34;</span>][<span style="color:#ae81ff">0</span>][<span style="color:#e6db74">&#34;href&#34;</span>]<span style="color:#f92672">.</span>lstrip(<span style="color:#e6db74">&#34;spotify:artist:&#34;</span>)
        artist_data[<span style="color:#e6db74">&#34;spotify_id&#34;</span>] <span style="color:#f92672">=</span> data[<span style="color:#e6db74">&#34;artists&#34;</span>][<span style="color:#ae81ff">0</span>][<span style="color:#e6db74">&#34;href&#34;</span>]
        artist_data[<span style="color:#e6db74">&#34;spotify_url&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://open.spotify.com/artist/&#34;</span> <span style="color:#f92672">+</span> artist_id</code></pre></div>

<p>The &lsquo;retrieve_json_data&rsquo; function is just a wrapper to call a URL and parse the returned JSON data:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">retrieve_json_data</span>(url):

    <span style="color:#66d9ef">try</span>:
        response <span style="color:#f92672">=</span> urllib2<span style="color:#f92672">.</span>urlopen(url)
    <span style="color:#66d9ef">except</span> urllib2<span style="color:#f92672">.</span>HTTPError, e:
        <span style="color:#66d9ef">raise</span> e
    <span style="color:#66d9ef">except</span> urllib2<span style="color:#f92672">.</span>URLError, e:
        <span style="color:#66d9ef">raise</span> e

    raw_data <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span>read()
    data <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(raw_data)

    <span style="color:#66d9ef">return</span> data</code></pre></div>

<p>Once I&rsquo;ve searched Spotify, I then want to see if the artist has a page on Last.FM. If they do, I also want to extract and store their top-tags from the site. Again, the Last.FM API makes this straightforward. Firstly, searching for the artist page:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">params <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#34;artist&#34;</span>: artist<span style="color:#f92672">.</span>encode(<span style="color:#e6db74">&#34;utf-8&#34;</span>),
    <span style="color:#e6db74">&#34;api_key&#34;</span>: last_fm_api_key,
    <span style="color:#e6db74">&#34;method&#34;</span>: <span style="color:#e6db74">&#34;artist.getinfo&#34;</span>,
    <span style="color:#e6db74">&#34;format&#34;</span>: <span style="color:#e6db74">&#34;json&#34;</span>
}

last_fm_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://ws.audioscrobbler.com/2.0/?&#34;</span> <span style="color:#f92672">+</span> urllib<span style="color:#f92672">.</span>urlencode(params)

data <span style="color:#f92672">=</span> retrieve_json_data(last_fm_url)

<span style="color:#66d9ef">if</span> data<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;artist&#34;</span>, None) <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None:
    <span style="color:#66d9ef">if</span> data[<span style="color:#e6db74">&#34;artist&#34;</span>]<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;url&#34;</span>, None) <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None:
        artist_data[<span style="color:#e6db74">&#34;last_fm_url&#34;</span>] <span style="color:#f92672">=</span> data[<span style="color:#e6db74">&#34;artist&#34;</span>][<span style="color:#e6db74">&#34;url&#34;</span>]</code></pre></div>

<p>Then, searching for the artist&rsquo;s top tags:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">params <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#34;artist&#34;</span>: artist<span style="color:#f92672">.</span>encode(<span style="color:#e6db74">&#34;utf-8&#34;</span>),
    <span style="color:#e6db74">&#34;api_key&#34;</span>: last_fm_api_key,
    <span style="color:#e6db74">&#34;method&#34;</span>: <span style="color:#e6db74">&#34;artist.gettoptags&#34;</span>,
    <span style="color:#e6db74">&#34;format&#34;</span>: <span style="color:#e6db74">&#34;json&#34;</span>
}

last_fm_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://ws.audioscrobbler.com/2.0/?&#34;</span> <span style="color:#f92672">+</span> urllib<span style="color:#f92672">.</span>urlencode(params)

data <span style="color:#f92672">=</span> retrieve_json_data(last_fm_url)

<span style="color:#66d9ef">if</span> data<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;toptags&#34;</span>, None) <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None:

    artist_data[<span style="color:#e6db74">&#34;tags&#34;</span>] <span style="color:#f92672">=</span> {}

    <span style="color:#66d9ef">if</span> data[<span style="color:#e6db74">&#34;toptags&#34;</span>]<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;tag&#34;</span>, None) <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None:
        tags <span style="color:#f92672">=</span> data[<span style="color:#e6db74">&#34;toptags&#34;</span>][<span style="color:#e6db74">&#34;tag&#34;</span>]
        <span style="color:#66d9ef">if</span> type(tags) <span style="color:#f92672">==</span> type([]):
            <span style="color:#66d9ef">for</span> tag <span style="color:#f92672">in</span> tags:
                name <span style="color:#f92672">=</span> tag[<span style="color:#e6db74">&#34;name&#34;</span>]<span style="color:#f92672">.</span>encode(<span style="color:#e6db74">&#39;utf-8&#39;</span>)
                count <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">if</span> int(tag[<span style="color:#e6db74">&#34;count&#34;</span>]) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> int(tag[<span style="color:#e6db74">&#34;count&#34;</span>])
                artist_data[<span style="color:#e6db74">&#34;tags&#34;</span>][name] <span style="color:#f92672">=</span> count
            <span style="color:#66d9ef">else</span>:
                name <span style="color:#f92672">=</span> tags[<span style="color:#e6db74">&#34;name&#34;</span>]<span style="color:#f92672">.</span>encode(<span style="color:#e6db74">&#39;utf-8&#39;</span>)
                count <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">if</span> int(tags[<span style="color:#e6db74">&#34;count&#34;</span>]) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> int(tags[<span style="color:#e6db74">&#34;count&#34;</span>])
                artist_data[<span style="color:#e6db74">&#34;tags&#34;</span>][name] <span style="color:#f92672">=</span> count</code></pre></div>

<p>Again, once we&rsquo;ve retrieved all the extra artist data, we can dump it to file:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;bands.json&#34;</span>, <span style="color:#e6db74">&#34;w&#34;</span>) <span style="color:#66d9ef">as</span> outfile:
    json<span style="color:#f92672">.</span>dump(artists, outfile)</code></pre></div>

<p>So, I now have 2 scripts that I can run regularly to capture any updates to the festival website (including lineup additions) and to search for artist data on Spotify and Last.FM. Now I&rsquo;ve got all this data captured and stored, it&rsquo;s time to start doing something interesting with it&hellip;</p>

        </div>
    </article>
    
    

</main>

    </div><script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-25500481-1', 'auto');
    ga('send', 'pageview');

</script>
<script>window.twttr = (function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0],
            t = window.twttr || {};
        if (d.getElementById(id)) return t;
        js = d.createElement(s);
        js.id = id;
        js.src = "https://platform.twitter.com/widgets.js";
        fjs.parentNode.insertBefore(js, fjs);

        t._e = [];
        t.ready = function (f) {
            t._e.push(f);
        };

        return t;
    }(document, "script", "twitter-wjs"));
</script></body>

</html>