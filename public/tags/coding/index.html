<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#b100b2">
    <meta name="theme-color" content="#b100b2">

    <meta property="og:url" content="https://martinjc.com/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Martin Chorley">
    <meta property="og:site_name" content="Martin Chorley">
    <meta property="og:locale" content="en_GB">
    <meta property="article:author" content="Martin Chorley">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:creator" content="@martinjc">
    <meta name="twitter:url" content="https://martinjc.com">
    <meta name="twitter:title" content="Martin Chorley">

    <link rel="icon" href="/img/favicon.png">
    <link href="https://fonts.googleapis.com/css?family=Roboto|Scope+One" rel="stylesheet">
    <link rel="stylesheet" href="/css/main.css">
</head><body><header>
    <div class="social">
        <ul>
            <li><a href="https://www.twitter.com/martinjc" class="icon twitter" title="Twitter"><svg viewBox="0 0 512 512">
                        <path d="M419.6 168.6c-11.7 5.2-24.2 8.7-37.4 10.2 13.4-8.1 23.8-20.8 28.6-36 -12.6 7.5-26.5 12.9-41.3 15.8 -11.9-12.6-28.8-20.6-47.5-20.6 -42 0-72.9 39.2-63.4 79.9 -54.1-2.7-102.1-28.6-134.2-68 -17 29.2-8.8 67.5 20.1 86.9 -10.7-0.3-20.7-3.3-29.5-8.1 -0.7 30.2 20.9 58.4 52.2 64.6 -9.2 2.5-19.2 3.1-29.4 1.1 8.3 25.9 32.3 44.7 60.8 45.2 -27.4 21.4-61.8 31-96.4 27 28.8 18.5 63 29.2 99.8 29.2 120.8 0 189.1-102.1 185-193.6C399.9 193.1 410.9 181.7 419.6 168.6z" /></svg>
                    </a></li>
            <li><a href="mailto:ChorleyMJ@Cardiff.ac.uk" class="icon email" title="Email"><svg viewBox="0 0 512 512">
                        <path d="M101.3 141.6v228.9h0.3 308.4 0.8V141.6H101.3zM375.7 167.8l-119.7 91.5 -119.6-91.5H375.7zM127.6 194.1l64.1 49.1 -64.1 64.1V194.1zM127.8 344.2l84.9-84.9 43.2 33.1 43-32.9 84.7 84.7L127.8 344.2 127.8 344.2zM384.4 307.8l-64.4-64.4 64.4-49.3V307.8z" /></svg>
                    </a></li>
            <li><a href="https://www.facebook.com/martin.chorley" class="icon facebook" title="Facebook"><svg viewBox="0 0 512 512">
                        <path d="M211.9 197.4h-36.7v59.9h36.7V433.1h70.5V256.5h49.2l5.2-59.1h-54.4c0 0 0-22.1 0-33.7 0-13.9 2.8-19.5 16.3-19.5 10.9 0 38.2 0 38.2 0V82.9c0 0-40.2 0-48.8 0 -52.5 0-76.1 23.1-76.1 67.3C211.9 188.8 211.9 197.4 211.9 197.4z" /></svg>
                    </a></li>
            <li><a href="https://www.github.com/martinjc" class="icon github" title="GitHub"><svg viewBox="0 0 512 512">
                        <path d="M256 70.7c-102.6 0-185.9 83.2-185.9 185.9 0 82.1 53.3 151.8 127.1 176.4 9.3 1.7 12.3-4 12.3-8.9V389.4c-51.7 11.3-62.5-21.9-62.5-21.9 -8.4-21.5-20.6-27.2-20.6-27.2 -16.9-11.5 1.3-11.3 1.3-11.3 18.7 1.3 28.5 19.2 28.5 19.2 16.6 28.4 43.5 20.2 54.1 15.4 1.7-12 6.5-20.2 11.8-24.9 -41.3-4.7-84.7-20.6-84.7-91.9 0-20.3 7.3-36.9 19.2-49.9 -1.9-4.7-8.3-23.6 1.8-49.2 0 0 15.6-5 51.1 19.1 14.8-4.1 30.7-6.2 46.5-6.3 15.8 0.1 31.7 2.1 46.6 6.3 35.5-24 51.1-19.1 51.1-19.1 10.1 25.6 3.8 44.5 1.8 49.2 11.9 13 19.1 29.6 19.1 49.9 0 71.4-43.5 87.1-84.9 91.7 6.7 5.8 12.8 17.1 12.8 34.4 0 24.9 0 44.9 0 51 0 4.9 3 10.7 12.4 8.9 73.8-24.6 127-94.3 127-176.4C441.9 153.9 358.6 70.7 256 70.7z" /></svg>
                    </a></li>
            <li><a href="https://www.instagram.com/martinjam" class="icon instagram" title="Instagram"><svg viewBox="0 0 512 512">
                        <g>
                            <path d="M256 109.3c47.8 0 53.4 0.2 72.3 1 17.4 0.8 26.9 3.7 33.2 6.2 8.4 3.2 14.3 7.1 20.6 13.4 6.3 6.3 10.1 12.2 13.4 20.6 2.5 6.3 5.4 15.8 6.2 33.2 0.9 18.9 1 24.5 1 72.3s-0.2 53.4-1 72.3c-0.8 17.4-3.7 26.9-6.2 33.2 -3.2 8.4-7.1 14.3-13.4 20.6 -6.3 6.3-12.2 10.1-20.6 13.4 -6.3 2.5-15.8 5.4-33.2 6.2 -18.9 0.9-24.5 1-72.3 1s-53.4-0.2-72.3-1c-17.4-0.8-26.9-3.7-33.2-6.2 -8.4-3.2-14.3-7.1-20.6-13.4 -6.3-6.3-10.1-12.2-13.4-20.6 -2.5-6.3-5.4-15.8-6.2-33.2 -0.9-18.9-1-24.5-1-72.3s0.2-53.4 1-72.3c0.8-17.4 3.7-26.9 6.2-33.2 3.2-8.4 7.1-14.3 13.4-20.6 6.3-6.3 12.2-10.1 20.6-13.4 6.3-2.5 15.8-5.4 33.2-6.2C202.6 109.5 208.2 109.3 256 109.3M256 77.1c-48.6 0-54.7 0.2-73.8 1.1 -19 0.9-32.1 3.9-43.4 8.3 -11.8 4.6-21.7 10.7-31.7 20.6 -9.9 9.9-16.1 19.9-20.6 31.7 -4.4 11.4-7.4 24.4-8.3 43.4 -0.9 19.1-1.1 25.2-1.1 73.8 0 48.6 0.2 54.7 1.1 73.8 0.9 19 3.9 32.1 8.3 43.4 4.6 11.8 10.7 21.7 20.6 31.7 9.9 9.9 19.9 16.1 31.7 20.6 11.4 4.4 24.4 7.4 43.4 8.3 19.1 0.9 25.2 1.1 73.8 1.1s54.7-0.2 73.8-1.1c19-0.9 32.1-3.9 43.4-8.3 11.8-4.6 21.7-10.7 31.7-20.6 9.9-9.9 16.1-19.9 20.6-31.7 4.4-11.4 7.4-24.4 8.3-43.4 0.9-19.1 1.1-25.2 1.1-73.8s-0.2-54.7-1.1-73.8c-0.9-19-3.9-32.1-8.3-43.4 -4.6-11.8-10.7-21.7-20.6-31.7 -9.9-9.9-19.9-16.1-31.7-20.6 -11.4-4.4-24.4-7.4-43.4-8.3C310.7 77.3 304.6 77.1 256 77.1L256 77.1z" />
                            <path d="M256 164.1c-50.7 0-91.9 41.1-91.9 91.9s41.1 91.9 91.9 91.9 91.9-41.1 91.9-91.9S306.7 164.1 256 164.1zM256 315.6c-32.9 0-59.6-26.7-59.6-59.6s26.7-59.6 59.6-59.6 59.6 26.7 59.6 59.6S288.9 315.6 256 315.6z" />
                            <circle cx="351.5" cy="160.5" r="21.5" />
                        </g>
                    </svg>
                    </a></li>
            <li><a href="https://www.last.fm/user/takitomouse" class="icon lastfm" title="Last.fm"><svg viewBox="0 0 512 512">
                        <path d="M230.104 336.568l-13.607-36.988c0 0-22.11 24.66-55.268 24.66 -29.341 0-50.172-25.512-50.172-66.328 0-52.293 26.359-71.001 52.297-71.001 37.412 0 49.316 24.234 59.522 55.273l13.607 42.518c13.603 41.236 39.113 74.402 112.666 74.402 52.727 0 88.437-16.155 88.437-58.672 0-34.438-19.56-52.297-56.125-60.802l-27.209-5.951c-18.707-4.252-24.233-11.906-24.233-24.659 0-14.456 11.478-22.96 30.189-22.96 20.406 0 31.458 7.653 33.162 25.935l42.516-5.103c-3.402-38.263-29.761-53.996-73.127-53.996 -38.266 0-75.68 14.456-75.68 60.799 0 28.912 14.029 47.197 49.315 55.697l28.916 6.801c21.683 5.104 28.908 14.031 28.908 26.363 0 15.73-15.305 22.107-44.218 22.107 -42.941 0-60.794-22.534-70.999-53.574l-14.032-42.513c-17.854-55.271-46.342-75.68-102.892-75.68 -62.499-0.001-95.663 39.538-95.663 106.715 0 64.628 33.164 99.489 92.689 99.489C207.141 359.1 230.104 336.568 230.104 336.568L230.104 336.568z" /></svg>
                    </a></li>
            <li><a href="https://uk.linkedin.com/in/martinchorley" class="icon linkedin" title="LinkedIn"><svg viewBox="0 0 512 512">
                        <path d="M186.4 142.4c0 19-15.3 34.5-34.2 34.5 -18.9 0-34.2-15.4-34.2-34.5 0-19 15.3-34.5 34.2-34.5C171.1 107.9 186.4 123.4 186.4 142.4zM181.4 201.3h-57.8V388.1h57.8V201.3zM273.8 201.3h-55.4V388.1h55.4c0 0 0-69.3 0-98 0-26.3 12.1-41.9 35.2-41.9 21.3 0 31.5 15 31.5 41.9 0 26.9 0 98 0 98h57.5c0 0 0-68.2 0-118.3 0-50-28.3-74.2-68-74.2 -39.6 0-56.3 30.9-56.3 30.9v-25.2H273.8z" /></svg>
                    </a></li>
        </ul>
    </div>


    <nav>
        <ul>|
            <li><a href="/">&nbsp;home</a>&nbsp;|</li>
            <li><a href="/blog">&nbsp;blog</a>&nbsp;|</li>
            <li><a href="/teaching">&nbsp;teaching</a>&nbsp;|</li>
            <li><a href="/research">&nbsp;research</a>&nbsp;|</li>
            <li><a href="/publications">&nbsp;publications</a>&nbsp;|</li>
        </ul>
    </nav>
</header><div id="content">
<main>
    

<ul class="pagination">
    
    <li class="page-item">
        <a href="/tags/coding/" class="page-link" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
    </li>
    
    <li class="page-item disabled">
    <a href="" class="page-link" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
    </li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item active"><a class="page-link" href="/tags/coding/">1</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/tags/coding/page/2/">2</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/tags/coding/page/3/">3</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/tags/coding/page/4/">4</a></li>
    
    
    <li class="page-item">
    <a href="/tags/coding/page/2/" class="page-link" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
    </li>
    
    <li class="page-item">
        <a href="/tags/coding/page/4/" class="page-link" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
    </li>
    
</ul>

    
    <article class="blogpost">
        <header>
            <h1> <a href="/2016/11/02/scraping-the-assembly/">
                    Scraping the Assembly
                </a></h1>
            <p class="author">
                <span class="date">Wednesday, Nov 2, 2016</span>
            </p>
        </header>
        <div class="content">
            <p>M’colleague is currently teaching a first-semester module on Data Journalism to the students on our MSc in Computational and Data Journalism. As part of this, they need to do some sort of data project. One of the students is looking at the <a href="http://allowances.assembly.wales/Default.aspx?Option=switch">expenses of Welsh Assembly Members</a>. These are all freely available online, but not in an easy to manipulate form. According to the Assembly they’d be happy to give the data out as a spreadsheet, if we submitted an FOI.</p>

<p>To me, this seems quite stupid. The information is all online and freely accessible. You’ve admitted you’re willing to give it out to anyone who submits an FOI. So why not just make the raw data available to download? This does not sound like a helpful <a href="http://www.opengovernment.org.uk/about/">Open Government</a> to me. Anyway, for whatever reason, they’ve chosen not to, and we can’t be bothered to wait around for an FOI to come back. It’s much quicker and easier to build a scraper! We’ll just use selenium to drive a web browser, submit a search, page through all the results collecting the details, then dump it all out to csv. Simple.</p>










<figure>
    <img src="/2016/11/02/scraping-the-assembly/out.gif" width="679" height="510" alt="Scraping AM expenses">
    <figcaption>
        <small>
            Scraping AM expenses
        </small>
    </figcaption>
</figure>

<p>I built this as a quick hack this morning. It took about an hour or so, and it shows. The code is not robust in any way, but it works. You can ask it for data from any year (or a number of years) and it’ll happily sit there churning its way through the results and spitting them out as both .csv and .json.</p>

<p>All the code is <a href="https://github.com/martinjc/assembly-expenses-scraper">available on Github</a> and it’s under an MIT Licence. Have fun 😉</p>

        </div>
    </article>
    
    <article class="blogpost">
        <header>
            <h1> <a href="/2016/10/05/atom-plugins-for-web-development/">
                    Atom Plugins for Web Development
                </a></h1>
            <p class="author">
                <span class="date">Wednesday, Oct 5, 2016</span>
            </p>
        </header>
        <div class="content">
            

<p>I’ve had a number of students in my web-dev module asking me what plugins I’m using in my text editor, so I thought I’d dash off a quick blog post on the plugins I find useful day-to-day. (Actually, most people are normally asking me ‘how did you do that thing where you typed one word and suddenly you had a whole HTML page? The answer is I used a plugin, so ‘what plugins do you use?’ is really the question they should be asking…)</p>

<p>I’m using <a href="https://atom.io/">Atom</a> as my text editor. It’s free, open source, and generally reliable. If you’re a student on my web-dev course you’re stuck using <a href="https://www.sublimetext.com/">Sublime Text</a> in the lab for now. I’m pretty sure most of the Atom plugins I use have either direct Sublime equivalents, or similarly functioning alternatives.</p>

<p>There’s a guide to Atom packages <a href="here">here</a> and one for Sublime Text <a href="https://www.sublimetext.com/docs/3/packages.html">here</a></p>

<p>A quick google for ‘best atom packages web developer’ will probably get you to a far more comprehensive list than this, but here’s my current pick of useful plugins anyway:</p>

<h2 id="emmet-https-atom-io-packages-emmet"><a href="https://atom.io/packages/emmet">emmet</a></h2>

<p>This is essential for anyone writing any amount of HTML. This is the magic package that allows me to write ‘html:5’ in a blank document, hit the shortcut keys (CTRL + E in my setup), and suddenly have a simple boilerplate HTML page.</p>










<figure>
    <img src="/2016/10/05/atom-plugins-for-web-development/out-1.gif" width="1024" height="879" alt="emmet auto completion">
    <figcaption>
        <small>
            emmet auto completion
        </small>
    </figcaption>
</figure>

<p>It’s ace. Not only that, but it can write loads of HTML for you, and all you have to do is write a CSS selector for that HTML:</p>










<figure>
    <img src="/2016/10/05/atom-plugins-for-web-development/out-1.gif" width="1024" height="879" alt="html css Selector expansion">
    <figcaption>
        <small>
            html css Selector expansion
        </small>
    </figcaption>
</figure>

<p>Great stuff. The documentation is here.</p>

<h2 id="atom-beautify-https-atom-io-packages-atom-beautify"><a href="https://atom.io/packages/atom-beautify">atom-beautify</a></h2>

<p>This will tidy up your code automatically, fixing the indentation and spacing etc. It can even be set to automatically tidy your code every time you save a file. Awesome huh? Imagine being set a coursework where some of the marks were dependent on not writing code that looks like it was written by a five-year old child who’s addicted to hitting the tab key, then finding out that there’s software to strap that five-year olds thumbs to his hands so he can’t hit that tab key. Awesome.</p>










<figure>
    <img src="/2016/10/05/atom-plugins-for-web-development/out-2.gif" width="1024" height="869" alt="Beautiful tidy code">
    <figcaption>
        <small>
            Beautiful tidy code
        </small>
    </figcaption>
</figure>

<h2 id="color-picker-https-atom-io-packages-color-picker"><a href="https://atom.io/packages/color-picker">color-picker</a></h2>

<p>This one adds a colour picker right into atom. Just CMD-SHIFT-C and choose your colours!</p>










<figure>
    <img src="/2016/10/05/atom-plugins-for-web-development/out-3.gif" width="1024" height="869" alt="Colour picker">
    <figcaption>
        <small>
            Colour picker
        </small>
    </figcaption>
</figure>

<p>Another useful colour related plugin you may want to look at is Pigments, which can highlight colours in your projects, and gather them all together so you can see your palette.</p>

<h2 id="linter-https-atom-io-packages-linter"><a href="https://atom.io/packages/linter">linter</a></h2>

<p>My last recommendation is linter. This plugin will automatically check your code for errors. You’ll need to install linters for whatever language you want to check, like linter-tidy, linter-csslint, linter-pylint and linter-jshint.</p>










<figure>
    <img src="/2016/10/05/atom-plugins-for-web-development/Screenshot.png" width="1206" height="1028" alt="Linter finds errors in your code">
    <figcaption>
        <small>
            Linter finds errors in your code
        </small>
    </figcaption>
</figure>

<p>So there we go – a few recommendations to get you started. Found anything else interesting? Let me know!</p>

        </div>
    </article>
    
    <article class="blogpost">
        <header>
            <h1> <a href="/2016/08/01/sustainable-software-institute-research-data-visualisation-workshop/">
                    Sustainable Software Institute – Research Data Visualisation Workshop
                </a></h1>
            <p class="author">
                <span class="date">Monday, Aug 1, 2016</span>
            </p>
        </header>
        <div class="content">
            <p>Last week I  gave a talk and delivered a hands on session at the Sustainable Software Institute’s ‘<a href="https://www.software.ac.uk/rdvw">Research Data Visualisation Workshop</a>‘ which was held at Manchester University. It was a really engaging event, with a lot of good discussion on the issues surrounding data visualisation.</p>

<p><a href="http://www.iidi.napier.ac.uk/c/people/peopleid/41">Professor Jessie Kennedy</a> from Edinburgh Napier University gave a great keynote looking at a some key design principles in visualisation, including a number of studies I hadn’t seen before but will definitely be including in my teaching in future.</p>

<p>I gave a talk on ‘Human Science Visualisation’ which really focused on a couple of key issues. Firstly, I tried to illustrate the importance of interactivity in complex visualisations. I then talked about how we as academic researchers need publish our interactive visualisations in posterity, and how we should press academic publishers to help us communicate our data to readers. Finally, I wanted to point people towards the excellent visualisation work being done by data journalists, and that the newsrooms are an excellent source of ideas and tips for data visualisation. The slides for my talk are here. It’s the first time I’ve spoken about visualisation outside of the classroom, and it was a really fun talk to give.</p>

<p>We also had two great talks from <a href="https://sites.google.com/site/chbergma/">Dr Christina Bergmann</a> and <a href="http://andysouth.co.uk/">Dr Andy South</a>, focusing on issues of biological visualisation and mapping respectively. All the talks generated some good discussion both in the room and online, which was fantastic to see.</p>

<p>In the afternoon I lead a hands on session looking at visualising data using d3. This was the first time I’d taught a session using d3 v4, which made things slightly interesting. I’m not fully up to speed with all the areas of the API that have changed, so getting the live coding right first time was a bit tricky, but I think I managed. Interestingly, I feel that the changes made to the .data(), .exit(), .enter(), update cycle as discussed in Mike’s “<a href="https://medium.com/@mbostock/what-makes-software-good-943557f8a488">What Makes Software Good</a>” make a lot more sense from a teaching perspective. The addition of .merge() in particular helps a great deal. As you might expect from a d3 workshop that lasted a mere three hours, I’m not entirely convinced that everybody ‘got’ it, but I think a most went away satisfied.</p>

<p>Overall it was a very successful workshop. <a href="http://rgaiacs.com/">Raniere Silva</a> did an excellent job putting it together and running the day, and I really enjoyed it. I’m looking forward to seeing what other people thought about it too.</p>

        </div>
    </article>
    
    <article class="blogpost">
        <header>
            <h1> <a href="/2015/02/05/accessing-and-scraping-myfitnesspal-data-with-python/">
                    Accessing and Scraping MyFitnessPal Data with Python
                </a></h1>
            <p class="author">
                <span class="date">Thursday, Feb 5, 2015</span>
            </p>
        </header>
        <div class="content">
            <p>Interesting news this morning that MyFitnessPal has been bought by Under Armour for  $475 million. I&rsquo;ve used MFP for many years now, and it was pretty helpful in helping me lose all the excess PhD weight that I&rsquo;d put on, and then maintaining a healthy(ish) lifestyle since 2010.</p>

<p>News of an acquisition always has me slightly worried though - not for someone else having access to my data, as I&rsquo;ve made my peace with the fact that using a free service generally means that it&rsquo;s me that&rsquo;s being sold. Giving away my data is the cost of doing business. Rather, it worries me that I may lose access to all the data I&rsquo;ve collected. I have no idea what Under Armour intend for the service in the long run, and while its likely that MFP will continue with business as usual for the foreseeable, it&rsquo;s always worth having a backup of your data.</p>

<p><a href="/2011/06/09/logging-in-to-websites-with-python/">A few years ago, I wrote a couple of python scripts</a> to back up data from MFP and then extract the food and exercise info from the raw HTML. These scripts use Python and Beautiful Soup to do a login to MFP, then go back through your diary history and save all the raw HTML pages, essentially scraping your data.</p>

<p>I came to run them this morning and found they needed a couple of changes to deal with site updates. I&rsquo;ve made the necessary updates and the full code for all the scripts is <a href="https://github.com/martinjc/mfp-scraper">available on GitHub</a>. It&rsquo;s not great, but it works. The code is Python 2 and requires BeautifulSoup and Matplotlib (if you want to use generate_plots.py).</p>

        </div>
    </article>
    
    <article class="blogpost">
        <header>
            <h1> <a href="/2015/01/26/nhs-hackday-2015/">
                    NHS Hackday 2015
                </a></h1>
            <p class="author">
                <span class="date">Monday, Jan 26, 2015</span>
            </p>
        </header>
        <div class="content">
            

<p>This weekend I took part in an incredibly successful <a href="http://nhshackday.com/">NHS hackday</a>, hosted at Cardiff University and organised by <a href="https://twitter.com/amcunningham">Anne Marie Cunningham</a> and James Morgan. We went as a team from the MSc in Computational Journalism, with myself and <a href="https://twitter.com/egrommet">Glyn</a> attending along with <a href="https://twitter.com/PoojaDante">Pooja</a>, <a href="https://twitter.com/NikitaVashisth">Nikita</a>, <a href="https://twitter.com/Idioteque90">Annalisa</a> and <a href="https://twitter.com/cboutaud">Charles</a>. At the last-minute I recruited a couple of ringers as well, dragging along <del>Rhys Priestland</del> <a href="https://twitter.com/flyingSparx">Dr William Wilberforce Webberley</a> from Comsc and <a href="https://twitter.com/voxmjw">Dr Matthew Williams</a>, previously of this parish. Annalisa also brought along Dan Hewitt, so in total we had a large and diverse team.</p>

<h1 id="the-hackday">The hackday</h1>

<p>This was the first NHS hackday I&rsquo;d attended, but I believe it&rsquo;s the second event held in Cardiff, so Anne Marie and the team have it down to a fine art. The whole weekend seemed to go pretty smoothly (barring a couple of misunderstandings on our part regarding the pitch sessions!). It was certainly one of the most well organised events that I&rsquo;ve attended, with all the necessary ingredients for successful coding: much power, many wifi and plenty of food, snacks and coffee. Anne Marie and the team deserve much recognition and thanks for their hard work. I&rsquo;m definitely in for next year.</p>

<p>The quality of the projects created at the hackday was incredibly high across the board, which was great to see. One of my favourites used an Oculus Rift virtual reality headset to create a zombie &lsquo;game&rsquo; that could be used to test people&rsquo;s peripheral vision. Another standout was a system for logging and visualising the ANGEL factors describing a patient&rsquo;s health situation. It was really pleasing to see these rank highly with the judges too, coming in third and second in the overall rankings. Other great projects brought an old Open Source project back to life, created a system for managing groups walking the Wales Coast path, and created automatic notification systems for healthcare processes. Overall it was a really interesting mix of projects, many of which have clear potential to become useful products within or alongside the NHS. As Matt commented in the pub afterwards, it&rsquo;s probably the first hackday we&rsquo;ve been to where several of the projects have clear original IP with commercial potential.</p>

<h1 id="our-project">Our project</h1>

<p>We had decided before the event that we wanted to build some visualisations of health data across Wales, something like <a href="http://nhsmaps.co.uk/">nhsmaps.co.uk</a>, but working with local health boards and local authorities in Wales. We split into two teams for the implementation: &lsquo;the data team&rsquo; who were responsible for sourcing, processing and inputting data, and the &lsquo;interface team&rsquo; who built the front-end and the visualisations.</p>

<p>Progress was good, with Matthew and William quickly defining a schema for describing data so that the data team could add multiple data sets and have the front-end automatically pick them up and be able to visualise them. The CompJ students worked to find and extract data, adding them to the github repository with the correct metadata. Meanwhile, I pulled a bunch of D3 code together for some simple visualisations.</p>

<p>By the end of the weekend we established a fairly decent system. It&rsquo;s able to visualise a few different types of data, at different resolutions, is mostly mobile friendly, and most importantly is easily extensible and adaptable. It&rsquo;s online now on our <a href="http://bit.ly/hewnhs">github pages</a>, and all the code and documentation is also in the <a href="https://github.com/compjcdf/nhs_hack">github repository</a>.</p>

<p>We&rsquo;ll continue development for a while to improve the usability and code quality, and hopefully we&rsquo;ll find a community willing to take the code base on and keep improving what could be a fairly useful resource for understanding the health of Wales.</p>

<h1 id="debrief">Debrief</h1>

<p>We didn&rsquo;t win any of the prizes, which is understandable. Our project was really focused on the public understanding of the NHS and health, and not for solving a particular need within (or for users of) the NHS. We knew this going in to the weekend, and we&rsquo;d taken the decision that it was more important to work on a project related to the course, so that the students could experience some of the tools and technologies they&rsquo;ll be using as the course progresses than to do something more closely aligned with the brief that would have perhaps been less relevant to the students work.</p>

<p>I need to thank Will and Matt for coming and helping the team. Without Matt wrangling the data team and showing them how to create json metadata descriptors we probably wouldn&rsquo;t have anywhere near as many example datasets as we do. Similarly, without Will&rsquo;s hard work on the front end interface, the project wouldn&rsquo;t look nearly as good as it does, or have anywhere near the functionality. His last-minute addition of localstorage for personal datasets was a triumph. (Sadly though he does lose some coder points for user agent sniffing to decide whether to show a mobile interface :-D.) They were both a massive help, and we couldn&rsquo;t have done it without them.</p>

<p>Also, of course, I need to congratulate the CompJ students, who gave up their weekend to trawl through datasets, pull figures off websites and out of pdf&rsquo;s, and create the lovely easy to process .csv files we needed. It was a great effort from them, and I&rsquo;m looking forward to our next Team CompJ hackday outing.</p>

<p>One thing that sadly did stand out was a lack of participation from Comsc undergraduate students, with only one or two attending. <a href="http://www.cs.cf.ac.uk/contactsandpeople/staffpage.php?emailname=Rob.Davies">Rob Davies</a> stopped by on Saturday, and both Will and I discussed with him what we can do to increase participation in these events. Hopefully we&rsquo;ll make some progress on that front in time for the next hackday.</p>

<h1 id="media">Media</h1>

<p>There&rsquo;s some great photos from the event on Flickr, courtesy of <a href="https://www.flickr.com/photos/paul_clarke/">Paul Clarke</a> (<a href="https://www.flickr.com/photos/paul_clarke/sets/72157650042039338/">Saturday</a> and <a href="https://www.flickr.com/photos/paul_clarke/sets/72157650456182132/">Sunday</a>).</p>

<h1 id="elsewhere">Elsewhere&hellip;</h1>

<p>We got a lovely <a href="https://goodpracticeexchange.wordpress.com/2015/01/24/nhs-hack-day-data-visualisation/">write-up about out project</a> from <a href="https://twitter.com/DyfrigWilliams">Dyfrig Williams</a> of the Good Practice Exchange at the Wales Audit Office. Dyfrig also curated a great <a href="https://storify.com/GoodPracticeWAO/nhs-hack-day-cardiff-2015">storify of the weekend</a>.</p>

<p>Hemavault labs have done a round up of the projects <a href="http://blog.hemavault.com/2015/01/27/nhs-hack-day-cardiff-2015-projects/">here</a></p>

        </div>
    </article>
    
    <article class="blogpost">
        <header>
            <h1> <a href="/2015/01/05/compj-labs-postcodes/">
                    CompJ Labs - Postcodes
                </a></h1>
            <p class="author">
                <span class="date">Monday, Jan 5, 2015</span>
            </p>
        </header>
        <div class="content">
            <p>I&rsquo;ve thrown up a <a href="http://compj.cs.cf.ac.uk/2015/01/05/empty-properties-postcodes/">post</a> on <a href="http://compj.cs.cf.ac.uk">compj.cs.cf.ac.uk</a> about some work we&rsquo;ve done looking at empty properties in Cardiff. I&rsquo;ll add further posts over the coming weeks about other data analysis we&rsquo;ve done on this topic, and new work looking at the Welsh Assembly.</p>

        </div>
    </article>
    
    <article class="blogpost">
        <header>
            <h1> <a href="/2014/11/19/quick-and-dirty-twitter-api-in-python/">
                    Quick and Dirty Twitter API in Python
                </a></h1>
            <p class="author">
                <span class="date">Wednesday, Nov 19, 2014</span>
            </p>
        </header>
        <div class="content">
            <p><strong>QUICK DISCLAIMER: this is a quick and dirty solution to a problem, so may not represent best coding practice, and has absolutely no error checking or handling. Use with caution&hellip;</strong></p>

<p>A recent project has needed me to scrape some data from Twitter. I considered using <a href="https://github.com/tweepy/tweepy">Tweepy</a>, but as it was a project for the <a href="compj.cs.cf.ac.uk">MSc in Computational Journalism</a>, I thought it would be more interesting to write our own simple Twitter API wrapper in Python.</p>

<p>The code presented here will allow you to make any API request to Twitter that uses a GET request, so is really only useful for getting data <em>from</em> Twitter, not sending it <em>to</em> Twitter. It is also only for using with the REST API, not the streaming API, so if you&rsquo;re looking for realtime monitoring, this is not the API wrapper you&rsquo;re looking for. This API wrapper also uses a single user&rsquo;s authentication (yours), so is not setup to allow other users to use Twitter through your application.</p>

<p>The first step is to get some access credentials from Twitter. Head over to <a href="https://apps.twitter.com/">https://apps.twitter.com/</a> and register a new application. Once the application is created, you&rsquo;ll be able to access its details. Under &lsquo;Keys and Access Tokens&rsquo; are four values we&rsquo;re going to need for the API - the  <code>Consumer Key</code> and <code>Consumer Secret</code>, and the <code>Access Token</code> and <code>Access Token Secret</code>. Copy all four values into a new python file, and save it as &lsquo;<code>_credentials.py</code>&rsquo;. Once we have the credentials, we can write some code to make some API requests!</p>

<p>First, we define a Twitter API object that will carry out our API requests. We need to store the API url, and some details to allow us to throttle our requests to Twitter to fit inside their rate limiting.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Twitter_API</span>:

 <span style="color:#66d9ef">def</span> __init__(self):

   <span style="color:#75715e"># URL for accessing API</span>
   scheme <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://&#34;</span>
   api_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;api.twitter.com&#34;</span>
   version <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;1.1&#34;</span>

   self<span style="color:#f92672">.</span>api_base <span style="color:#f92672">=</span> scheme <span style="color:#f92672">+</span> api_url <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/&#34;</span> <span style="color:#f92672">+</span> version

   <span style="color:#75715e">#</span>
   <span style="color:#75715e"># seconds between queries to each endpoint</span>
   <span style="color:#75715e"># queries in this project limited to 180</span>
   <span style="color:#75715e"># per 15 minutes</span>
   query_interval <span style="color:#f92672">=</span> float(<span style="color:#ae81ff">15</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span>)<span style="color:#f92672">/</span>(<span style="color:#ae81ff">175</span>)

   <span style="color:#75715e">#</span>
   <span style="color:#75715e"># rate limiting timer</span>
   self<span style="color:#f92672">.</span>__monitor <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;wait&#39;</span>:query_interval,
     <span style="color:#e6db74">&#39;earliest&#39;</span>:None,
     <span style="color:#e6db74">&#39;timer&#39;</span>:None}</code></pre></div>

<p>We add a rate limiting method that will make our API sleep if we are requesting things from Twitter too fast:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#</span>
<span style="color:#75715e"># rate_controller puts the thread to sleep</span>
<span style="color:#75715e"># if we&#39;re hitting the API too fast</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__rate_controller</span>(self, monitor_dict):

 <span style="color:#75715e">#</span>
 <span style="color:#75715e"># join the timer thread</span>
 <span style="color:#66d9ef">if</span> monitor_dict[<span style="color:#e6db74">&#39;timer&#39;</span>] <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None:
 monitor_dict[<span style="color:#e6db74">&#39;timer&#39;</span>]<span style="color:#f92672">.</span>join()

 <span style="color:#75715e"># sleep if necessary</span>
 <span style="color:#66d9ef">while</span> time<span style="color:#f92672">.</span>time() <span style="color:#f92672">&lt;</span> monitor_dict[<span style="color:#e6db74">&#39;earliest&#39;</span>]:
   time<span style="color:#f92672">.</span>sleep(monitor_dict[<span style="color:#e6db74">&#39;earliest&#39;</span>] <span style="color:#f92672">-</span> time<span style="color:#f92672">.</span>time())

 <span style="color:#75715e"># work out then the next API call can be made</span>
 earliest <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time() <span style="color:#f92672">+</span> monitor_dict[<span style="color:#e6db74">&#39;wait&#39;</span>]
 timer <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Timer( earliest<span style="color:#f92672">-</span>time<span style="color:#f92672">.</span>time(), <span style="color:#66d9ef">lambda</span>: None )
 monitor_dict[<span style="color:#e6db74">&#39;earliest&#39;</span>] <span style="color:#f92672">=</span> earliest
 monitor_dict[<span style="color:#e6db74">&#39;timer&#39;</span>] <span style="color:#f92672">=</span> timer
 monitor_dict[<span style="color:#e6db74">&#39;timer&#39;</span>]<span style="color:#f92672">.</span>start()</code></pre></div>

<p>The Twitter API requires us to supply authentication headers in the request. One of these headers is a signature, created by encoding details of the request. We can write a function that will take in all the details of the request (method, url, parameters) and create the signature:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#</span>
<span style="color:#75715e"># make the signature for the API request</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_signature</span>(self, method, url, params):

 <span style="color:#75715e"># escape special characters in all parameter keys</span>
 encoded_params <span style="color:#f92672">=</span> {}
 <span style="color:#66d9ef">for</span> k, v <span style="color:#f92672">in</span> params<span style="color:#f92672">.</span>items():
   encoded_k <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(str(k))
   encoded_v <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(str(v))
   encoded_params[encoded_k] <span style="color:#f92672">=</span> encoded_v

 <span style="color:#75715e"># sort the parameters alphabetically by key</span>
 sorted_keys <span style="color:#f92672">=</span> sorted(encoded_params<span style="color:#f92672">.</span>keys())

 <span style="color:#75715e"># create a string from the parameters</span>
 signing_string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>

 count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
 <span style="color:#66d9ef">for</span> key <span style="color:#f92672">in</span> sorted_keys:
   signing_string <span style="color:#f92672">+=</span> key
   signing_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;=&#34;</span>
   signing_string <span style="color:#f92672">+=</span> encoded_params[key]
   count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
   <span style="color:#66d9ef">if</span> count <span style="color:#f92672">&lt;</span> len(sorted_keys):
     signing_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;&amp;&#34;</span>

 <span style="color:#75715e"># construct the base string</span>
 base_string <span style="color:#f92672">=</span> method<span style="color:#f92672">.</span>upper()
 base_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;&amp;&#34;</span>
 base_string <span style="color:#f92672">+=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(url)
 base_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;&amp;&#34;</span>
 base_string <span style="color:#f92672">+=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(signing_string)

 <span style="color:#75715e"># construct the key</span>
 signing_key <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(client_secret) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&amp;&#34;</span> <span style="color:#f92672">+</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(access_secret)

 <span style="color:#75715e"># encrypt the base string with the key, and base64 encode the result</span>
 hashed <span style="color:#f92672">=</span> hmac<span style="color:#f92672">.</span>new(signing_key<span style="color:#f92672">.</span>encode(), base_string<span style="color:#f92672">.</span>encode(), sha1)
 signature <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>b64encode(hashed<span style="color:#f92672">.</span>digest())
 <span style="color:#66d9ef">return</span> signature<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>)</code></pre></div>

<p>Finally, we can write a method to actually <em>make</em> the API request:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">query_get</span>(self, endpoint, aspect, get_params<span style="color:#f92672">=</span>{}):

 <span style="color:#75715e">#</span>
 <span style="color:#75715e"># rate limiting</span>
 self<span style="color:#f92672">.</span>__rate_controller(self<span style="color:#f92672">.</span>__monitor)

 <span style="color:#75715e"># ensure we&#39;re dealing with strings as parameters</span>
 str_param_data <span style="color:#f92672">=</span> {}
 <span style="color:#66d9ef">for</span> k, v <span style="color:#f92672">in</span> get_params<span style="color:#f92672">.</span>items():
   str_param_data[str(k)] <span style="color:#f92672">=</span> str(v)

 <span style="color:#75715e"># construct the query url</span>
 url <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>api_base <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/&#34;</span> <span style="color:#f92672">+</span> endpoint <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/&#34;</span> <span style="color:#f92672">+</span> aspect <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.json&#34;</span>

 <span style="color:#75715e"># add the header parameters for authorisation</span>
 header_parameters <span style="color:#f92672">=</span> {
   <span style="color:#e6db74">&#34;oauth_consumer_key&#34;</span>: client_id,
   <span style="color:#e6db74">&#34;oauth_nonce&#34;</span>: uuid<span style="color:#f92672">.</span>uuid4(),
   <span style="color:#e6db74">&#34;oauth_signature_method&#34;</span>: <span style="color:#e6db74">&#34;HMAC-SHA1&#34;</span>,
   <span style="color:#e6db74">&#34;oauth_timestamp&#34;</span>: time<span style="color:#f92672">.</span>time(),
   <span style="color:#e6db74">&#34;oauth_token&#34;</span>: access_token,
   <span style="color:#e6db74">&#34;oauth_version&#34;</span>: <span style="color:#ae81ff">1.0</span>
 }

 <span style="color:#75715e"># collect all the parameters together for creating the signature</span>
 signing_parameters <span style="color:#f92672">=</span> {}
 <span style="color:#66d9ef">for</span> k, v <span style="color:#f92672">in</span> header_parameters<span style="color:#f92672">.</span>items():
   signing_parameters[k] <span style="color:#f92672">=</span> v
 <span style="color:#66d9ef">for</span> k, v <span style="color:#f92672">in</span> str_param_data<span style="color:#f92672">.</span>items():
   signing_parameters[k] <span style="color:#f92672">=</span> v

 <span style="color:#75715e"># create the signature and add it to the header parameters</span>
 header_parameters[<span style="color:#e6db74">&#34;oauth_signature&#34;</span>] <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>get_signature(<span style="color:#e6db74">&#34;GET&#34;</span>, url, signing_parameters)

 <span style="color:#75715e"># add the OAuth headers</span>
 header_string <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;OAuth &#34;</span>
 count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
 <span style="color:#66d9ef">for</span> k, v <span style="color:#f92672">in</span> header_parameters<span style="color:#f92672">.</span>items():
   header_string <span style="color:#f92672">+=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(str(k))
   header_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;=</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">&#34;</span>
   header_string <span style="color:#f92672">+=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote_plus(str(v))
   header_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">&#34;</span>
   count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
   <span style="color:#66d9ef">if</span> count <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">7</span>:
     header_string <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;, &#34;</span>

 headers <span style="color:#f92672">=</span> {
   <span style="color:#e6db74">&#34;Authorization&#34;</span>: header_string
 }

 <span style="color:#75715e"># create the full url including parameters</span>
 url <span style="color:#f92672">=</span> url <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;?&#34;</span> <span style="color:#f92672">+</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>urlencode(str_param_data)
 request <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>request<span style="color:#f92672">.</span>Request(url, headers<span style="color:#f92672">=</span>headers)

 <span style="color:#75715e"># make the API request</span>
 <span style="color:#66d9ef">try</span>:
   response <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>request<span style="color:#f92672">.</span>urlopen(request)
   <span style="color:#66d9ef">except</span> urllib<span style="color:#f92672">.</span>error<span style="color:#f92672">.</span>HTTPError <span style="color:#66d9ef">as</span> e:
   <span style="color:#66d9ef">print</span>(e)
 <span style="color:#66d9ef">raise</span> e
   <span style="color:#66d9ef">except</span> urllib<span style="color:#f92672">.</span>error<span style="color:#f92672">.</span>URLError <span style="color:#66d9ef">as</span> e:
   <span style="color:#66d9ef">print</span>(e)
   <span style="color:#66d9ef">raise</span> e

 <span style="color:#75715e"># read the response and return the json</span>
 raw_data <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#34;utf-8&#34;</span>)
 <span style="color:#66d9ef">return</span> json<span style="color:#f92672">.</span>loads(raw_data)</code></pre></div>

<p>Putting this all together, we have a simple Python class that acts as an API wrapper for GET requests to the Twitter REST API, including the signing and authentication of those requests. Using it is as simple as:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"> ta <span style="color:#f92672">=</span> Twitter_API()

 <span style="color:#75715e"># retrieve tweets for a user</span>
 params <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#34;screen_name&#34;</span>: <span style="color:#e6db74">&#34;martinjc&#34;</span>,
 }

 user_tweets <span style="color:#f92672">=</span> ta<span style="color:#f92672">.</span>query_get(<span style="color:#e6db74">&#34;statuses&#34;</span>, <span style="color:#e6db74">&#34;user_timeline&#34;</span>, params)</code></pre></div>

<p>As always, the full code is online on Github, in both my <a href="https://github.com/CompJCDF/Simple-Python-Twitter-API">personal account</a> and the <a href="https://github.com/CompJCDF">account for</a> the <a href="http://compj.cs.cf.ac.uk/">MSc Computational Journalism</a>.</p>

        </div>
    </article>
    
    <article class="blogpost">
        <header>
            <h1> <a href="/2014/10/03/computational-journalism-a-manifesto/">
                    Computational Journalism - &#39;a Manifesto&#39;
                </a></h1>
            <p class="author">
                <span class="date">Friday, Oct 3, 2014</span>
            </p>
        </header>
        <div class="content">
            <p>While Glyn and I have been discussing the new MSc course between ourselves and with others, we have repeatedly come up with the same issues and themes, again and again. As a planning exercise earlier in the summer, we gathered some of these together into a &lsquo;manifesto&rsquo;.</p>

<p>The manifesto is online on our main &lsquo;<a href="http://compj.cs.cf.ac.uk">Computational Journalism</a>&rsquo; website with a <a href="http://compj.cs.cf.ac.uk/2014/09/26/computational-journalism-the-manifesto/">bit of extra commentary</a>.</p>

        </div>
    </article>
    
    <article class="blogpost">
        <header>
            <h1> <a href="/2014/09/17/geojson-and-topojson-for-uk-boundaries/">
                    GeoJSON and topoJSON for UK boundaries
                </a></h1>
            <p class="author">
                <span class="date">Wednesday, Sep 17, 2014</span>
            </p>
        </header>
        <div class="content">
            <p>I&rsquo;ve just put an archive online containing GeoJSON and topoJSON for UK boundary data. It&rsquo;s all stored on <a href="https://github.com/martinjc/UK-GeoJSON">Github</a>, with a viewer and download site hosted on <a href="http://martinjc.github.io/UK-GeoJSON/">Github pages</a>.</p>










<figure>
    <img src="/2014/09/17/geojson-and-topojson-for-uk-boundaries/Screenshot-2014-09-16-11.08.37-1008x1024.png" width="1008" height="1024" alt="Browser for the UK topoJSON stored in the Github repository">
    <figcaption>
        <small>
            Browser for the UK topoJSON stored in the Github repository
        </small>
    </figcaption>
</figure>

<p>The data is all created from shapefiles released by the Office of National Statistics, Ordnance Survey and National Records Scotland, all under the <a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/">Open Government</a> and <a href="http://www.ordnancesurvey.co.uk/docs/licences/os-opendata-licence.pdf">OS OpenData</a> licences.</p>

<p>In later posts I&rsquo;ll detail how I created the files, and how to use them to create interactive choropleth maps.</p>

        </div>
    </article>
    
    <article class="blogpost">
        <header>
            <h1> <a href="/2014/09/15/ccgs-and-wpcs-via-the-medium-of-oas/">
                    CCGs and WPCs via the medium of OAs
                </a></h1>
            <p class="author">
                <span class="date">Monday, Sep 15, 2014</span>
            </p>
        </header>
        <div class="content">
            <p>As I was eating lunch this afternoon, I spotted a conversation between <a href="https://twitter.com/joereddington">@JoeReddington</a> and <a href="https://twitter.com/mysociety">@MySociety</a> whizz past in Tweetdeck. I traced the conversation back to the beginning and found this request for data:</p>

<p><blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">I&#39;m looking for a dataset that shows which UK constituencies are in which NHS trust areas.  Anyone?</p>&mdash; retired account (@retired10072015) <a href="https://twitter.com/retired10072015/status/511105946710716416">September 14, 2014</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script></p>

<p>I&rsquo;ve been doing a lot of playing with geographic data recently while preparing to release a site making it easier to get GeoJSON boundaries of various areas in the UK. As a result, I&rsquo;ve become pretty familiar with the <a href="https://geoportal.statistics.gov.uk/geoportal/catalog/search/browse/browse.page">Office of National Statistics Geography portal</a>, and the data available there. I figured it must be pretty simple to hack something together to provide the data Joseph was looking for, so I took a few minutes out of lunch to see if I could help.</p>

<p>Checking the lookup tables at the ONS, it was clear that unfortunately there was no simple &lsquo;NHS Trust to Parliamentary Constituency&rsquo; lookup table. However, there were two separate lookups involving Output Areas (OAs). One allows you to lookup <a href="https://geoportal.statistics.gov.uk/geoportal/catalog/search/resource/details.page?uuid=%7B441E0CBF-1421-4BF5-BBC9-5B7C0EA0FE44%7D">which Parliamentary Constituency (WPC) an OA belongs to</a>. The other allows you to lookup <a href="https://geoportal.statistics.gov.uk/geoportal/catalog/search/resource/details.page?uuid=%7B15C3A07F-F5E1-4CE8-9CFD-24B3589C725B%7D">which NHS Clinical Commissioning Group (CCG) an OA belongs to</a>. Clearly, all that&rsquo;s required to link the two together is a bit of quick scripting to tie them both together via the Output Areas.</p>

<p>First, let&rsquo;s create a dictionary with an entry for each CCG. For each CCG we&rsquo;ll store it&rsquo;s ID, name, and a set of OAs contained within. We&rsquo;ll also add  an empty set for the WPCs contained within the CCG:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> csv
<span style="color:#f92672">from</span> collections <span style="color:#f92672">import</span> defaultdict

data <span style="color:#f92672">=</span> {}

<span style="color:#75715e"># extract information about clinical commissioning groups</span>
<span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;OA11_CCG13_NHSAT_NHSCR_EN_LU.csv&#39;</span>, <span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> oa_to_cgc_file:
  reader <span style="color:#f92672">=</span> csv<span style="color:#f92672">.</span>DictReader(oa_to_cgc_file)
  <span style="color:#66d9ef">for</span> row <span style="color:#f92672">in</span> reader:
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> data<span style="color:#f92672">.</span>get(row[<span style="color:#e6db74">&#39;CCG13CD&#39;</span>]):
      data[row[<span style="color:#e6db74">&#39;CCG13CD&#39;</span>]] <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;CCG13CD&#39;</span>: row[<span style="color:#e6db74">&#39;CCG13CD&#39;</span>], <span style="color:#e6db74">&#39;CCG13NM&#39;</span>: row[<span style="color:#e6db74">&#39;CCG13NM&#39;</span>], <span style="color:#e6db74">&#39;PCON11CD list&#39;</span>: set(), <span style="color:#e6db74">&#39;PCON11NM list&#39;</span>: set(), <span style="color:#e6db74">&#39;OA11CD list&#39;</span>: set(),}
    data[row[<span style="color:#e6db74">&#39;CCG13CD&#39;</span>]][<span style="color:#e6db74">&#39;OA11CD list&#39;</span>]<span style="color:#f92672">.</span>add(row[<span style="color:#e6db74">&#39;OA11CD&#39;</span>])</code></pre></div>

<p>Next we create a lookup table that allows us to convert from OA to WPC:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># extract information for output area to constituency lookup</span>
oas <span style="color:#f92672">=</span> {}
pcon_nm <span style="color:#f92672">=</span> {}

<span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;OA11_PCON11_EER11_EW_LU.csv&#39;</span>, <span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> oa_to_pcon_file:
  reader <span style="color:#f92672">=</span> csv<span style="color:#f92672">.</span>DictReader(oa_to_pcon_file)
  <span style="color:#66d9ef">for</span> row <span style="color:#f92672">in</span> reader:
    oas[row[<span style="color:#e6db74">&#39;OA11CD&#39;</span>]] <span style="color:#f92672">=</span> row[<span style="color:#e6db74">&#39;PCON11CD&#39;</span>]
    pcon_nm[row[<span style="color:#e6db74">&#39;PCON11CD&#39;</span>]] <span style="color:#f92672">=</span> row[<span style="color:#e6db74">&#39;PCON11NM&#39;</span>]</code></pre></div>

<p>As the almost last step we go through the CCGs, and for each one we go through the list of OAs it covers, and lookup the WPC each OA belongs to:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># go through all the ccgs and lookup pcons from oas</span>
<span style="color:#66d9ef">for</span> ccg, d <span style="color:#f92672">in</span> data<span style="color:#f92672">.</span>iteritems():

 <span style="color:#66d9ef">for</span> oa <span style="color:#f92672">in</span> d[<span style="color:#e6db74">&#39;OA11CD list&#39;</span>]:
   d[<span style="color:#e6db74">&#39;PCON11CD list&#39;</span>]<span style="color:#f92672">.</span>add(oas[oa])
   d[<span style="color:#e6db74">&#39;PCON11NM list&#39;</span>]<span style="color:#f92672">.</span>add(pcon_nm[oas[oa]])

<span style="color:#66d9ef">del</span> d[<span style="color:#e6db74">&#39;OA11CD list&#39;</span>]</code></pre></div>

<p>Finally we just need to output the data:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">    <span style="color:#66d9ef">for</span> d <span style="color:#f92672">in</span> data<span style="color:#f92672">.</span>values():

     d[<span style="color:#e6db74">&#39;PCON11CD list&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;;&#39;</span><span style="color:#f92672">.</span>join(d[<span style="color:#e6db74">&#39;PCON11CD list&#39;</span>])
     d[<span style="color:#e6db74">&#39;PCON11NM list&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;;&#39;</span><span style="color:#f92672">.</span>join(d[<span style="color:#e6db74">&#39;PCON11NM list&#39;</span>])

    <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;output.csv&#39;</span>, <span style="color:#e6db74">&#39;w&#39;</span>) <span style="color:#66d9ef">as</span> out_file:
      writer <span style="color:#f92672">=</span> csv<span style="color:#f92672">.</span>DictWriter(out_file, [<span style="color:#e6db74">&#39;CCG13CD&#39;</span>, <span style="color:#e6db74">&#39;CCG13NM&#39;</span>, <span style="color:#e6db74">&#39;PCON11CD list&#39;</span>, <span style="color:#e6db74">&#39;PCON11NM list&#39;</span>])
      writer<span style="color:#f92672">.</span>writeheader()
      writer<span style="color:#f92672">.</span>writerows(data<span style="color:#f92672">.</span>values())</code></pre></div>

<p>Run the script, and we get a nice CSV with one row for each CCG, each row containing a list of the WPC ids and names the CCG covers.</p>

<p>Of course, this data only covers England (as CCGs are a division in NHS England). Although there don&rsquo;t seem to be lookups for OAs to Health Boards in Scotland, or from OAs to Local Health Boards in Wales, it should still be possible to do something similar for these countries using Parliamentary Wards as the intermediate geography, as lookups for Wards to Health Boards and Local Health Boards are available. It&rsquo;s also not immediately clear how well the boundaries for CCGs and WPCs match up, that would require further investigation, depending on what the lookup is to be used for.</p>

<p>All the code, input and output for this task is available on <a href="https://github.com/martinjc/CCG--Constituencies">my github page</a>.</p>

        </div>
    </article>
    
    

<ul class="pagination">
    
    <li class="page-item">
        <a href="/tags/coding/" class="page-link" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
    </li>
    
    <li class="page-item disabled">
    <a href="" class="page-link" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
    </li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item active"><a class="page-link" href="/tags/coding/">1</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/tags/coding/page/2/">2</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/tags/coding/page/3/">3</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="page-item"><a class="page-link" href="/tags/coding/page/4/">4</a></li>
    
    
    <li class="page-item">
    <a href="/tags/coding/page/2/" class="page-link" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
    </li>
    
    <li class="page-item">
        <a href="/tags/coding/page/4/" class="page-link" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
    </li>
    
</ul>

</main>

    </div><script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-25500481-1', 'auto');
    ga('send', 'pageview');

</script>
<script>window.twttr = (function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0],
            t = window.twttr || {};
        if (d.getElementById(id)) return t;
        js = d.createElement(s);
        js.id = id;
        js.src = "https://platform.twitter.com/widgets.js";
        fjs.parentNode.insertBefore(js, fjs);

        t._e = [];
        t.ready = function (f) {
            t._e.push(f);
        };

        return t;
    }(document, "script", "twitter-wjs"));
</script></body>

</html>